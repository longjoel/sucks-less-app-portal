import{r,j as o}from"./index-CpqaaBWq.js";import{b as A,d as C}from"./index-CRg8OV_6.js";const j="ski-free-state.json",h=7,w=12,y=w-2,T=180,k=280,g=300,P=i=>o.jsxs("article",{children:[o.jsx("strong",{children:"Ski Free"}),o.jsx("p",{children:"Dodge obstacles with left and right. Survive longer for a higher score."})]}),u=(i=0)=>({status:"idle",skierLane:Math.floor(h/2),obstacles:[],elapsedMs:0,scoreSeconds:0,bestScoreSeconds:i,ticks:0,nextObstacleId:1}),O=i=>Math.max(0,Math.min(h-1,i)),_=({ctx:i})=>{const[a,d]=r.useState(u),[I,b]=r.useState("Press Start to ski."),M=r.useRef(null);r.useEffect(()=>{(async()=>{const e=await i.vfs.readText(j);if(e)try{const s=JSON.parse(e),t=typeof s.bestScoreSeconds=="number"&&s.bestScoreSeconds>=0?Math.floor(s.bestScoreSeconds):0;d(u(t))}catch{b("Saved score data was invalid. Starting fresh.")}})()},[i.vfs]),r.useEffect(()=>{i.vfs.writeText(j,JSON.stringify({bestScoreSeconds:a.bestScoreSeconds},null,2))},[i.vfs,a.bestScoreSeconds]),r.useEffect(()=>{if(a.status!=="playing")return;const e=setInterval(()=>{d(s=>{if(s.status!=="playing")return s;const t=s.elapsedMs+T,n=s.ticks+1,f=Math.floor(t/1e3),p=Math.min(6,Math.floor(t/5e3)),x=s.obstacles.map(l=>({...l,row:l.row+1})).filter(l=>l.row<w),c=Math.max(2,5-p),m=Math.min(.85,.35+p*.08),S=n%c===0&&Math.random()<m,v=S?[...x,{id:s.nextObstacleId,lane:Math.floor(Math.random()*h),row:0}]:x;if(v.some(l=>l.row===y&&l.lane===s.skierLane)){const l=Math.max(s.bestScoreSeconds,f);return b("You crashed. Press Restart to try again."),{...s,status:"lost",obstacles:v,elapsedMs:t,scoreSeconds:f,bestScoreSeconds:l,ticks:n,nextObstacleId:S?s.nextObstacleId+1:s.nextObstacleId}}return{...s,obstacles:v,elapsedMs:t,scoreSeconds:f,ticks:n,nextObstacleId:S?s.nextObstacleId+1:s.nextObstacleId}})},T);return()=>clearInterval(e)},[a.status]);const L=()=>{d(e=>({...u(e.bestScoreSeconds),status:"playing"})),b("Stay alive as long as you can.")},E=()=>{d(e=>e.status==="playing"?{...e,skierLane:O(e.skierLane-1)}:e)},N=()=>{d(e=>e.status==="playing"?{...e,skierLane:O(e.skierLane+1)}:e)},R=e=>{if(a.status!=="playing")return;const s=e.currentTarget.getBoundingClientRect();e.clientX-s.left<s.width/2?E():N()};return r.useEffect(()=>{const e=M.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const t=k/h,n=g/w,f=Math.floor(Math.min(t,n)*.72);s.fillStyle="#edf5ff",s.fillRect(0,0,k,g),s.strokeStyle="rgba(45, 64, 48, 0.12)",s.lineWidth=1;for(let c=1;c<h;c+=1)s.beginPath(),s.moveTo(c*t,0),s.lineTo(c*t,g),s.stroke();s.textAlign="center",s.textBaseline="middle",s.font=`${f}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif`;for(const c of a.obstacles){const m=c.lane*t+t/2,S=c.row*n+n/2;s.fillText("ðŸŒ²",m,S)}const p=a.skierLane*t+t/2,x=y*n+n/2;s.fillText("â›·ï¸",p,x)},[a.obstacles,a.skierLane]),o.jsxs("section",{className:"slap-shell",children:[o.jsxs("div",{className:"skifree-layout",children:[o.jsx(A,{children:"Use Left and Right to dodge trees."}),o.jsxs("div",{className:"skifree-stage",children:[o.jsx("canvas",{ref:M,className:"skifree-canvas",width:k,height:g,onPointerDown:R,"aria-label":"Ski slope"}),o.jsxs("div",{className:"skifree-hud",children:[o.jsxs("strong",{children:[a.scoreSeconds,"s | Best ",a.bestScoreSeconds,"s"]}),o.jsx("span",{children:I})]})]})]}),o.jsx("div",{className:"skifree-controls",children:o.jsx(C,{title:a.status==="playing"?"Restart":"Start",onClick:L})})]})},B={id:"ski-free",title:"Ski Free",author:"Joel",description:"Dodge obstacles and survive as long as possible.",icon:"ðŸŽ¿",Preview:P,Application:_};export{B as skiFreeManifest};
