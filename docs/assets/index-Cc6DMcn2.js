import{r,j as i}from"./index-CpqaaBWq.js";import{b as m,c as T,d as p}from"./index-CRg8OV_6.js";const I="countdown-state.json",A=24*60*60*1e3,E=o=>i.jsxs("article",{children:[i.jsx("strong",{children:"Countdown"}),i.jsx("p",{children:"Track days until important dates."})]}),N=o=>new Date(o.getFullYear(),o.getMonth(),o.getDate()),S=o=>{const t=o.split("-").map(c=>Number.parseInt(c,10));if(t.length!==3||t.some(c=>Number.isNaN(c)))return null;const[d,l,a]=t;return new Date(d,l-1,a)},w=o=>{const t=S(o);if(!t)return null;const d=N(new Date),l=N(t);return Math.ceil((l.getTime()-d.getTime())/A)},C=o=>{if(typeof o!="object"||o===null)return null;const t=o;return typeof t.id!="string"||typeof t.title!="string"||typeof t.targetDate!="string"||typeof t.createdAtIso!="string"?null:{id:t.id,title:t.title,targetDate:t.targetDate,createdAtIso:t.createdAtIso}},k=()=>({items:[],notificationsEnabled:!1,notifiedItemIds:[]}),$=({ctx:o})=>{const[t,d]=r.useState(k),[l,a]=r.useState("Add something to count down to."),[c,h]=r.useState(""),[u,x]=r.useState("");r.useEffect(()=>{(async()=>{const n=await o.vfs.readText(I);if(n)try{const e=JSON.parse(n),s=Array.isArray(e.items)?e.items.map(C).filter(g=>g!==null):[],f=Array.isArray(e.notifiedItemIds)?e.notifiedItemIds.filter(g=>typeof g=="string"):[];d({items:s,notificationsEnabled:e.notificationsEnabled===!0,notifiedItemIds:f})}catch{a("Saved countdown data was invalid. Loaded defaults.")}})()},[o.vfs]),r.useEffect(()=>{o.vfs.writeText(I,JSON.stringify(t,null,2))},[o.vfs,t]),r.useEffect(()=>{if(!t.notificationsEnabled||typeof Notification>"u"||Notification.permission!=="granted")return;const e=t.items.filter(s=>w(s.targetDate)===0).filter(s=>!t.notifiedItemIds.includes(s.id));if(e.length!==0){for(const s of e)new Notification(`Today: ${s.title}`,{body:`Your countdown has reached ${s.targetDate}.`});d(s=>({...s,notifiedItemIds:[...s.notifiedItemIds,...e.map(f=>f.id)]}))}},[t.items,t.notificationsEnabled,t.notifiedItemIds]);const b=async()=>{if(typeof Notification>"u"){a("Notifications are not supported in this browser.");return}await Notification.requestPermission()==="granted"?(d(e=>({...e,notificationsEnabled:!0})),a("Notifications enabled.")):a("Notification permission not granted.")},j=()=>{d(n=>({...n,notificationsEnabled:!n.notificationsEnabled})),a(t.notificationsEnabled?"Notifications disabled.":"Notifications enabled if permission is granted.")},D=()=>{const n=c.trim();if(!n){a("Please enter a title.");return}if(!u||w(u)===null){a("Please choose a valid target date.");return}const e={id:`countdown-${Date.now()}`,title:n,targetDate:u,createdAtIso:new Date().toISOString()};d(s=>({...s,items:[e,...s.items]})),h(""),a(`Added countdown for ${n}.`)},v=n=>{d(e=>({...e,items:e.items.filter(s=>s.id!==n),notifiedItemIds:e.notifiedItemIds.filter(s=>s!==n)})),a("Countdown removed.")},y=r.useMemo(()=>[...t.items].sort((n,e)=>new Date(e.createdAtIso).getTime()-new Date(n.createdAtIso).getTime()),[t.items]);return i.jsxs("section",{className:"slap-shell",children:[i.jsx(m,{children:"Track how many days until upcoming events."}),i.jsx(m,{children:l}),i.jsxs("div",{className:"countdown-form",children:[i.jsx(T,{label:"Event",value:c,onChange:h}),i.jsxs("label",{className:"slap-input-wrap",children:[i.jsx("span",{children:"Target Date"}),i.jsx("input",{className:"slap-input",type:"date",value:u,onChange:n=>x(n.target.value)})]})]}),i.jsxs("div",{className:"slap-button-row",children:[i.jsx(p,{title:"Add Countdown",onClick:D}),typeof Notification<"u"&&Notification.permission!=="granted"?i.jsx(p,{title:"Enable Notifications",onClick:()=>void b()}):i.jsx(p,{title:t.notificationsEnabled?"Disable Notifications":"Enable Notifications",onClick:j})]}),i.jsxs("section",{className:"countdown-list",children:[y.length===0?i.jsx(m,{children:"No countdowns yet."}):null,y.map(n=>{const e=w(n.targetDate),s=e===0,f=typeof e=="number"&&e<0;return i.jsxs("article",{className:`countdown-card${s?" countdown-due":""}`,children:[i.jsxs("div",{className:"countdown-card-head",children:[i.jsx("strong",{children:n.title}),i.jsx(p,{title:"Remove",onClick:()=>v(n.id)})]}),i.jsx("p",{className:"countdown-main-value",children:e===null?"--":s?"Today":f?`${Math.abs(e)} days ago`:`${e} days`}),i.jsxs(m,{children:["Target: ",n.targetDate]})]},n.id)})]})]})},O={id:"countdown",title:"Countdown",author:"Joel",description:"Track days until upcoming events with optional notifications.",icon:"‚è≥",Preview:E,Application:$};export{O as countdownManifest};
