import{r,j as o}from"./index-Bfv3-9sk.js";import{S as N,a as C,b as P,d as _}from"./index-CB7fX_Te.js";const M="ski-free-state.json",h=7,j=12,y=j-2,T=180,v=280,g=300,H=i=>o.jsxs("article",{children:[o.jsx("strong",{children:"Ski Free"}),o.jsx("p",{children:"Dodge obstacles with left and right. Survive longer for a higher score."})]}),u=(i=0)=>({status:"idle",skierLane:Math.floor(h/2),obstacles:[],elapsedMs:0,scoreSeconds:0,bestScoreSeconds:i,ticks:0,nextObstacleId:1}),O=i=>Math.max(0,Math.min(h-1,i)),F=({ctx:i})=>{const[a,d]=r.useState(u),[I,b]=r.useState("Press Start to ski."),w=r.useRef(null);r.useEffect(()=>{(async()=>{const s=await i.vfs.readText(M);if(s)try{const e=JSON.parse(s),t=typeof e.bestScoreSeconds=="number"&&e.bestScoreSeconds>=0?Math.floor(e.bestScoreSeconds):0;d(u(t))}catch{b("Saved score data was invalid. Starting fresh.")}})()},[i.vfs]),r.useEffect(()=>{i.vfs.writeText(M,JSON.stringify({bestScoreSeconds:a.bestScoreSeconds},null,2))},[i.vfs,a.bestScoreSeconds]),r.useEffect(()=>{if(a.status!=="playing")return;const s=setInterval(()=>{d(e=>{if(e.status!=="playing")return e;const t=e.elapsedMs+T,n=e.ticks+1,f=Math.floor(t/1e3),p=Math.min(6,Math.floor(t/5e3)),x=e.obstacles.map(l=>({...l,row:l.row+1})).filter(l=>l.row<j),c=Math.max(2,5-p),k=Math.min(.85,.35+p*.08),S=n%c===0&&Math.random()<k,m=S?[...x,{id:e.nextObstacleId,lane:Math.floor(Math.random()*h),row:0}]:x;if(m.some(l=>l.row===y&&l.lane===e.skierLane)){const l=Math.max(e.bestScoreSeconds,f);return b("You crashed. Press Restart to try again."),{...e,status:"lost",obstacles:m,elapsedMs:t,scoreSeconds:f,bestScoreSeconds:l,ticks:n,nextObstacleId:S?e.nextObstacleId+1:e.nextObstacleId}}return{...e,obstacles:m,elapsedMs:t,scoreSeconds:f,ticks:n,nextObstacleId:S?e.nextObstacleId+1:e.nextObstacleId}})},T);return()=>clearInterval(s)},[a.status]);const L=()=>{d(s=>({...u(s.bestScoreSeconds),status:"playing"})),b("Stay alive as long as you can.")},A=()=>{d(s=>s.status==="playing"?{...s,skierLane:O(s.skierLane-1)}:s)},E=()=>{d(s=>s.status==="playing"?{...s,skierLane:O(s.skierLane+1)}:s)},R=s=>{if(a.status!=="playing")return;const e=s.currentTarget.getBoundingClientRect();s.clientX-e.left<e.width/2?A():E()};return r.useEffect(()=>{const s=w.current;if(!s)return;const e=s.getContext("2d");if(!e)return;const t=v/h,n=g/j,f=Math.floor(Math.min(t,n)*.72);e.fillStyle="#edf5ff",e.fillRect(0,0,v,g),e.strokeStyle="rgba(45, 64, 48, 0.12)",e.lineWidth=1;for(let c=1;c<h;c+=1)e.beginPath(),e.moveTo(c*t,0),e.lineTo(c*t,g),e.stroke();e.textAlign="center",e.textBaseline="middle",e.font=`${f}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif`;for(const c of a.obstacles){const k=c.lane*t+t/2,S=c.row*n+n/2;e.fillText("ðŸŒ²",k,S)}const p=a.skierLane*t+t/2,x=y*n+n/2;e.fillText("â›·ï¸",p,x)},[a.obstacles,a.skierLane]),o.jsxs(N,{title:"Ski Free",children:[o.jsxs("div",{className:"skifree-layout",children:[o.jsx(C,{title:"Ski Free"}),o.jsx(P,{children:"Use Left and Right to dodge trees."}),o.jsxs("div",{className:"skifree-stage",children:[o.jsx("canvas",{ref:w,className:"skifree-canvas",width:v,height:g,onPointerDown:R,"aria-label":"Ski slope"}),o.jsxs("div",{className:"skifree-hud",children:[o.jsxs("strong",{children:[a.scoreSeconds,"s | Best ",a.bestScoreSeconds,"s"]}),o.jsx("span",{children:I})]})]})]}),o.jsx("div",{className:"skifree-controls",children:o.jsx(_,{title:a.status==="playing"?"Restart":"Start",onClick:L})})]})},U={id:"ski-free",title:"Ski Free",author:"Joel",description:"Dodge obstacles and survive as long as possible.",icon:"ðŸŽ¿",Preview:H,Application:F};export{U as skiFreeManifest};
