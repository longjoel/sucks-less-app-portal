import{r as i,j as t}from"./index-C9LANGui.js";import{b as M,d as m}from"./index-Cbq74euv.js";const E="minute-timer-state.json",C=a=>t.jsxs("article",{children:[t.jsx("strong",{children:"Minute Timer"}),t.jsx("p",{children:"Simple countdown timer with optional notifications."})]}),j=a=>Math.max(1,Math.min(240,Math.floor(a))),O=a=>{const s=Math.floor(a/60),S=a%60;return`${s.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`},P=({ctx:a})=>{const[s,S]=i.useState(5),[N,l]=i.useState(5*60),[e,d]=i.useState(!1),[u,f]=i.useState(null),[p,h]=i.useState(!1),[b,r]=i.useState("Set minutes and press Start."),[w,v]=i.useState(Date.now());i.useEffect(()=>{(async()=>{const o=await a.vfs.readText(E);if(o)try{const n=JSON.parse(o);if(typeof n.minutes=="number"){const x=j(n.minutes);S(x)}if(typeof n.remainingSeconds=="number"&&n.remainingSeconds>=0)l(Math.floor(n.remainingSeconds));else if(typeof n.minutes=="number"){const x=j(n.minutes);l(x*60)}n.notificationsEnabled===!0&&h(!0),n.isRunning===!0&&typeof n.endAtEpochMs=="number"&&(d(!0),f(n.endAtEpochMs),r("Resumed timer."))}catch{r("Saved timer state was invalid.")}})()},[a.vfs]);const c=i.useMemo(()=>!e||u===null?N:Math.max(0,Math.ceil((u-w)/1e3)),[e,u,w,N]);i.useEffect(()=>{a.vfs.writeText(E,JSON.stringify({minutes:s,notificationsEnabled:p,isRunning:e,endAtEpochMs:u,remainingSeconds:c},null,2))},[a.vfs,s,p,e,u,c]),i.useEffect(()=>{if(!e)return;const o=window.setInterval(()=>v(Date.now()),250);return()=>window.clearInterval(o)},[e]),i.useEffect(()=>{!e||u===null||c>0||(d(!1),f(null),l(0),r("Timer complete."),p&&typeof Notification<"u"&&Notification.permission==="granted"&&new Notification("Minute Timer complete",{body:`${s} minute timer finished.`}))},[e,u,c,p,s]);const y=()=>{if(e)return;const o=c>0?c:s*60,n=Date.now()+o*1e3;l(o),f(n),d(!0),r("Running.")},T=()=>{e&&(d(!1),f(null),l(c),r("Paused."))},R=()=>{d(!1),f(null),l(s*60),r("Reset.")},g=o=>{if(e)return;const n=j(s+o);S(n),l(n*60)},A=async()=>{if(typeof Notification>"u"){r("Notifications not supported.");return}await Notification.requestPermission()==="granted"?(h(!0),r("Notifications enabled.")):r("Notification permission not granted.")},k=i.useMemo(()=>O(c),[c]);return t.jsxs("section",{className:"slap-shell",children:[t.jsx(M,{children:"Simple minute countdown timer."}),t.jsx("p",{className:"timer-display",children:k}),t.jsx(M,{children:b}),t.jsxs("div",{className:"timer-minute-controls",children:[t.jsx(m,{title:"-1 min",onClick:()=>g(-1),disabled:e||s<=1}),t.jsxs(M,{children:["Duration: ",t.jsx("strong",{children:s})," min"]}),t.jsx(m,{title:"+1 min",onClick:()=>g(1),disabled:e||s>=240})]}),t.jsxs("div",{className:"slap-button-row",children:[t.jsx(m,{title:e?"Running":"Start",onClick:y,disabled:e}),t.jsx(m,{title:"Pause",onClick:T,disabled:!e}),t.jsx(m,{title:"Reset",onClick:R}),typeof Notification<"u"&&Notification.permission!=="granted"?t.jsx(m,{title:"Enable Notifications",onClick:()=>void A()}):t.jsx(m,{title:p?"Notifications On":"Notifications Off",onClick:()=>h(o=>!o)})]})]})},J={id:"minute-timer",title:"Minute Timer",author:"Joel",description:"Simple minute timer with optional notifications.",icon:"⏲️",Preview:C,Application:P};export{J as minuteTimerManifest};
