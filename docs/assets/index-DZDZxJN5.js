import{r as x,j as M}from"./index-DTMkQmTp.js";import{S as ct,a as at,b as E,d as V}from"./index-DiShqxyg.js";const Z=10,dt=18,ut=120,ft=8,yt=e=>M.jsxs("article",{children:[M.jsx("strong",{children:"Aquarium"}),M.jsx("p",{children:"Relaxing fish tank with feeding and poke play."})]}),I=(e,n,o)=>Math.min(o,Math.max(n,e)),c=(e,n)=>e+Math.random()*(n-e),tt=["yellow","red","blue","orange"],gt={yellow:52,red:6,blue:200,orange:26},et=(e,n)=>{const o=tt[Math.floor(Math.random()*tt.length)]??"yellow",i=c(14,22),a=c(e*.25,e*.75),m=c(n*.32,n*.74);return{id:crypto.randomUUID(),type:o,x:c(i*2,e-i*2),y:c(n*.2,n*.78),vx:c(-14,14),vy:c(-6,6),size:i,hue:I(gt[o]+c(-12,12),0,360),hunger:c(0,.4),wiggle:c(0,Math.PI*2),wiggleSpeed:c(1.2,2.2),followId:null,boredTimer:c(4,8),orbitAngle:c(0,Math.PI*2),orbitSpeed:c(.6,1.1),orbitRadius:c(i*2.4,i*4.6),orbitCenterX:a,orbitCenterY:m}},pt=e=>({id:crypto.randomUUID(),x:c(e*.15,e*.85),y:c(-10,20),vy:c(18,32),size:c(3,5),age:0}),ht=(e,n)=>({id:crypto.randomUUID(),x:c(e*.1,e*.9),y:c(n*.7,n*.95),vy:c(12,24),size:c(2,6),age:0,ttl:c(5,10)}),bt=(e,n,o)=>({id:crypto.randomUUID(),x:e,y:n,strength:o,age:0,ttl:.6}),mt=(e,n)=>{let o=null,i=1/0;for(const P of n){const u=P.x-e.x,d=P.y-e.y,A=u*u+d*d;A<i&&(i=A,o=P)}if(!o)return null;const a=o.x-e.x,m=o.y-e.y,q=Math.sqrt(i)||1;return{food:o,dx:a,dy:m,dist:q}},nt=(e,n,o)=>{let i=null,a=1/0;for(const u of n){if(u.id===e.id||!o(u))continue;const d=u.x-e.x,A=u.y-e.y,X=d*d+A*A;X<a&&(a=X,i=u)}if(!i)return null;const m=i.x-e.x,q=i.y-e.y,P=Math.sqrt(a)||1;return{target:i,dx:m,dy:q,dist:P}},xt=(e,n,o,i)=>{let a=null,m=1/0;for(const d of o){if(!i(d))continue;const A=d.x-e,X=d.y-n,D=A*A+X*X;D<m&&(m=D,a=d)}if(!a)return null;const q=a.x-e,P=a.y-n,u=Math.sqrt(m)||1;return{target:a,dx:q,dy:P,dist:u}},Mt=(e,n,o)=>{const i=e.createLinearGradient(0,0,0,o);i.addColorStop(0,"#0b2e4a"),i.addColorStop(.55,"#0f3f5f"),i.addColorStop(1,"#0e2733"),e.fillStyle=i,e.fillRect(0,0,n,o);const a=e.createRadialGradient(n*.35,o*.2,10,n*.35,o*.2,n*.6);a.addColorStop(0,"rgba(122, 191, 255, 0.25)"),a.addColorStop(1,"rgba(122, 191, 255, 0)"),e.fillStyle=a,e.fillRect(0,0,n,o),e.fillStyle="#163b2d",e.fillRect(n*.08,o*.72,n*.02,o*.18),e.fillRect(n*.12,o*.68,n*.015,o*.22),e.fillRect(n*.87,o*.7,n*.02,o*.2),e.fillStyle="#2f4f2f",e.fillRect(n*.09,o*.8,n*.05,o*.12),e.fillRect(n*.86,o*.78,n*.04,o*.14),e.fillStyle="#2e2a24",e.fillRect(0,o*.88,n,o*.12),e.fillStyle="#3a332c",e.fillRect(0,o*.9,n,o*.1)},Rt=(e,n)=>{e.strokeStyle="rgba(255, 255, 255, 0.45)",e.lineWidth=1,e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.stroke()},St=(e,n)=>{e.fillStyle="#c8a96b",e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fill()},vt=(e,n)=>{const o=n.vx>=0?1:-1;e.save(),e.translate(n.x,n.y),e.scale(o,1);const i=`hsl(${n.hue}, 70%, 55%)`;e.fillStyle=i,e.beginPath(),e.ellipse(0,0,n.size*1.4,n.size,0,0,Math.PI*2),e.fill(),e.fillStyle=`hsl(${n.hue}, 70%, 45%)`,e.beginPath(),e.moveTo(-n.size*1.4,0),e.lineTo(-n.size*2.2,n.size*.6),e.lineTo(-n.size*2.2,-n.size*.6),e.closePath(),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.arc(n.size*.7,-n.size*.2,n.size*.22,0,Math.PI*2),e.fill(),e.fillStyle="#1b1b1b",e.beginPath(),e.arc(n.size*.75,-n.size*.2,n.size*.1,0,Math.PI*2),e.fill(),e.restore()},zt=()=>{const e=x.useRef(null),n=x.useRef(null),o=x.useRef(null),i=x.useRef({width:320,height:420}),a=x.useRef([]),m=x.useRef([]),q=x.useRef([]),P=x.useRef([]),u=x.useRef({x:0,y:0}),d=x.useRef({active:!1,lastX:0,lastY:0,lastTime:0}),A=x.useRef(0),[X,D]=x.useState("Tap Feed to drop pellets. Poke the glass to scatter fish."),[st,_]=x.useState(0),[$,L]=x.useState(0);x.useEffect(()=>{const l=e.current;if(!l)return;const h=()=>{const R=l.getBoundingClientRect(),v=Math.max(240,R.width),j=Math.max(260,R.height),p=window.devicePixelRatio||1;l.width=Math.floor(v*p),l.height=Math.floor(j*p);const b=l.getContext("2d");if(b&&b.setTransform(p,0,0,p,0,0),i.current={width:v,height:j},a.current.length===0){const S=Array.from({length:7},()=>et(v,j));a.current=S,_(S.length)}};h(),window.addEventListener("resize",h);const k=R=>{const v=l.getContext("2d");if(!v)return;const j=o.current??R,p=Math.min(.05,(R-j)/1e3);o.current=R;const b=i.current,S=a.current,T=m.current,Y=q.current,B=P.current;u.current.x*=.95,u.current.y*=.95,Math.abs(u.current.x)<.01&&(u.current.x=0),Math.abs(u.current.y)<.01&&(u.current.y=0),Math.random()<.4&&(Y.push(ht(b.width,b.height)),Y.length>ut&&Y.shift());for(let t=Y.length-1;t>=0;t-=1){const f=Y[t];f.age+=p,f.y-=f.vy*p,f.x+=Math.sin(f.age*2)*.2,(f.age>f.ttl||f.y<-20)&&Y.splice(t,1)}for(let t=T.length-1;t>=0;t-=1){const f=T[t];f.age+=p,f.y+=f.vy*p,f.y>b.height*.88&&T.splice(t,1)}for(let t=B.length-1;t>=0;t-=1){const f=B[t];f.age+=p,f.age>f.ttl&&B.splice(t,1)}for(const t of S){t.hunger=I(t.hunger+p*.02,0,1),t.wiggle+=p*t.wiggleSpeed;const f=T.length>0,F=f?mt(t,T):null,H=Math.cos(t.wiggle)*6,N=Math.sin(t.wiggle*.7)*3;let z=0,C=0;if(t.type==="yellow"){if(F){const s=16+t.hunger*20;z=F.dx/F.dist*s,C=F.dy/F.dist*s}}else if(t.type==="red"){t.boredTimer-=p;let s=t.followId?S.find(r=>r.id===t.followId)??null:null;if(!s||t.boredTimer<=0){const r=S.filter(y=>y.id!==t.id);s=r.length>0?r[Math.floor(Math.random()*r.length)]??null:null,t.followId=(s==null?void 0:s.id)??null,t.boredTimer=c(4,8)}if(s){const r=s.x-t.x,y=s.y-t.y,g=Math.sqrt(r*r+y*y)||1,w=g>t.size*1.6?14:4;z=r/g*w,C=y/g*w}else z=H,C=N}else if(t.type==="blue")if(F){const s=xt(F.food.x,F.food.y,S,r=>r.type!=="blue"&&r.id!==t.id);if(s&&s.dist<140){const r=s.target.x-t.x,y=s.target.y-t.y,g=Math.sqrt(r*r+y*y)||1,w=22;z=r/g*w,C=y/g*w}else{const r=18+t.hunger*12;z=F.dx/F.dist*r,C=F.dy/F.dist*r}}else{const s=nt(t,S,r=>r.type==="blue");if(s){const y=s.dist-28,g=I(y*.4,-10,10);z=s.dx/s.dist*g,C=s.dy/s.dist*g}else z=H,C=N}else if(t.type==="orange"){t.orbitAngle+=p*t.orbitSpeed;const s=t.size*3,r=b.width-t.size*3,y=t.size*2.5,g=b.height*.78;t.orbitCenterX=I(t.orbitCenterX+Math.sin(t.wiggle*.2)*.08,s,r),t.orbitCenterY=I(t.orbitCenterY+Math.cos(t.wiggle*.18)*.06,y,g);const w=t.orbitCenterX+Math.cos(t.orbitAngle)*t.orbitRadius,lt=t.orbitCenterY+Math.sin(t.orbitAngle)*t.orbitRadius*.6,O=w-t.x,G=lt-t.y,W=Math.sqrt(O*O+G*G)||1,Q=12;z=O/W*Q,C=G/W*Q}else z=H,C=N;if(f&&t.type!=="blue"){const s=nt(t,S,r=>r.type==="blue");if(s&&s.dist<120){const r=(1-s.dist/120)*22;z+=-s.dx/s.dist*r,C+=-s.dy/s.dist*r}}for(const s of B){const r=t.x-s.x,y=t.y-s.y,g=Math.sqrt(r*r+y*y)||1;if(g<120){const w=(1-g/120)*s.strength*80;z+=r/g*w,C+=y/g*w}}z+=u.current.x*40,C+=u.current.y*24,t.vx+=(z-t.vx)*.08,t.vy+=(C-t.vy)*.08,t.x+=t.vx*p,t.y+=t.vy*p;const U=t.size*2.2;t.x<U&&(t.x=U,t.vx=Math.abs(t.vx)),t.x>b.width-U&&(t.x=b.width-U,t.vx=-Math.abs(t.vx)),t.y<U&&(t.y=U,t.vy=Math.abs(t.vy)),t.y>b.height*.86&&(t.y=b.height*.86,t.vy=-Math.abs(t.vy));for(let s=T.length-1;s>=0;s-=1){const r=T[s],y=r.x-t.x,g=r.y-t.y;if(y*y+g*g<(t.size*1.4)**2){T.splice(s,1),t.hunger=I(t.hunger-.5,0,1);break}}}R-A.current>250&&(_(S.length),L(T.length),A.current=R),Mt(v,b.width,b.height);for(const t of Y)Rt(v,t);for(const t of T)St(v,t);for(const t of S)vt(v,t);n.current=requestAnimationFrame(k)};return n.current=requestAnimationFrame(k),()=>{window.removeEventListener("resize",h),n.current!==null&&(cancelAnimationFrame(n.current),n.current=null)}},[]);const ot=()=>{const l=i.current,h=Math.floor(c(5,10));for(let k=0;k<h&&!(m.current.length>=dt);k+=1)m.current.push(pt(l.width));D("Pellets dropped. Fish are on the way."),L(m.current.length)},rt=()=>{const l=i.current;a.current.length>=Z||(a.current.push(et(l.width,l.height)),_(a.current.length),D("A new fish joined the tank."))},it=()=>{m.current=[],L(0)},J=(l,h,k)=>{const R=I(.4+k*.8,.3,1.6);P.current.push(bt(l,h,R)),P.current.length>ft&&P.current.shift()},K=l=>{const h=l.currentTarget.getBoundingClientRect();return{x:l.clientX-h.left,y:l.clientY-h.top}};return M.jsxs(ct,{title:"Aquarium",children:[M.jsx(at,{title:"Aquarium"}),M.jsx(E,{children:"Half screensaver, half playset. Feed the fish or poke the glass to stir them."}),M.jsx(E,{children:X}),M.jsxs("div",{className:"slap-button-row",children:[M.jsx(V,{title:"Feed",onClick:ot}),M.jsx(V,{title:"Add Fish",onClick:rt,disabled:a.current.length>=Z}),M.jsx(V,{title:"Clear Food",onClick:it,disabled:$===0})]}),M.jsxs(E,{children:["Fish: ",st," ¬∑ Food pellets: ",$]}),M.jsx("div",{className:"aquarium-stage",children:M.jsx("canvas",{ref:e,className:"aquarium-canvas",onPointerDown:l=>{d.current.active=!0,d.current.lastX=l.clientX,d.current.lastY=l.clientY,d.current.lastTime=performance.now(),l.currentTarget.setPointerCapture(l.pointerId);const h=K(l);J(h.x,h.y,.6)},onPointerMove:l=>{if(!d.current.active)return;const h=performance.now(),k=l.clientX-d.current.lastX,R=l.clientY-d.current.lastY,v=Math.max(1,h-d.current.lastTime),j=Math.sqrt(k*k+R*R)/v,p=I(k/v,-1,1),b=I(R/v,-1,1);u.current.x=u.current.x*.7+p*.3,u.current.y=u.current.y*.7+b*.3;const S=K(l);J(S.x,S.y,j),d.current.lastX=l.clientX,d.current.lastY=l.clientY,d.current.lastTime=h},onPointerUp:()=>{d.current.active=!1},onPointerCancel:()=>{d.current.active=!1},onPointerLeave:()=>{d.current.active=!1}})}),M.jsx(E,{children:"Tip: Drag to create a current. Rapid taps make fish dart."})]})},Ft={id:"aquarium",title:"Aquarium",author:"Joel",description:"Relaxing fish tank you can feed and poke.",icon:"üêü",Preview:yt,Application:zt};export{Ft as aquariumManifest};
