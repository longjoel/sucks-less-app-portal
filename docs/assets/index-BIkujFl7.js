import{r as p,j as e}from"./index-BXpMHQJa.js";import{S as X,a as L,b as l,d as y}from"./index-D9n4s55T.js";const I="mh-checkin-results.json",Y=[0,1,2,3],U=["Not at all","Several days","More than half the days","Nearly every day"],G={id:"phq9",title:"PHQ-9",maxScore:27,questions:["Little interest or pleasure in doing things","Feeling down, depressed, or hopeless","Trouble falling or staying asleep, or sleeping too much","Feeling tired or having little energy","Poor appetite or overeating","Feeling bad about yourself or that you are a failure","Trouble concentrating on things","Moving or speaking slowly, or being fidgety/restless","Thoughts that you would be better off dead or hurting yourself"],getSeverity:s=>s<=4?"Minimal":s<=9?"Mild":s<=14?"Moderate":s<=19?"Moderately Severe":"Severe"},Z={id:"gad7",title:"GAD-7",maxScore:21,questions:["Feeling nervous, anxious, or on edge","Not being able to stop or control worrying","Worrying too much about different things","Trouble relaxing","Being so restless that it is hard to sit still","Becoming easily annoyed or irritable","Feeling afraid as if something awful might happen"],getSeverity:s=>s<=4?"Minimal":s<=9?"Mild":s<=14?"Moderate":"Severe"},x={phq9:G,gad7:Z},ee=s=>e.jsxs("article",{children:[e.jsx("strong",{children:"MH Checkin"}),e.jsx("p",{children:"PHQ-9, GAD-7, and ABC worksheet with trends/export."})]}),b=s=>s==="phq9"||s==="gad7",te=s=>typeof s.id=="string"&&(s.type==="phq9"||s.type==="gad7")&&typeof s.createdAtIso=="string"&&Array.isArray(s.answers)&&s.answers.every(n=>typeof n=="number")&&typeof s.score=="number"&&typeof s.severity=="string",se=s=>typeof s.id=="string"&&s.type==="abc"&&typeof s.createdAtIso=="string"&&typeof s.activatingEvent=="string"&&typeof s.beliefs=="string"&&typeof s.consequences=="string"&&(typeof s.disputation=="string"||typeof s.disputation>"u")&&(typeof s.effectiveBelief=="string"||typeof s.effectiveBelief>"u")&&(typeof s.distressBefore=="number"||typeof s.distressBefore>"u")&&(typeof s.distressAfter=="number"||typeof s.distressAfter>"u"),ne=s=>{if(typeof s!="object"||s===null)return!1;const n=s;return te(n)||se(n)},re=s=>({app:"slap-mh-checkin",version:1,records:s}),E=s=>{const n=new Date(s);return Number.isNaN(n.getTime())?"Unknown":`${n.toLocaleDateString()} ${n.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},ie=(s,n)=>{const h=s.filter(a=>a.type===n).sort((a,g)=>a.createdAtIso.localeCompare(g.createdAtIso));if(h.length===0)return"No trend data yet.";const d=h.slice(-5),f=h.slice(-10,-5),c=d.reduce((a,g)=>a+g.score,0)/d.length;if(f.length===0)return`Recent average: ${c.toFixed(1)}.`;const m=f.reduce((a,g)=>a+g.score,0)/f.length,o=Number((c-m).toFixed(1));return Math.abs(o)<.3?`Recent average: ${c.toFixed(1)} (stable).`:o>0?`Recent average: ${c.toFixed(1)} (up ${o.toFixed(1)} from prior period).`:`Recent average: ${c.toFixed(1)} (down ${Math.abs(o).toFixed(1)} from prior period).`},ae=s=>{const n=s.filter(o=>o.type==="abc").sort((o,a)=>o.createdAtIso.localeCompare(a.createdAtIso));if(n.length===0)return"No trend data yet.";const h=n.filter(o=>typeof o.distressBefore=="number"&&typeof o.distressAfter=="number");if(h.length===0)return"Trend tip: include distress before/after (0-10) to track change over time.";const d=h.slice(-5),f=d.reduce((o,a)=>o+(a.distressBefore??0),0)/d.length,c=d.reduce((o,a)=>o+(a.distressAfter??0),0)/d.length,m=f-c;return Math.abs(m)<.2?`Recent distress change: stable (${f.toFixed(1)} -> ${c.toFixed(1)}).`:m>0?`Recent distress change: improved by ${m.toFixed(1)} points (${f.toFixed(1)} -> ${c.toFixed(1)}).`:`Recent distress change: increased by ${Math.abs(m).toFixed(1)} points (${f.toFixed(1)} -> ${c.toFixed(1)}).`},W=s=>{if(!s.trim())return;const n=Number(s);return Number.isNaN(n)||n<0||n>10?Number.NaN:n},oe=({ctx:s})=>{const[n,h]=p.useState("phq9"),[d,f]=p.useState([]),[c,m]=p.useState(()=>new Array(G.questions.length).fill(-1)),[o,a]=p.useState(""),[g,A]=p.useState(""),[S,w]=p.useState(""),[N,C]=p.useState(""),[M,B]=p.useState(""),[q,k]=p.useState(""),[H,T]=p.useState(""),[O,D]=p.useState(""),$=b(n)?x[n]:null;p.useEffect(()=>{(async()=>{const t=await s.vfs.readText(I);if(t)try{const r=JSON.parse(t);if(typeof r=="object"&&r!==null){const i=r;Array.isArray(i.records)&&f(i.records.filter(ne))}}catch{a("Saved data was unreadable. Starting fresh.")}})()},[s.vfs]),p.useEffect(()=>{if(a(""),b(n)){m(new Array(x[n].questions.length).fill(-1));return}A(""),w(""),C(""),B(""),k(""),T(""),D("")},[n]);const P=async t=>{await s.vfs.writeText(I,JSON.stringify(re(t),null,2)),f(t)},Q=(t,r)=>{m(i=>i.map((u,F)=>F===t?r:u))},_=async t=>{const r=x[t];if(c.some(R=>R<0)){a("Please answer every question before submitting.");return}const i=c.reduce((R,K)=>R+K,0),u={id:crypto.randomUUID(),type:t,createdAtIso:new Date().toISOString(),answers:c,score:i,severity:r.getSeverity(i)},F=[u,...d].slice(0,300);await P(F),a(`${r.title} saved: ${i}/${r.maxScore} (${u.severity})`),m(new Array(r.questions.length).fill(-1))},J=async()=>{if(!g.trim()||!S.trim()||!N.trim()){a("Please fill A (event), B (beliefs), and C (consequences).");return}const t=W(H),r=W(O);if(Number.isNaN(t)||Number.isNaN(r)){a("Distress values must be between 0 and 10.");return}const u=[{id:crypto.randomUUID(),type:"abc",createdAtIso:new Date().toISOString(),activatingEvent:g.trim(),beliefs:S.trim(),consequences:N.trim(),disputation:M.trim()||void 0,effectiveBelief:q.trim()||void 0,distressBefore:t,distressAfter:r},...d].slice(0,300);await P(u),a("ABC worksheet saved."),A(""),w(""),C(""),B(""),k(""),T(""),D("")},V=async()=>{const t=await s.vfs.readText(I);if(!t){a("No results to export yet.");return}const r=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(r),u=document.createElement("a");u.href=i,u.download="mh-checkin-results.json",u.click(),URL.revokeObjectURL(i)},v=p.useMemo(()=>d.filter(t=>t.type===n).sort((t,r)=>r.createdAtIso.localeCompare(t.createdAtIso)),[d,n]),j=v[0]??null,z=b(n)?ie(d,n):ae(d);return e.jsxs(X,{title:"MH Checkin",children:[e.jsx(L,{title:"Mental Health Check-in"}),e.jsx(l,{children:"Screening support only, not a diagnosis. If you are in immediate danger, call 911 or local emergency services."}),e.jsxs("div",{className:"slap-button-row",children:[e.jsx(y,{title:"PHQ-9",onClick:()=>h("phq9")}),e.jsx(y,{title:"GAD-7",onClick:()=>h("gad7")}),e.jsx(y,{title:"ABC Worksheet",onClick:()=>h("abc")}),e.jsx(y,{title:"Export Results",onClick:()=>void V()})]}),e.jsxs(l,{children:["Current form: ",b(n)?x[n].title:"ABC Worksheet"]}),j?b(n)&&"score"in j?e.jsxs(l,{children:["Last score: ",j.score,"/",x[n].maxScore," (",j.severity,")"]}):e.jsxs(l,{children:["Last ABC worksheet saved: ",E(j.createdAtIso)]}):e.jsx(l,{children:"No completed assessments for this form yet."}),e.jsx(l,{children:z}),o?e.jsx(l,{children:o}):null,e.jsx(L,{title:`History (${v.length})`}),v.length===0?e.jsx(l,{children:"No history yet."}):null,v.map(t=>e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:t.type==="abc"?e.jsxs("strong",{children:[E(t.createdAtIso)," | ABC Worksheet"]}):e.jsxs("strong",{children:[E(t.createdAtIso)," | Score ",t.score,"/",x[t.type].maxScore," (",t.severity,")"]})}),e.jsx("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:t.type==="abc"?e.jsxs(e.Fragment,{children:[e.jsxs(l,{children:["A: ",t.activatingEvent]}),e.jsxs(l,{children:["B: ",t.beliefs]}),e.jsxs(l,{children:["C: ",t.consequences]}),t.disputation?e.jsxs(l,{children:["D: ",t.disputation]}):null,t.effectiveBelief?e.jsxs(l,{children:["E: ",t.effectiveBelief]}):null,typeof t.distressBefore=="number"?e.jsxs(l,{children:["Distress before: ",t.distressBefore,"/10"]}):null,typeof t.distressAfter=="number"?e.jsxs(l,{children:["Distress after: ",t.distressAfter,"/10"]}):null]}):t.answers.map((r,i)=>e.jsxs(l,{children:["Q",i+1,": ",r," (",U[r]??"Unknown",")"]},`${t.id}-${i}`))})]},t.id)),b(n)&&$?e.jsxs(e.Fragment,{children:[$.questions.map((t,r)=>e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.5rem"},children:[e.jsxs("strong",{children:[r+1,". ",t]}),e.jsx("div",{className:"slap-button-row",children:Y.map(i=>e.jsx("button",{type:"button",className:"calc-key",style:{minHeight:"40px",borderColor:c[r]===i?"#2d4030":void 0,fontWeight:c[r]===i?800:600},onClick:()=>Q(r,i),children:i},i))}),e.jsx(l,{children:U.map((i,u)=>`${u}: ${i}`).join(" | ")})]},t)),e.jsx(y,{title:`Save ${$.title} Result`,onClick:()=>void _(n)})]}):null,n==="abc"?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"A: Activating Event"}),e.jsx("textarea",{className:"slap-input",rows:3,value:g,onChange:t=>A(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"B: Beliefs / Thoughts"}),e.jsx("textarea",{className:"slap-input",rows:3,value:S,onChange:t=>w(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"C: Consequences (emotions/behaviors)"}),e.jsx("textarea",{className:"slap-input",rows:3,value:N,onChange:t=>C(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"D: Dispute / Reframe (optional)"}),e.jsx("textarea",{className:"slap-input",rows:2,value:M,onChange:t=>B(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"E: Effective New Belief (optional)"}),e.jsx("textarea",{className:"slap-input",rows:2,value:q,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{className:"slap-button-row",children:[e.jsxs("label",{className:"slap-input-wrap",style:{maxWidth:"140px"},children:[e.jsx("span",{children:"Distress Before (0-10)"}),e.jsx("input",{className:"slap-input",type:"number",min:0,max:10,value:H,onChange:t=>T(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",style:{maxWidth:"140px"},children:[e.jsx("span",{children:"Distress After (0-10)"}),e.jsx("input",{className:"slap-input",type:"number",min:0,max:10,value:O,onChange:t=>D(t.target.value)})]})]}),e.jsx(y,{title:"Save ABC Worksheet",onClick:()=>void J()})]}):null]})},de={id:"mh-checkin",title:"MH Checkin",author:"Joel",description:"PHQ-9, GAD-7, and ABC worksheet with trends/export.",icon:"ðŸ§ ",Preview:ee,Application:oe};export{de as mhCheckinManifest};
