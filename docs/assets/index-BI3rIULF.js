import{r as n,j as t}from"./index-DOdANikL.js";import{S as $,a as G,b as w,d as I}from"./index-9tdpVDTe.js";const k=[3,4,5,6],F=["Inhale","Hold","Exhale","Hold"],W=s=>t.jsxs("article",{children:[t.jsx("strong",{children:"Box Breathing"}),t.jsx("p",{children:"Guided breathing timer with canvas animation."})]}),_=s=>s==="Inhale"?"#2d4030":s==="Exhale"?"#7a5f31":"#6a635a",H=(s,f,c,r,P,h)=>{const e=s.getContext("2d");if(!e)return;const u=s.width,i=s.height,o=u/2,p=i/2;e.clearRect(0,0,u,i),e.fillStyle="#f7f2e7",e.fillRect(0,0,u,i);const l=52,b=Math.min(u,i)*.62,x=l+(b-l)*f;e.fillStyle=_(c),e.strokeStyle="#1c1c1c",e.lineWidth=2;const S=o-x/2,d=p-x/2;e.beginPath(),e.rect(S,d,x,x),e.fill(),e.stroke(),e.fillStyle="#f4f0e8",e.font="bold 22px Trebuchet MS",e.textAlign="center",e.fillText(c,o,p+8),e.fillStyle="#1c1c1c",e.font="14px Trebuchet MS",e.fillText(`Phase ${(r*h).toFixed(1)}s / ${h}s`,o,i-34),e.fillText(`Cycle ${P}`,o,i-14)},X=({ctx:s})=>{const f=n.useRef(null),c=n.useRef(null),[r,P]=n.useState(4),[h,e]=n.useState(!1),[u,i]=n.useState(0),[o,p]=n.useState(0),[l,b]=n.useState(0),[x,S]=n.useState("Tap Start to begin a calm breathing cycle."),d=F[o]??"Inhale",v=n.useMemo(()=>d==="Inhale"?l:d==="Exhale"?1-l:o===1?1:0,[d,o,l]);n.useEffect(()=>{s.vfs.writeText("box-breathing-settings.json",JSON.stringify({secondsPerPhase:r,updatedAtIso:new Date().toISOString()}))},[s.vfs,r]),n.useEffect(()=>{(async()=>{const a=await s.vfs.readText("box-breathing-settings.json");if(a)try{const g=JSON.parse(a);typeof g.secondsPerPhase=="number"&&k.includes(g.secondsPerPhase)&&P(g.secondsPerPhase)}catch{}})()},[s.vfs]),n.useEffect(()=>{const a=f.current;if(!a)return;const g=C=>{const R=f.current;if(!R)return;const B=q=>{const T=(q-C)/1e3,m=r,A=m*4,M=T%A,j=Math.floor(M/m),y=(M-j*m)/m,N=Math.floor(T/A);p(j),b(y),i(N+1);const E=F[j]??"Inhale",J=E==="Inhale"?y:E==="Exhale"?1-y:j===1?1:0;H(R,J,E,y,N+1,m),c.current=requestAnimationFrame(B)};c.current=requestAnimationFrame(B)};if(h){const C=performance.now();g(C-o*r*1e3-l*r*1e3),S("Breathe with the square: inhale, hold, exhale, hold.")}else H(a,v,d,l,Math.max(1,u),r);return()=>{c.current!==null&&(cancelAnimationFrame(c.current),c.current=null)}},[h,r,o,l,u,v,d]);const z=()=>e(!0),D=()=>{e(!1),S("Paused. Resume when ready.")},O=()=>{e(!1),p(0),b(0),i(0),S("Reset. Tap Start when you are ready.")};return t.jsxs($,{title:"Box Breathing",children:[t.jsx(G,{title:"Guided Box Breathing"}),t.jsx(w,{children:"Cycle: Inhale, Hold, Exhale, Hold"}),t.jsxs("label",{className:"slap-input-wrap",children:[t.jsx("span",{children:"Seconds Per Phase"}),t.jsx("select",{className:"slap-input",value:r,onChange:a=>P(Number(a.target.value)),disabled:h,children:k.map(a=>t.jsxs("option",{value:a,children:[a,"s"]},a))})]}),t.jsx("canvas",{ref:f,width:300,height:300,style:{width:"100%",maxWidth:"300px",borderRadius:"0.8rem",border:"1px solid #c5b9a5"}}),t.jsxs("div",{className:"slap-button-row",children:[t.jsx(I,{title:"Start",onClick:z,disabled:h}),t.jsx(I,{title:"Pause",onClick:D,disabled:!h}),t.jsx(I,{title:"Reset",onClick:O})]}),t.jsx(w,{children:x}),t.jsxs(w,{children:["Current phase: ",d]}),t.jsxs(w,{children:["Cycle count: ",u]})]})},Q={id:"box-breathing",title:"Box Breathing",author:"Joel",description:"Canvas-guided inhale/hold/exhale/hold breathing.",icon:"ü´Å",Preview:W,Application:X};export{Q as boxBreathingManifest};
