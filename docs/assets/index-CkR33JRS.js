import{r as h,j as s}from"./index-DTMkQmTp.js";import{b as p,d as y}from"./index-DiShqxyg.js";const w="dice-roller-state.json",S=10,P=100,D=[4,6,8,10,12,20,100],L=[{value:"red",label:"Red"},{value:"blue",label:"Blue"},{value:"neutral",label:"Neutral"}],q=l=>s.jsxs("article",{children:[s.jsx("strong",{children:"Dice Roller"}),s.jsx("p",{children:"Roll multiple color-coded dice pools for tabletop sessions."})]}),A=l=>({id:`pool-${Date.now()}-${l??Math.floor(Math.random()*1e5)}`,color:l===2?"blue":"red",count:l===2?2:3,sides:l===2?8:6}),C=()=>({pools:[A(1),A(2)],history:[],showTotals:!0,sortResults:!1,autoClearHistory:!1}),z=l=>Math.floor(Math.random()*l)+1,O=l=>typeof l!="number"?null:D.includes(l)?l:null,$=l=>l==="red"||l==="blue"||l==="neutral"?l:null,T=l=>Math.max(1,Math.min(P,Math.floor(l))),I=(l,t)=>`${l.join(" + ")} = ${t}`,B=l=>{if(typeof l!="object"||l===null)return null;const t=l;if(typeof t.id!="string")return null;const i=$(t.color),d=O(t.sides),r=typeof t.count=="number"?T(t.count):NaN;return!i||!d||Number.isNaN(r)?null:{id:t.id,color:i,count:r,sides:d}},J=l=>{if(typeof l!="object"||l===null)return null;const t=l;if(typeof t.id!="string"||typeof t.createdAtIso!="string"||!Array.isArray(t.pools)||typeof t.grandTotal!="number")return null;const i=[];for(const d of t.pools){if(typeof d!="object"||d===null)continue;const r=d,f=$(r.color),m=O(r.sides);if(!f||!m||typeof r.poolId!="string"||typeof r.count!="number"||!Array.isArray(r.rolls))continue;const j=r.rolls.filter(a=>typeof a=="number"),b=typeof r.subtotal=="number"?r.subtotal:j.reduce((a,x)=>a+x,0);i.push({poolId:r.poolId,color:f,count:T(r.count),sides:m,rolls:j,subtotal:b})}return{id:t.id,createdAtIso:t.createdAtIso,pools:i,grandTotal:Math.floor(t.grandTotal)}},G=({ctx:l})=>{const[t,i]=h.useState(C),[d,r]=h.useState("Configure pools, then roll."),[f,m]=h.useState(!1);h.useEffect(()=>{(async()=>{const o=await l.vfs.readText(w);if(o)try{const e=JSON.parse(o),c=Array.isArray(e.pools)?e.pools.map(B).filter(u=>u!==null):[],n=Array.isArray(e.history)?e.history.map(J).filter(u=>u!==null):[];i({pools:c.length>0?c:C().pools,history:n.slice(0,S),showTotals:e.showTotals!==!1,sortResults:e.sortResults===!0,autoClearHistory:e.autoClearHistory===!0})}catch{r("Saved data was invalid. Loaded defaults.")}})()},[l.vfs]),h.useEffect(()=>{l.vfs.writeText(w,JSON.stringify(t,null,2))},[l.vfs,t]);const j=()=>{i(o=>({...o,pools:[...o.pools,A()]}))},b=o=>{i(e=>{const c=e.pools.filter(n=>n.id!==o);return c.length===0?e:{...e,pools:c}})},a=(o,e)=>{i(c=>({...c,pools:c.pools.map(n=>n.id===o?{...n,...e,count:e.count!==void 0?T(e.count):n.count}:n)}))},x=o=>{i(e=>({...e,[o]:!e[o]}))},k=()=>{m(!0),window.setTimeout(()=>m(!1),720);const o=t.pools.map(n=>{const u=Array.from({length:n.count},()=>z(n.sides)),v=t.sortResults?[...u].sort((N,R)=>N-R):u,_=v.reduce((N,R)=>N+R,0);return{poolId:n.id,color:n.color,count:n.count,sides:n.sides,rolls:v,subtotal:_}}),e=o.reduce((n,u)=>n+u.subtotal,0),c={id:`roll-${Date.now()}`,createdAtIso:new Date().toISOString(),pools:o,grandTotal:e};i(n=>({...n,history:n.autoClearHistory?[c]:[c,...n.history].slice(0,S)})),r(`Rolled ${o.length} pool${o.length===1?"":"s"}.`)},H=()=>{i(o=>({...o,history:[]})),r("Roll history cleared.")},M=()=>{i(o=>({...C(),history:o.history})),r("Pools reset to defaults.")},g=t.history[0]??null,E=h.useMemo(()=>t.pools.reduce((o,e)=>o+e.count,0),[t.pools]);return s.jsxs("section",{className:"slap-shell",children:[s.jsx(p,{children:"Build custom pools like 3 red d6 + 2 blue d8, then roll."}),s.jsxs(p,{children:["Pools: ",t.pools.length," | Dice: ",E]}),s.jsx(p,{children:d}),s.jsx("div",{className:"dice-primary-action",children:s.jsx(y,{title:"Roll",onClick:k})}),s.jsxs("section",{className:"dice-results",children:[s.jsx("h3",{className:"slap-title",children:"Latest Roll"}),g?s.jsxs(s.Fragment,{children:[g.pools.map(o=>s.jsxs("article",{className:`dice-roll-row dice-${o.color}${f?" dice-roll-animate":""}`,children:[s.jsxs("strong",{children:[o.count,"d",o.sides," ",o.color]}),s.jsx("p",{className:"dice-roll-equation",children:I(o.rolls,o.subtotal)})]},o.poolId)),t.showTotals?s.jsxs(p,{children:["Grand total: ",s.jsx("strong",{children:g.grandTotal})]}):null]}):s.jsx(p,{children:"No rolls yet."})]}),s.jsxs("section",{className:"dice-options",children:[s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:t.showTotals,onChange:()=>x("showTotals")}),"Show totals"]}),s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:t.sortResults,onChange:()=>x("sortResults")}),"Sort rolls"]}),s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:t.autoClearHistory,onChange:()=>x("autoClearHistory")}),"Auto-clear history"]})]}),s.jsx("section",{className:"dice-pool-list",children:t.pools.map(o=>s.jsxs("article",{className:`dice-pool-card dice-${o.color}`,children:[s.jsxs("div",{className:"dice-pool-head",children:[s.jsxs("strong",{children:[o.color.toUpperCase()," Pool"]}),s.jsx("button",{type:"button",className:"dice-remove-btn",onClick:()=>b(o.id),disabled:t.pools.length<=1,children:"Remove"})]}),s.jsxs("div",{className:"dice-pool-controls",children:[s.jsxs("label",{className:"dice-inline-field",children:[s.jsx("span",{children:"Count"}),s.jsxs("div",{className:"dice-count-controls",children:[s.jsx("button",{type:"button",onClick:()=>a(o.id,{count:o.count-1}),children:"-"}),s.jsx("input",{type:"number",min:1,max:P,value:o.count,onChange:e=>a(o.id,{count:Number(e.target.value)||1})}),s.jsx("button",{type:"button",onClick:()=>a(o.id,{count:o.count+1}),children:"+"})]})]}),s.jsxs("label",{className:"dice-inline-field",children:[s.jsx("span",{children:"Die"}),s.jsx("select",{value:o.sides,onChange:e=>a(o.id,{sides:Number(e.target.value)}),children:D.map(e=>s.jsxs("option",{value:e,children:["d",e]},e))})]}),s.jsxs("label",{className:"dice-inline-field",children:[s.jsx("span",{children:"Color"}),s.jsx("select",{value:o.color,onChange:e=>a(o.id,{color:e.target.value}),children:L.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]},o.id))}),s.jsxs("div",{className:"dice-actions",children:[s.jsx(y,{title:"Add Pool",onClick:j}),s.jsx(y,{title:"Clear History",onClick:H}),s.jsx(y,{title:"Reset Defaults",onClick:M})]}),s.jsxs("section",{className:"dice-results",children:[s.jsxs("h3",{className:"slap-title",children:["History (",t.history.length,")"]}),t.history.length===0?s.jsx(p,{children:"History is empty."}):null,t.history.map(o=>s.jsxs("details",{children:[s.jsxs("summary",{children:[new Date(o.createdAtIso).toLocaleTimeString()," | ",o.pools.length," pools",t.showTotals?` | total ${o.grandTotal}`:""]}),o.pools.map(e=>s.jsxs("article",{className:`dice-roll-row dice-${e.color}`,children:[s.jsxs("strong",{children:[e.count,"d",e.sides," ",e.color]}),s.jsx("p",{className:"dice-roll-equation",children:I(e.rolls,e.subtotal)})]},`${o.id}:${e.poolId}`))]},o.id))]})]})},U={id:"dice-roller",title:"Dice Roller",author:"Joel",description:"Roll custom color-coded dice pools for tabletop sessions.",icon:"ðŸŽ²",Preview:q,Application:G};export{U as diceRollerManifest};
