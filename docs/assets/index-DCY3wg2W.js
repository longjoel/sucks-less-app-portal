import{r as l,j as a}from"./index-C9LANGui.js";import{S as B,d as m,b as y,c as N,a as R}from"./index-Cbq74euv.js";const w="daily-checklist.json",K=[{id:"water",text:"Drink water"},{id:"walk",text:"Take a short walk"},{id:"pause",text:"Take one mindful pause"}],F=c=>a.jsxs("article",{children:[a.jsx("strong",{children:"Daily Checklist"}),a.jsx("p",{children:"Check off daily tasks and manage your list."})]}),O=()=>new Date().toISOString().slice(0,10),q=c=>{if(typeof c!="object"||c===null)return!1;const e=c;return typeof e.id=="string"&&typeof e.text=="string"},S=()=>({app:"slap-daily-checklist",version:1,templateItems:K,days:{}}),G=c=>{if(typeof c!="object"||c===null)return S();const e=c,o=Array.isArray(e.templateItems)?e.templateItems.filter(q).map(d=>({id:d.id,text:d.text.trim()})).filter(d=>d.text):[],p=o.length>0?o:K,f=typeof e.days=="object"&&e.days!==null?e.days:{},I={};for(const[d,h]of Object.entries(f)){if(typeof h!="object"||h===null)continue;const u=h.checkedItemIds,j=Array.isArray(u)?u.filter(x=>typeof x=="string"):[];I[d]={checkedItemIds:j}}return{app:"slap-daily-checklist",version:1,templateItems:p,days:I}},U=c=>{const e=new Date(`${c}T00:00:00`);return Number.isNaN(e.getTime())?c:e.toLocaleDateString()},L=(c,e)=>{const o=new Date(`${c}T00:00:00`);return o.setDate(o.getDate()+e),o.toISOString().slice(0,10)},Q=({ctx:c})=>{const[e,o]=l.useState(S()),[p,f]=l.useState(O),[I,d]=l.useState(""),[h,u]=l.useState(!1),[j,x]=l.useState({}),[v,i]=l.useState(""),k=l.useRef(null);l.useEffect(()=>{(async()=>{const t=await c.vfs.readText(w);if(!t){const s=S();o(s),await c.vfs.writeText(w,JSON.stringify(s,null,2));return}try{const s=JSON.parse(t);o(G(s))}catch{i("Checklist data was unreadable. Reset to defaults."),o(S())}})()},[c.vfs]);const T=async t=>{o(t),await c.vfs.writeText(w,JSON.stringify(t,null,2))},D=l.useMemo(()=>{const t=e.days[p];return new Set((t==null?void 0:t.checkedItemIds)??[])},[e.days,p]),b=l.useMemo(()=>{const t=e.templateItems.length,s=e.templateItems.filter(n=>D.has(n.id)).length;return{total:t,done:s,percent:t===0?0:Math.round(s/t*100)}},[e.templateItems,D]),A=async t=>{const s=e.days[p]??{checkedItemIds:[]},n=new Set(s.checkedItemIds);n.has(t)?n.delete(t):n.add(t);const r={...e,days:{...e.days,[p]:{checkedItemIds:[...n]}}};await T(r)},H=async()=>{i("");const t=I.trim();if(!t){i("Enter item text first.");return}const s={id:crypto.randomUUID(),text:t},n={...e,templateItems:[...e.templateItems,s]};await T(n),d(""),i("Item added.")},J=()=>{const t={};for(const s of e.templateItems)t[s.id]=s.text;x(t),u(!0)},P=async()=>{i("");const t=e.templateItems.map(n=>({...n,text:(j[n.id]??n.text).trim()})).filter(n=>n.text.length>0);if(t.length===0){i("At least one checklist item is required.");return}const s={...e,templateItems:t};await T(s),x({}),u(!1),i("Checklist updated.")},z=()=>{x({}),u(!1),i("")},X=t=>{const s=t.changedTouches[0];k.current={x:s.clientX,y:s.clientY}},Y=(t,s)=>{if(h||!k.current)return;const n=t.changedTouches[0],r=n.clientX-k.current.x,g=n.clientY-k.current.y;k.current=null,Math.abs(r)>=48&&Math.abs(g)<=32&&(A(s),i(r>0?"Checked via swipe.":"Unchecked via swipe."))},M=l.useMemo(()=>Object.entries(e.days).sort(([s],[n])=>n.localeCompare(s)).slice(0,7).map(([s,n])=>{const r=new Set(e.templateItems.map(E=>E.id)),g=n.checkedItemIds.filter(E=>r.has(E)).length,C=e.templateItems.length,$=C===0?0:Math.round(g/C*100);return{dateKey:s,done:g,total:C,percent:$}}),[e.days,e.templateItems]),_=async()=>{const t=await c.vfs.readText(w);if(!t){i("No checklist history to export yet.");return}const s=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(s),r=document.createElement("a");r.href=n,r.download=`daily-checklist-history-${p}.json`,r.click(),URL.revokeObjectURL(n),i("Checklist history exported.")};return a.jsxs(B,{title:"Daily Checklist",children:[a.jsxs("div",{className:"slap-button-row",children:[a.jsx(m,{title:"Prev Day",onClick:()=>f(t=>L(t,-1))}),a.jsx(m,{title:"Today",onClick:()=>f(O())}),a.jsx(m,{title:"Next Day",onClick:()=>f(t=>L(t,1))}),a.jsx(m,{title:"Export History",onClick:()=>void _()}),h?a.jsxs(a.Fragment,{children:[a.jsx(m,{title:"Save Edits",onClick:()=>void P()}),a.jsx(m,{title:"Cancel Edit",onClick:z})]}):a.jsx(m,{title:"Edit Mode",onClick:J})]}),a.jsxs(y,{children:["Date: ",U(p)]}),a.jsxs(y,{children:["Progress: ",b.done,"/",b.total," (",b.percent,"%)"]}),h?null:a.jsx(y,{children:"Swipe left/right on an item to toggle checked."}),v?a.jsx(y,{children:v}):null,e.templateItems.length===0?a.jsx(y,{children:"No checklist items. Add one below."}):null,e.templateItems.map(t=>a.jsx("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.5rem"},onTouchStart:X,onTouchEnd:s=>Y(s,t.id),children:h?a.jsx(N,{label:"Edit Item",value:j[t.id]??t.text,onChange:s=>x(n=>({...n,[t.id]:s}))}):a.jsxs("label",{style:{display:"flex",gap:"0.55rem",alignItems:"center"},children:[a.jsx("input",{type:"checkbox",checked:D.has(t.id),onChange:()=>void A(t.id)}),a.jsx("span",{children:t.text})]})},t.id)),a.jsxs("section",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[a.jsx(R,{title:"Add Item"}),a.jsx(N,{label:"New Item",value:I,onChange:d}),a.jsx(m,{title:"Add To List",onClick:()=>void H()})]}),a.jsx(R,{title:"Recent Completion"}),M.length===0?a.jsx(y,{children:"No history yet."}):null,M.map(t=>a.jsxs(y,{children:[U(t.dateKey),": ",t.done,"/",t.total," (",t.percent,"%)"]},t.dateKey))]})},Z={id:"daily-checklist",title:"Daily Checklist",author:"Joel",description:"Daily checkoffs with editable checklist items.",icon:"âœ…",Preview:F,Application:Q};export{Z as dailyChecklistManifest};
