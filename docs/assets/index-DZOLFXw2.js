import{r as p,j as d}from"./index-CpqaaBWq.js";import{S as L,b,d as C}from"./index-CRg8OV_6.js";const f=4,M="game-2048.json",R=n=>d.jsxs("article",{children:[d.jsx("strong",{children:"2048"}),d.jsx("p",{children:"Swipe to merge tiles and reach 2048."})]}),B=()=>Array.from({length:f},()=>Array.from({length:f},()=>0)),Y=n=>n.map(e=>[...e]),j=n=>{const e=Y(n),o=[];for(let r=0;r<f;r+=1)for(let s=0;s<f;s+=1)e[r][s]===0&&o.push({row:r,col:s});if(o.length===0)return e;const a=o[Math.floor(Math.random()*o.length)];return e[a.row][a.col]=Math.random()<.9?2:4,e},T=()=>{let n=B();return n=j(n),n=j(n),{board:n,score:0,bestScore:0}},E=n=>{const e=n.filter(r=>r!==0),o=[];let a=0;for(let r=0;r<e.length;r+=1)if(e[r]!==0&&e[r]===e[r+1]){const s=e[r]*2;o.push(s),a+=s,r+=1}else o.push(e[r]);for(;o.length<f;)o.push(0);return{merged:o,gained:a}},O=(n,e)=>n.every((o,a)=>o.every((r,s)=>r===e[a][s])),X=(n,e)=>{const o=B();let a=0;if(e==="left"||e==="right")for(let r=0;r<f;r+=1){const s=[...n[r]],h=e==="right"?s.reverse():s,{merged:m,gained:S}=E(h),y=e==="right"?[...m].reverse():m;o[r]=y,a+=S}else for(let r=0;r<f;r+=1){const s=n.map(u=>u[r]),h=e==="down"?[...s].reverse():s,{merged:m,gained:S}=E(h),y=e==="down"?[...m].reverse():m;for(let u=0;u<f;u+=1)o[u][r]=y[u];a+=S}return{nextBoard:o,gained:a,moved:!O(n,o)}},k=n=>{for(let e=0;e<f;e+=1)for(let o=0;o<f;o+=1){const a=n[e][o];if(a===0||e+1<f&&n[e+1][o]===a||o+1<f&&n[e][o+1]===a)return!0}return!1},D=n=>n===0?"tile-empty":n<=4?"tile-low":n<=32?"tile-mid":"tile-high",J=({ctx:n})=>{const[e,o]=p.useState(T),[a,r]=p.useState("Swipe to play."),s=p.useRef(null);p.useEffect(()=>{(async()=>{const i=await n.vfs.readText(M);if(i)try{const t=JSON.parse(i);if(!Array.isArray(t.board)||typeof t.score!="number"||typeof t.bestScore!="number")return;t.board.every(c=>Array.isArray(c)&&c.length===f&&c.every(g=>typeof g=="number"))&&o({board:t.board,score:t.score,bestScore:t.bestScore})}catch{r("Saved game data was invalid. Starting fresh.")}})()},[n.vfs]),p.useEffect(()=>{n.vfs.writeText(M,JSON.stringify(e,null,2))},[n.vfs,e]);const h=i=>{o(t=>{const{nextBoard:l,gained:c,moved:g}=X(t.board,i);if(!g)return t;const w=j(l),v=t.score+c,x=Math.max(t.bestScore,v);return w.some(A=>A.some(G=>G===2048))?r("You reached 2048!"):k(w)?r("Keep going."):r("No moves left. Start a new game."),{board:w,score:v,bestScore:x}})};p.useEffect(()=>{const i=t=>{t.key==="ArrowLeft"&&h("left"),t.key==="ArrowRight"&&h("right"),t.key==="ArrowUp"&&h("up"),t.key==="ArrowDown"&&h("down")};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]);const m=i=>{const t=i.changedTouches[0];s.current={x:t.clientX,y:t.clientY}},S=i=>{if(!s.current)return;const t=i.changedTouches[0],l=t.clientX-s.current.x,c=t.clientY-s.current.y;s.current=null,!(Math.abs(l)<24&&Math.abs(c)<24)&&(Math.abs(l)>Math.abs(c)?h(l>0?"right":"left"):h(c>0?"down":"up"))},y=i=>{const t=i.currentTarget.getBoundingClientRect(),l=i.clientX-t.left,c=i.clientY-t.top,g=[{direction:"left",distance:l},{direction:"right",distance:t.width-l},{direction:"up",distance:c},{direction:"down",distance:t.height-c}];g.sort((x,A)=>x.distance-A.distance);const w=g[0],v=Math.min(t.width,t.height)*.26;w.distance<=v&&h(w.direction)},u=()=>{const i=e.bestScore,t=T();o({...t,bestScore:i}),r("New game started.")},N=p.useMemo(()=>!k(e.board),[e.board]);return d.jsxs(L,{title:"2048",children:[d.jsx(b,{children:"Swipe tiles to combine matching numbers."}),d.jsxs(b,{children:["Score: ",e.score," | Best: ",e.bestScore]}),d.jsx(b,{children:a}),d.jsx(b,{children:"Tap board edges or swipe to move."}),d.jsx("div",{className:"game2048-grid",onTouchStart:m,onTouchEnd:S,onClick:y,children:e.board.flatMap((i,t)=>i.map((l,c)=>d.jsx("div",{className:`game2048-tile ${D(l)}`,children:l===0?"":l},`${t}-${c}`)))}),d.jsx("div",{className:"slap-button-row",children:d.jsx(C,{title:"New Game",onClick:u})}),N?d.jsx(b,{children:"Game over. Tap New Game to restart."}):null]})},K={id:"game-2048",title:"2048",author:"Joel",description:"Swipe and merge tiles to reach 2048.",icon:"ðŸ”¢",Preview:R,Application:J};export{K as game2048Manifest};
