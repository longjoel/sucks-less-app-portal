import{r as l,j as e}from"./index-BdWMYAlF.js";import{S as X,a as J,b as d,c as O,d as h}from"./index-B84B55HR.js";const Y=["your energy","your focus","your patience","your confidence","your boundaries","your rest","your creativity","your relationships","your communication","your priorities","your stress","your attention","your routines","your motivation","your curiosity","your gratitude","your self-talk","your momentum","your courage","your discipline","your clarity","your work","your home life","your friendships","your health","your expectations","your progress","your mindset"],Z=["What is one small thing that could improve {topic} today?","What challenged {topic} the most this week?","Where did you notice growth in {topic} recently?","What would future-you thank you for doing about {topic} today?","What is one belief affecting {topic} right now?","How has {topic} changed over the last month?","What feels unresolved about {topic}?","What helped {topic} most today?","What drained {topic} today?","What does enough look like for {topic} right now?","What boundary could protect {topic} this week?","What habit is helping {topic} and should be kept?","What habit is hurting {topic} and should be changed?","What conversation might improve {topic}?","What are you avoiding that affects {topic}?","What is one brave step you can take for {topic}?","What would make {topic} feel lighter tomorrow?","What did you learn about {topic} today?","What are three words that describe {topic} right now?","What support would strengthen {topic}?","How would you coach a friend through {topic}?","What are you proud of regarding {topic}?","What would simplify {topic} this week?","What does a realistic next step for {topic} look like?","If you gave {topic} 10 focused minutes, what would you do first?"],c=Y.flatMap(a=>Z.map(o=>o.replace("{topic}",a)));if(c.length!==700)throw new Error(`Expected 700 journal prompts, got ${c.length}.`);const P=["None","Great","Good","Okay","Tired","Stressed","Anxious","Sad","Excited","Grateful","Custom"],w="journal.json",tt=a=>e.jsxs("article",{children:[e.jsx("strong",{children:"Journal"}),e.jsx("p",{children:"Mood check-in plus optional writing prompts."})]}),R=a=>{if(typeof a!="object"||a===null)return null;const o=a;return typeof o.id!="string"||typeof o.createdAtIso!="string"||typeof o.updatedAtIso!="string"||typeof o.subject!="string"||typeof o.body!="string"?null:{id:o.id,createdAtIso:o.createdAtIso,updatedAtIso:o.updatedAtIso,subject:o.subject,body:o.body,mood:typeof o.mood=="string"&&o.mood.trim()?o.mood:"Unspecified",promptQuestion:typeof o.promptQuestion=="string"?o.promptQuestion:void 0}},U=a=>{if(typeof a!="object"||a===null)return!1;const o=a;return o.app==="slap-journal"&&o.version===1&&o.encrypted===!1&&Array.isArray(o.entries)},Q=a=>{const o=new Date(a);return Number.isNaN(o.getTime())?{date:"Unknown",time:"Unknown"}:{date:o.toLocaleDateString(),time:o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},x=a=>({app:"slap-journal",version:1,encrypted:!1,entries:a}),b=a=>{if(c.length===0)return"";if(c.length===1)return c[0];let o=c[Math.floor(Math.random()*c.length)];for(;o===a;)o=c[Math.floor(Math.random()*c.length)];return o},k=({html:a,className:o})=>e.jsx("div",{className:o??"slap-markdown",dangerouslySetInnerHTML:{__html:a}}),et=({ctx:a})=>{const[o,E]=l.useState(!0),[S,i]=l.useState(null),[v,N]=l.useState(""),[g,I]=l.useState(""),[y,H]=l.useState(P[0]),[A,_]=l.useState(""),[M,W]=l.useState(()=>b()),[f,u]=l.useState([]),[C,m]=l.useState(!1),T=l.useRef(null),D=l.useMemo(()=>[...f].sort((t,r)=>r.createdAtIso.localeCompare(t.createdAtIso)),[f]),j=async t=>{await a.vfs.writeText(w,JSON.stringify(t,null,2))},L=async t=>{await j(x(t)),u(t)},F=async()=>{E(!0),i(null);try{const t=await a.vfs.readText(w);if(!t){const n=x([]);await j(n),u([]),m(!1);return}const r=JSON.parse(t);if(U(r)){u(r.entries.map(R).filter(n=>n!==null)),m(!1);return}const s=r;if(s&&s.encrypted===!0){m(!0),u([]),i("Legacy locked journal detected. Reset journal data to continue without password.");return}throw new Error("journal.json has an unsupported format.")}catch(t){i(t instanceof Error?t.message:"Failed to load journal.")}finally{E(!1)}};l.useEffect(()=>{F()},[a.vfs]);const B=async()=>{i(null);const t=y==="Custom"?A.trim()||"None":y;if(!g.trim()){i("Entry text is required.");return}const r=new Date().toISOString(),s=`Entry ${new Date(r).toLocaleDateString()} ${new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,n={id:crypto.randomUUID(),createdAtIso:r,updatedAtIso:r,subject:v.trim()||s,body:g.trim(),mood:t,promptQuestion:M||void 0};try{await L([n,...f]),N(""),I(""),W(p=>b(p))}catch(p){i(p instanceof Error?p.message:"Failed to save entry.")}},G=async t=>{i(null);try{await L(f.filter(r=>r.id!==t))}catch(r){i(r instanceof Error?r.message:"Failed to delete entry.")}},$=async()=>{i(null);try{const t=await a.vfs.readText(w);if(!t){i("No journal data found to export.");return}const r=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download="journal.json",n.click(),URL.revokeObjectURL(s)}catch(t){i(t instanceof Error?t.message:"Export failed.")}},z=async t=>{const r=JSON.parse(t);if(!U(r))throw new Error("Only non-encrypted journal.json imports are supported.");const s={...r,entries:r.entries.map(R).filter(n=>n!==null)};await j(s),u(s.entries),m(!1)},q=async t=>{var s;const r=((s=t.target.files)==null?void 0:s[0])??null;if(t.target.value="",!!r){i(null);try{const n=await r.text();await z(n)}catch(n){i(n instanceof Error?n.message:"Import failed.")}}},K=async()=>{i(null);try{await j(x([])),u([]),m(!1)}catch(t){i(t instanceof Error?t.message:"Reset failed.")}};return e.jsxs(X,{title:"Journal",children:[e.jsx(J,{title:"New Entry"}),o?e.jsx(d,{children:"Loading journal..."}):null,S?e.jsxs(d,{children:["Error: ",S]}):null,e.jsx("input",{ref:T,type:"file",accept:"application/json,.json",onChange:t=>void q(t),style:{display:"none"}}),!o&&!C?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Mood"}),e.jsx("select",{className:"slap-input",value:y,onChange:t=>H(t.target.value),children:P.map(t=>e.jsx("option",{value:t,children:t},t))})]}),y==="Custom"?e.jsx(O,{label:"Custom Mood",value:A,onChange:_}):null,e.jsx(O,{label:"Subject (optional)",value:v,onChange:N}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Entry"}),e.jsx("textarea",{className:"slap-input",rows:5,value:g,placeholder:M,onChange:t=>I(t.target.value)})]}),e.jsxs("div",{className:"slap-button-row",children:[e.jsx(h,{title:"New Prompt",onClick:()=>W(t=>b(t))}),e.jsx(h,{title:"Save Entry",onClick:()=>void B()})]}),e.jsx(J,{title:"Entries"}),D.length===0?e.jsx(d,{children:"No entries yet."}):null,D.map(t=>{const r=Q(t.createdAtIso),s=Q(t.updatedAtIso),n=a.renderMarkdown(t.subject),p=a.renderMarkdown(t.body),V=t.promptQuestion?a.renderMarkdown(t.promptQuestion):"";return e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsx("strong",{children:t.subject})}),e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[e.jsx(k,{html:n,className:"slap-markdown slap-markdown-title"}),e.jsxs(d,{children:["Mood: ",t.mood]}),e.jsxs(d,{children:["Created: ",r.date," at ",r.time]}),e.jsxs(d,{children:["Updated: ",s.date," at ",s.time]}),t.body?e.jsx(k,{html:p}):null,t.promptQuestion?e.jsxs(e.Fragment,{children:[e.jsx(d,{children:"Prompt"}),e.jsx(k,{html:V})]}):null,e.jsx(h,{title:"Delete",onClick:()=>void G(t.id)})]})]},t.id)})]}):null,e.jsxs("div",{className:"slap-button-row",children:[e.jsx(h,{title:"Export journal.json",onClick:()=>void $()}),e.jsx(h,{title:"Import journal.json",onClick:()=>{var t;return(t=T.current)==null?void 0:t.click()}}),C?e.jsx(h,{title:"Reset Journal",onClick:()=>void K()}):null]})]})},at={id:"journal",title:"Journal",author:"Joel",description:"Mood-aware journal with 700 optional prompts.",icon:"ðŸ““",Preview:tt,Application:et};export{at as journalManifest};
