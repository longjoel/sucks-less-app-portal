import{r as y,j as e}from"./index-C9LANGui.js";import{S as R,a as A,b as i,d as b}from"./index-Cbq74euv.js";const S="mh-gad7-results.json",T=[0,1,2,3],v=["Not at all","Several days","More than half the days","Nearly every day"],l={id:"gad7",title:"GAD-7",maxScore:21,questions:["Feeling nervous, anxious, or on edge","Not being able to stop or control worrying","Worrying too much about different things","Trouble relaxing","Being so restless that it is hard to sit still","Becoming easily annoyed or irritable","Feeling afraid as if something awful might happen"],getSeverity:r=>r<=4?"Minimal":r<=9?"Mild":r<=14?"Moderate":"Severe"},D=r=>e.jsxs("article",{children:[e.jsx("strong",{children:"GAD-7 Check-in"}),e.jsx("p",{children:"GAD-7 screening with history, trends, and export."})]}),G=r=>{if(typeof r!="object"||r===null)return!1;const s=r;return typeof s.id=="string"&&s.type==="gad7"&&typeof s.createdAtIso=="string"&&Array.isArray(s.answers)&&s.answers.every(p=>typeof p=="number")&&typeof s.score=="number"&&typeof s.severity=="string"},I=r=>({app:"slap-mh-gad7",version:1,records:r}),C=r=>{const s=new Date(r);return Number.isNaN(s.getTime())?"Unknown":`${s.toLocaleDateString()} ${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},k=r=>{const s=[...r].sort((h,m)=>h.createdAtIso.localeCompare(m.createdAtIso));if(s.length===0)return"No trend data yet.";const p=s.slice(-5),u=s.slice(-10,-5),c=p.reduce((h,m)=>h+m.score,0)/p.length;if(u.length===0)return`Recent average: ${c.toFixed(1)}.`;const x=u.reduce((h,m)=>h+m.score,0)/u.length,d=Number((c-x).toFixed(1));return Math.abs(d)<.3?`Recent average: ${c.toFixed(1)} (stable).`:d>0?`Recent average: ${c.toFixed(1)} (up ${d.toFixed(1)} from prior period).`:`Recent average: ${c.toFixed(1)} (down ${Math.abs(d).toFixed(1)} from prior period).`},O=({ctx:r})=>{const[s,p]=y.useState([]),[u,c]=y.useState(()=>new Array(l.questions.length).fill(0)),[x,d]=y.useState(""),h=async t=>{await r.vfs.writeText(S,JSON.stringify(I(t),null,2)),p(t)};y.useEffect(()=>{(async()=>{const t=await r.vfs.readText(S);if(t){try{const n=JSON.parse(t);if(typeof n=="object"&&n!==null){const a=n;Array.isArray(a.records)&&p(a.records.filter(G))}}catch{d("Saved data was unreadable. Starting fresh.")}return}})()},[r.vfs]);const m=(t,n)=>{c(a=>a.map((o,g)=>g===t?n:o))},w=async()=>{const t=u.reduce((o,g)=>o+g,0),n={id:crypto.randomUUID(),type:"gad7",createdAtIso:new Date().toISOString(),answers:u,score:t,severity:l.getSeverity(t)},a=[n,...s].slice(0,300);await h(a),d(`${l.title} saved: ${t}/${l.maxScore} (${n.severity})`),c(new Array(l.questions.length).fill(0))},N=async()=>{const t=await r.vfs.readText(S);if(!t){d("No results to export yet.");return}const n=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download="gad7-results.json",o.click(),URL.revokeObjectURL(a)},f=y.useMemo(()=>[...s].sort((t,n)=>n.createdAtIso.localeCompare(t.createdAtIso)),[s]),j=f[0]??null,$=k(s);return e.jsxs(R,{title:"GAD-7 Check-in",children:[e.jsx(A,{title:"GAD-7 Check-in"}),e.jsx(i,{children:"Screening support only, not a diagnosis. If you are in immediate danger, call 911 or local emergency services."}),e.jsx("div",{className:"slap-button-row",children:e.jsx(b,{title:"Export Results",onClick:()=>void N()})}),j?e.jsxs(i,{children:["Last score: ",j.score,"/",l.maxScore," (",j.severity,")"]}):e.jsx(i,{children:"No completed assessments yet."}),e.jsx(i,{children:$}),x?e.jsx(i,{children:x}):null,e.jsx(A,{title:`History (${f.length})`}),f.length===0?e.jsx(i,{children:"No history yet."}):null,f.map(t=>e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsxs("strong",{children:[C(t.createdAtIso)," | Score ",t.score,"/",l.maxScore," (",t.severity,")"]})}),e.jsx("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:t.answers.map((n,a)=>e.jsxs(i,{children:["Q",a+1,": ",n," (",v[n]??"Unknown",")"]},`${t.id}-${a}`))})]},t.id)),l.questions.map((t,n)=>{const a=u[n]??0;return e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.5rem"},children:[e.jsxs("strong",{children:[n+1,". ",t]}),e.jsxs("div",{className:"slap-slider-row",children:[e.jsx("input",{className:"slap-slider",type:"range",min:0,max:3,step:1,value:a,onChange:o=>m(n,Number(o.target.value))}),e.jsx("div",{className:"slap-slider-labels",children:T.map(o=>e.jsx("span",{children:o},o))})]}),e.jsxs(i,{children:["Selected: ",a," â€” ",v[a]]}),e.jsx(i,{children:v.map((o,g)=>`${g}: ${o}`).join(" | ")})]},t)}),e.jsx(b,{title:`Save ${l.title} Result`,onClick:()=>void w()})]})},L={id:"mh-gad7",title:"GAD-7 Check-in",author:"Joel",description:"GAD-7 screening with history, trends, and export.",icon:"GAD-7",Preview:D,Application:O};export{L as mhGad7Manifest};
