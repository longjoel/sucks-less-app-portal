import{r as i,j as e}from"./index-DTMkQmTp.js";import{S as q,a as D,b as a,d as E}from"./index-DiShqxyg.js";const v="mh-abc-results.json",L=n=>e.jsxs("article",{children:[e.jsx("strong",{children:"ABC Worksheet"}),e.jsx("p",{children:"ABC worksheet entries with trends and export."})]}),U=n=>{if(typeof n!="object"||n===null)return!1;const s=n;return typeof s.id=="string"&&s.type==="abc"&&typeof s.createdAtIso=="string"&&typeof s.activatingEvent=="string"&&typeof s.beliefs=="string"&&typeof s.consequences=="string"&&(typeof s.disputation=="string"||typeof s.disputation>"u")&&(typeof s.effectiveBelief=="string"||typeof s.effectiveBelief>"u")&&(typeof s.distressBefore=="number"||typeof s.distressBefore>"u")&&(typeof s.distressAfter=="number"||typeof s.distressAfter>"u")},O=n=>({app:"slap-mh-abc",version:1,records:n}),R=n=>{const s=new Date(n);return Number.isNaN(s.getTime())?"Unknown":`${s.toLocaleDateString()} ${s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},M=n=>{const s=[...n].sort((r,d)=>r.createdAtIso.localeCompare(d.createdAtIso));if(s.length===0)return"No trend data yet.";const h=s.filter(r=>typeof r.distressBefore=="number"&&typeof r.distressAfter=="number");if(h.length===0)return"Trend tip: include distress before/after (0-10) to track change over time.";const p=h.slice(-5),o=p.reduce((r,d)=>r+(d.distressBefore??0),0)/p.length,c=p.reduce((r,d)=>r+(d.distressAfter??0),0)/p.length,u=o-c;return Math.abs(u)<.2?`Recent distress change: stable (${o.toFixed(1)} -> ${c.toFixed(1)}).`:u>0?`Recent distress change: improved by ${u.toFixed(1)} points (${o.toFixed(1)} -> ${c.toFixed(1)}).`:`Recent distress change: increased by ${Math.abs(u).toFixed(1)} points (${o.toFixed(1)} -> ${c.toFixed(1)}).`},T=n=>{if(!n.trim())return;const s=Number(n);return Number.isNaN(s)||s<0||s>10?Number.NaN:s},P=({ctx:n})=>{const[s,h]=i.useState([]),[p,o]=i.useState(""),[c,u]=i.useState(""),[r,d]=i.useState(""),[b,j]=i.useState(""),[g,y]=i.useState(""),[A,N]=i.useState(""),[w,B]=i.useState(""),[S,C]=i.useState(""),I=async t=>{await n.vfs.writeText(v,JSON.stringify(O(t),null,2)),h(t)};i.useEffect(()=>{(async()=>{const t=await n.vfs.readText(v);if(t){try{const l=JSON.parse(t);if(typeof l=="object"&&l!==null){const f=l;Array.isArray(f.records)&&h(f.records.filter(U))}}catch{o("Saved data was unreadable. Starting fresh.")}return}})()},[n.vfs]);const $=async()=>{if(!c.trim()||!r.trim()||!b.trim()){o("Please fill A (event), B (beliefs), and C (consequences).");return}const t=T(w),l=T(S);if(Number.isNaN(t)||Number.isNaN(l)){o("Distress values must be between 0 and 10.");return}const m=[{id:crypto.randomUUID(),type:"abc",createdAtIso:new Date().toISOString(),activatingEvent:c.trim(),beliefs:r.trim(),consequences:b.trim(),disputation:g.trim()||void 0,effectiveBelief:A.trim()||void 0,distressBefore:t,distressAfter:l},...s].slice(0,300);await I(m),o("ABC worksheet saved."),u(""),d(""),j(""),y(""),N(""),B(""),C("")},W=async()=>{const t=await n.vfs.readText(v);if(!t){o("No results to export yet.");return}const l=new Blob([t],{type:"application/json"}),f=URL.createObjectURL(l),m=document.createElement("a");m.href=f,m.download="abc-worksheet-results.json",m.click(),URL.revokeObjectURL(f)},x=i.useMemo(()=>[...s].sort((t,l)=>l.createdAtIso.localeCompare(t.createdAtIso)),[s]),k=x[0]??null,F=M(s);return e.jsxs(q,{title:"ABC Worksheet",children:[e.jsx(D,{title:"ABC Worksheet"}),e.jsx(a,{children:"Worksheet support only, not a diagnosis. If you are in immediate danger, call 911 or local emergency services."}),e.jsx("div",{className:"slap-button-row",children:e.jsx(E,{title:"Export Results",onClick:()=>void W()})}),k?e.jsxs(a,{children:["Last ABC worksheet saved: ",R(k.createdAtIso)]}):e.jsx(a,{children:"No ABC worksheets saved yet."}),e.jsx(a,{children:F}),p?e.jsx(a,{children:p}):null,e.jsx(D,{title:`History (${x.length})`}),x.length===0?e.jsx(a,{children:"No history yet."}):null,x.map(t=>e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsxs("strong",{children:[R(t.createdAtIso)," | ABC Worksheet"]})}),e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[e.jsxs(a,{children:["A: ",t.activatingEvent]}),e.jsxs(a,{children:["B: ",t.beliefs]}),e.jsxs(a,{children:["C: ",t.consequences]}),t.disputation?e.jsxs(a,{children:["D: ",t.disputation]}):null,t.effectiveBelief?e.jsxs(a,{children:["E: ",t.effectiveBelief]}):null,typeof t.distressBefore=="number"?e.jsxs(a,{children:["Distress before: ",t.distressBefore,"/10"]}):null,typeof t.distressAfter=="number"?e.jsxs(a,{children:["Distress after: ",t.distressAfter,"/10"]}):null]})]},t.id)),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"A: Activating Event"}),e.jsx("textarea",{className:"slap-input",rows:3,value:c,onChange:t=>u(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"B: Beliefs / Thoughts"}),e.jsx("textarea",{className:"slap-input",rows:3,value:r,onChange:t=>d(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"C: Consequences (emotions/behaviors)"}),e.jsx("textarea",{className:"slap-input",rows:3,value:b,onChange:t=>j(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"D: Dispute / Reframe (optional)"}),e.jsx("textarea",{className:"slap-input",rows:2,value:g,onChange:t=>y(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"E: Effective New Belief (optional)"}),e.jsx("textarea",{className:"slap-input",rows:2,value:A,onChange:t=>N(t.target.value)})]}),e.jsxs("div",{className:"slap-button-row",children:[e.jsxs("label",{className:"slap-input-wrap",style:{maxWidth:"140px"},children:[e.jsx("span",{children:"Distress Before (0-10)"}),e.jsx("input",{className:"slap-input",type:"number",min:0,max:10,value:w,onChange:t=>B(t.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",style:{maxWidth:"140px"},children:[e.jsx("span",{children:"Distress After (0-10)"}),e.jsx("input",{className:"slap-input",type:"number",min:0,max:10,value:S,onChange:t=>C(t.target.value)})]})]}),e.jsx(E,{title:"Save ABC Worksheet",onClick:()=>void $()})]})},H={id:"mh-abc",title:"ABC Worksheet",author:"Joel",description:"ABC worksheet entries with trends and export.",icon:"ABC",Preview:L,Application:P};export{H as mhAbcManifest};
