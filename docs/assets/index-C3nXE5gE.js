import{r as A,j as a}from"./index-DTMkQmTp.js";import{S as U,a as V,b as N,d as v}from"./index-DiShqxyg.js";const F="sudoku-state.json",i=9,p=3,L={easy:38,medium:30,hard:24},Y=s=>a.jsxs("article",{children:[a.jsx("strong",{children:"Sudoku"}),a.jsx("p",{children:"Fill the grid with numbers 1-9. Pick easy, medium, or hard."})]}),Z=()=>Array.from({length:i},()=>Array.from({length:i},()=>0)),k=s=>s.map(t=>[...t]),P=s=>{const t=[...s];for(let o=t.length-1;o>0;o-=1){const e=Math.floor(Math.random()*(o+1));[t[o],t[e]]=[t[e],t[o]]}return t},j=(s,t,o,e)=>{for(let l=0;l<i;l+=1)if(s[t][l]===e||s[l][o]===e)return!1;const n=Math.floor(t/p)*p,r=Math.floor(o/p)*p;for(let l=n;l<n+p;l+=1)for(let f=r;f<r+p;f+=1)if(s[l][f]===e)return!1;return!0},$=s=>{let t=null,o=10;for(let e=0;e<i;e+=1)for(let n=0;n<i;n+=1){if(s[e][n]!==0)continue;let r=0;for(let l=1;l<=i;l+=1)j(s,e,n,l)&&(r+=1);if(r<o&&(o=r,t={row:e,col:n},o===1))return t}return t},D=s=>{const t=$(s);if(!t)return!0;const{row:o,col:e}=t,n=P(Array.from({length:i},(r,l)=>l+1).filter(r=>j(s,o,e,r)));for(const r of n){if(s[o][e]=r,D(s))return!0;s[o][e]=0}return!1},R=(s,t=2)=>{const o=$(s);if(!o)return 1;const{row:e,col:n}=o;let r=0;for(let l=1;l<=i;l+=1)if(j(s,e,n,l)){if(s[e][n]=l,r+=R(s,t),r>=t)return s[e][n]=0,r;s[e][n]=0}return r},q=()=>{const s=Z();return D(s),s},K=s=>{const t=q(),o=k(t),e=L[s],n=P(Array.from({length:i*i},(r,l)=>({row:Math.floor(l/i),col:l%i})));for(const r of n){if(o.flat().filter(C=>C!==0).length<=e)break;const{row:f,col:h}=r,m=o[f][h];if(m===0)continue;o[f][h]=0;const w=k(o);R(w,2)!==1&&(o[f][h]=m)}return{puzzle:o,solution:t}},B=s=>s.map(t=>t.map(o=>o!==0)),Q=(s,t)=>s.every((o,e)=>o.every((n,r)=>n===t[e][r])),W=s=>Array.isArray(s)&&s.length===i&&s.every(t=>Array.isArray(t)&&t.length===i&&t.every(o=>typeof o=="boolean")),E=(s,t,o)=>{const e=k(s);return e[t][o]=0,Array.from({length:i},(n,r)=>r+1).filter(n=>j(e,t,o,n))},O=(s,t=!0)=>{const o=new Date().toISOString(),{puzzle:e,solution:n}=K(s);return{puzzle:e,solution:n,current:k(e),fixed:B(e),difficulty:s,status:"playing",showNotes:t,startedAtIso:o,updatedAtIso:o}},X=s=>{try{const t=JSON.parse(s);if(!Array.isArray(t.puzzle)||!Array.isArray(t.solution)||!Array.isArray(t.current))return null;const o=m=>Array.isArray(m)&&m.length===i&&m.every(w=>Array.isArray(w)&&w.length===i&&w.every(b=>typeof b=="number"));if(!o(t.puzzle)||!o(t.solution)||!o(t.current))return null;const e=t.difficulty==="medium"||t.difficulty==="hard"?t.difficulty:"easy",n=W(t.fixed)?t.fixed:B(t.puzzle),r=t.status==="won"?"won":"playing",l=typeof t.showNotes=="boolean"?t.showNotes:!0,f=typeof t.startedAtIso=="string"?t.startedAtIso:new Date().toISOString(),h=typeof t.updatedAtIso=="string"?t.updatedAtIso:f;return{puzzle:t.puzzle,solution:t.solution,current:t.current,fixed:n,difficulty:e,status:r,showNotes:l,startedAtIso:f,updatedAtIso:h}}catch{return null}},tt=s=>{const t=Array.from({length:i},()=>Array.from({length:i},()=>!1));for(let o=0;o<i;o+=1){const e=new Map;for(let n=0;n<i;n+=1){const r=s[o][n];if(r===0)continue;const l=e.get(r)??[];l.push(n),e.set(r,l)}for(const[,n]of e.entries())if(n.length>1)for(const r of n)t[o][r]=!0}for(let o=0;o<i;o+=1){const e=new Map;for(let n=0;n<i;n+=1){const r=s[n][o];if(r===0)continue;const l=e.get(r)??[];l.push(n),e.set(r,l)}for(const[,n]of e.entries())if(n.length>1)for(const r of n)t[r][o]=!0}for(let o=0;o<p;o+=1)for(let e=0;e<p;e+=1){const n=new Map;for(let r=o*p;r<o*p+p;r+=1)for(let l=e*p;l<e*p+p;l+=1){const f=s[r][l];if(f===0)continue;const h=n.get(f)??[];h.push({row:r,col:l}),n.set(f,h)}for(const[,r]of n.entries())if(r.length>1)for(const l of r)t[l.row][l.col]=!0}return t},et=({ctx:s})=>{const[t,o]=A.useState(()=>O("easy")),[e,n]=A.useState(null),[r,l]=A.useState("New easy puzzle ready.");A.useEffect(()=>{(async()=>{const u=await s.vfs.readText(F);if(!u)return;const c=X(u);c&&(o(c),l(`Resumed ${c.difficulty} puzzle.`))})()},[s.vfs]),A.useEffect(()=>{s.vfs.writeText(F,JSON.stringify(t,null,2))},[s.vfs,t]);const f=A.useMemo(()=>tt(t.current),[t.current]),h=u=>{o(c=>O(u,c.showNotes)),n(null),l(`New ${u} puzzle ready.`)},m=()=>{o(u=>({...u,showNotes:!u.showNotes,updatedAtIso:new Date().toISOString()}))},w=u=>{if(!e)return;const{row:c,col:y}=e;if(!(t.fixed[c][y]||t.status!=="playing")){if(u!==0&&!E(t.current,c,y).includes(u)){l("That number can't go there.");return}o(d=>{const g=k(d.current);g[c][y]=u;const z=g.flat().every(_=>_!==0),S=z&&Q(g,d.solution),G=S?"won":"playing";return z&&!S?l("Everything is filled, but something doesn't match yet."):S&&l("Puzzle solved!"),{...d,current:g,status:G,updatedAtIso:new Date().toISOString()}})}},b=()=>w(0),C=t.current.flat().filter(u=>u!==0).length,T=t.status==="won",x=e!==null&&t.status==="playing"&&!t.fixed[e.row][e.col],I=A.useMemo(()=>!e||!x?[]:E(t.current,e.row,e.col),[x,t.current,e]);return a.jsxs(U,{title:"Sudoku",children:[a.jsx(V,{title:"Sudoku"}),a.jsx(N,{children:"Fill every row, column, and 3Ã—3 box with 1â€“9."}),a.jsx(N,{children:r}),a.jsxs("div",{className:"slap-button-row",children:[a.jsx(v,{title:"Easy",onClick:()=>h("easy")}),a.jsx(v,{title:"Medium",onClick:()=>h("medium")}),a.jsx(v,{title:"Hard",onClick:()=>h("hard")}),a.jsx(v,{title:t.showNotes?"Hide Notes":"Show Notes",onClick:m})]}),a.jsxs(N,{children:["Difficulty: ",t.difficulty," Â· Filled: ",C,"/81 ",T?"Â· Completed":""]}),a.jsx("div",{className:"sudoku-grid",children:t.current.map((u,c)=>u.map((y,d)=>{const g=t.fixed[c][d],z=(e==null?void 0:e.row)===c&&(e==null?void 0:e.col)===d,S=f[c][d],G=["sudoku-cell",g?"is-fixed":"",z?"is-selected":"",S?"is-conflict":"",c%3===0?"border-top":"",d%3===0?"border-left":"",c===i-1?"border-bottom":"",d===i-1?"border-right":""].filter(Boolean).join(" ");return a.jsx("button",{type:"button",className:G,onClick:()=>n({row:c,col:d}),"aria-label":`Row ${c+1} Column ${d+1}`,children:y!==0?y:t.showNotes?a.jsx("span",{className:"sudoku-notes",children:Array.from({length:9},(_,H)=>{const M=H+1,J=E(t.current,c,d).includes(M);return a.jsx("span",{className:`sudoku-note${J?"":" is-hidden"}`,children:M},M)})}):""},`cell-${c}-${d}`)}))}),a.jsxs("div",{className:"sudoku-keypad",children:[Array.from({length:9},(u,c)=>{const y=c+1,d=I.includes(y);return a.jsx("button",{type:"button",className:"sudoku-key",onClick:()=>w(y),disabled:!x||!d,children:y},y)}),a.jsx("button",{type:"button",className:"sudoku-key sudoku-key-clear",onClick:b,disabled:!x,children:"Erase"})]}),T?a.jsx(N,{children:"Puzzle solved! Start a new game to play again."}):null]})},nt={id:"sudoku",title:"Sudoku",author:"Joel",description:"Generate easy, medium, or hard Sudoku puzzles.",icon:"ðŸ”¢",Preview:Y,Application:et};export{nt as sudokuManifest};
