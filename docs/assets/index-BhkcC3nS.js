import{r as n,j as e}from"./index-CpqaaBWq.js";import{b as l,d as P}from"./index-CRg8OV_6.js";const x="compass-state.json",A=o=>e.jsxs("article",{children:[e.jsx("strong",{children:"Compass"}),e.jsx("p",{children:"Simple heading compass using device orientation sensors."})]}),g=o=>(o%360+360)%360,H=o=>{const t=["N","NE","E","SE","S","SW","W","NW"],d=Math.round(o/45)%t.length;return t[d]},O=({ctx:o})=>{const[t,d]=n.useState(null),[u,m]=n.useState("unknown"),[S,r]=n.useState("Tap Start Compass to begin."),[b,h]=n.useState(!1),[i,j]=n.useState(null),[E,c]=n.useState("Location not started.");n.useEffect(()=>{(async()=>{const a=await o.vfs.readText(x);if(a)try{const s=JSON.parse(a);typeof s.lastHeading=="number"&&d(g(s.lastHeading))}catch{}})()},[o.vfs]),n.useEffect(()=>{o.vfs.writeText(x,JSON.stringify({lastHeading:t},null,2))},[o.vfs,t]),n.useEffect(()=>{if(u!=="granted")return;let a=!1,s=null;const L=window.setTimeout(()=>{a||(h(!0),r("No heading sensor found. Entering chaos compass mode."),s=window.setInterval(()=>{d(p=>g((p??0)+20+Math.random()*95))},90))},2200),v=p=>{let f=null;const w=p;typeof w.webkitCompassHeading=="number"?f=g(w.webkitCompassHeading):typeof p.alpha=="number"&&(f=g(360-p.alpha)),f!==null&&(a=!0,h(!1),s!==null&&(window.clearInterval(s),s=null),d(f),r("Compass active."))};return window.addEventListener("deviceorientation",v),()=>{window.clearTimeout(L),s!==null&&window.clearInterval(s),window.removeEventListener("deviceorientation",v)}},[u]),n.useEffect(()=>{if(u!=="granted")return;if(typeof navigator>"u"||!navigator.geolocation){c("GPS unavailable on this device/browser.");return}c("Requesting location...");const a=navigator.geolocation.watchPosition(s=>{j({lat:s.coords.latitude,lon:s.coords.longitude,accuracyMeters:Number.isFinite(s.coords.accuracy)?s.coords.accuracy:null}),c("Location active.")},s=>{s.code===s.PERMISSION_DENIED?c("Location permission denied."):s.code===s.POSITION_UNAVAILABLE?c("Location unavailable."):s.code===s.TIMEOUT?c("Location request timed out."):c("Unable to read location.")},{enableHighAccuracy:!0,maximumAge:4e3,timeout:1e4});return()=>navigator.geolocation.clearWatch(a)},[u]);const N=async()=>{if(typeof window>"u"||typeof DeviceOrientationEvent>"u"){m("unsupported"),r("Orientation sensors are not supported on this device/browser.");return}const a=DeviceOrientationEvent;if(typeof a.requestPermission=="function"){try{await a.requestPermission()==="granted"?(m("granted"),r("Permission granted. Move your device to calibrate.")):(m("denied"),r("Permission denied. Enable motion/orientation access in browser settings."))}catch{m("denied"),r("Permission request failed.")}return}m("granted"),r("Compass started.")},y=n.useMemo(()=>t===null?"--":H(t),[t]),C=n.useMemo(()=>t===null?"--Â°":`${Math.round(t)}Â°`,[t]),M=t===null?0:t,T=i?i.lat.toFixed(5):"--",I=i?i.lon.toFixed(5):"--";return e.jsxs("section",{className:"slap-shell",children:[e.jsx(l,{children:"Basic compass using device orientation sensors."}),e.jsxs(l,{children:["Status: ",S]}),e.jsxs(l,{children:["Heading: ",e.jsx("strong",{children:C})," (",y,")"]}),b?e.jsx(l,{children:"Demo mode: spinning wildly for dramatic effect."}):null,e.jsxs(l,{children:["GPS: ",e.jsx("strong",{children:T}),", ",e.jsx("strong",{children:I}),(i==null?void 0:i.accuracyMeters)!==null&&i?` (Â±${Math.round(i.accuracyMeters)}m)`:""]}),e.jsxs(l,{children:["Location status: ",E]}),e.jsx("div",{className:"compass-dial-wrap","aria-label":"Compass dial",children:e.jsxs("div",{className:"compass-dial",children:[e.jsx("div",{className:"compass-marker compass-n",children:"N"}),e.jsx("div",{className:"compass-marker compass-e",children:"E"}),e.jsx("div",{className:"compass-marker compass-s",children:"S"}),e.jsx("div",{className:"compass-marker compass-w",children:"W"}),e.jsx("div",{className:"compass-needle",style:{transform:`translate(-50%, -100%) rotate(${M}deg)`}}),e.jsx("div",{className:"compass-center-dot"})]})}),e.jsx("div",{className:"slap-button-row",children:e.jsx(P,{title:"Start Compass",onClick:()=>void N()})}),u==="unsupported"?e.jsx(l,{children:"Tip: Compass support is best on mobile browsers with sensor APIs enabled."}):null]})},q={id:"compass",title:"Compass",author:"Joel",description:"Basic heading compass using device orientation sensors.",icon:"ðŸ§­",Preview:A,Application:O};export{q as compassManifest};
