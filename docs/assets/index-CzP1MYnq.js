import{r as m,j as u}from"./index-CrG1lx73.js";import{S as b,a as F,b as S,d as M}from"./index-CU8zPUNz.js";const y="minesweeper-state.json",j=10,x=8,R=10,T=o=>u.jsxs("article",{children:[u.jsx("strong",{children:"Minesweeper"}),u.jsx("p",{children:"Reveal all safe tiles and avoid mines."})]}),$=(o,e)=>Array.from({length:o},()=>Array.from({length:e},()=>({hasMine:!1,isRevealed:!1,isFlagged:!1,adjacentMines:0}))),v=(o,e,l,f)=>{const i=[];for(let c=-1;c<=1;c+=1)for(let p=-1;p<=1;p+=1){if(c===0&&p===0)continue;const r=o+c,s=e+p;r>=0&&r<l&&s>=0&&s<f&&i.push({row:r,col:s})}return i},C=(o,e,l,f)=>{const i=o.length,c=o[0].length,p=new Set([`${l}:${f}`]);for(const s of v(l,f,i,c))p.add(`${s.row}:${s.col}`);const r=[];for(let s=0;s<i;s+=1)for(let t=0;t<c;t+=1)p.has(`${s}:${t}`)||r.push({row:s,col:t});for(let s=r.length-1;s>0;s-=1){const t=Math.floor(Math.random()*(s+1));[r[s],r[t]]=[r[t],r[s]]}for(let s=0;s<e&&s<r.length;s+=1){const t=r[s];o[t.row][t.col].hasMine=!0}for(let s=0;s<i;s+=1)for(let t=0;t<c;t+=1)o[s][t].adjacentMines=v(s,t,i,c).filter(a=>o[a.row][a.col].hasMine).length},I=o=>o.map(e=>e.map(l=>({...l}))),E=(o,e,l)=>{const f=o.length,i=o[0].length,c=[{row:e,col:l}],p=new Set;for(;c.length>0;){const r=c.shift(),s=`${r.row}:${r.col}`;if(p.has(s))continue;p.add(s);const t=o[r.row][r.col];if(!(t.isFlagged||t.isRevealed)&&(t.isRevealed=!0,t.adjacentMines===0&&!t.hasMine))for(const a of v(r.row,r.col,f,i)){const n=o[a.row][a.col];!n.isRevealed&&!n.isFlagged&&c.push(a)}}},N=o=>{for(const e of o)for(const l of e)if(!l.hasMine&&!l.isRevealed)return!1;return!0},k=o=>{for(const e of o)for(const l of e)l.hasMine&&(l.isRevealed=!0)},A=()=>({rows:j,cols:x,mines:R,board:$(j,x),status:"ready",mode:"reveal",elapsedSeconds:0,startedAtIso:null}),O=o=>{if(typeof o!="object"||o===null)return!1;const e=o;if(typeof e.rows!="number"||typeof e.cols!="number"||typeof e.mines!="number"||!Array.isArray(e.board)||e.status!=="ready"&&e.status!=="playing"&&e.status!=="won"&&e.status!=="lost"||e.mode!=="reveal"&&e.mode!=="flag"||typeof e.elapsedSeconds!="number")return!1;const l=e.board;if(l.length!==e.rows)return!1;for(const f of l){if(!Array.isArray(f)||f.length!==e.cols)return!1;for(const i of f){if(typeof i!="object"||i===null)return!1;const c=i;if(typeof c.hasMine!="boolean"||typeof c.isRevealed!="boolean"||typeof c.isFlagged!="boolean"||typeof c.adjacentMines!="number")return!1}}return!0},B=({ctx:o})=>{const[e,l]=m.useState(A),[f,i]=m.useState("Tap a tile to start.");m.useEffect(()=>{(async()=>{const t=await o.vfs.readText(y);if(t)try{const a=JSON.parse(t);O(a)&&(l(a),a.status==="won"&&i("You won. Nice work."),a.status==="lost"&&i("You hit a mine. Start a new game."))}catch{i("Saved game data was invalid. Starting fresh.")}})()},[o.vfs]),m.useEffect(()=>{o.vfs.writeText(y,JSON.stringify(e,null,2))},[o.vfs,e]),m.useEffect(()=>{if(e.status!=="playing")return;const t=setInterval(()=>{l(a=>({...a,elapsedSeconds:a.elapsedSeconds+1}))},1e3);return()=>clearInterval(t)},[e.status]);const c=()=>{l(A()),i("Tap a tile to start.")},p=()=>{l(t=>({...t,mode:t.mode==="reveal"?"flag":"reveal"}))},r=(t,a)=>{l(n=>{if(n.status==="won"||n.status==="lost")return n;const d=I(n.board),g=d[t][a];if(n.mode==="flag")return g.isRevealed||(g.isFlagged=!g.isFlagged,i(g.isFlagged?"Flag placed.":"Flag removed.")),{...n,board:d};if(g.isFlagged||g.isRevealed)return n;let h=n.status,w=n.startedAtIso;return n.status==="ready"&&(C(d,n.mines,t,a),h="playing",w=new Date().toISOString()),d[t][a].hasMine?(k(d),i("Boom. You hit a mine."),{...n,board:d,status:"lost",startedAtIso:w}):(E(d,t,a),N(d)?(i("You cleared the minefield."),{...n,board:d,status:"won",startedAtIso:w}):{...n,board:d,status:h,startedAtIso:w})})},s=m.useMemo(()=>{const t=e.board.flat().filter(a=>a.isFlagged).length;return Math.max(0,e.mines-t)},[e.board,e.mines]);return u.jsxs(b,{title:"Minesweeper",children:[u.jsx(F,{title:"Minesweeper"}),u.jsx(S,{children:f}),u.jsxs(S,{children:["Mode: ",e.mode==="reveal"?"Reveal":"Flag"," | Mines left: ",s," | Time: ",e.elapsedSeconds,"s"]}),u.jsxs("div",{className:"slap-button-row",children:[u.jsx(M,{title:e.mode==="reveal"?"Switch To Flag":"Switch To Reveal",onClick:p}),u.jsx(M,{title:"New Game",onClick:c})]}),u.jsx("div",{className:"minesweeper-grid",style:{gridTemplateColumns:`repeat(${e.cols}, 1fr)`},children:e.board.flatMap((t,a)=>t.map((n,d)=>{const g=n.isFlagged?"ðŸš©":n.isRevealed?n.hasMine?"ðŸ’£":n.adjacentMines||"":"",h=["minesweeper-cell",n.isRevealed?"ms-revealed":"ms-hidden",n.isFlagged?"ms-flagged":""].join(" ").trim();return u.jsx("button",{type:"button",className:h,onClick:()=>r(a,d),children:g},`${a}-${d}`)}))})]})},G={id:"minesweeper",title:"Minesweeper",author:"Joel",description:"Classic minesweeper with reveal/flag mode.",icon:"ðŸ’£",Preview:T,Application:B};export{G as minesweeperManifest};
