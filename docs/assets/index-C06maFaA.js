import{r as l,j as e}from"./index-BLlukh7v.js";import{S as X,a as O,b as d,c as J,d as h}from"./index-DXkWroqa.js";const Y=["your energy","your focus","your patience","your confidence","your boundaries","your rest","your creativity","your relationships","your communication","your priorities","your stress","your attention","your routines","your motivation","your curiosity","your gratitude","your self-talk","your momentum","your courage","your discipline","your clarity","your work","your home life","your friendships","your health","your expectations","your progress","your mindset"],Z=["What is one small thing that could improve {topic} today?","What challenged {topic} the most this week?","Where did you notice growth in {topic} recently?","What would future-you thank you for doing about {topic} today?","What is one belief affecting {topic} right now?","How has {topic} changed over the last month?","What feels unresolved about {topic}?","What helped {topic} most today?","What drained {topic} today?","What does enough look like for {topic} right now?","What boundary could protect {topic} this week?","What habit is helping {topic} and should be kept?","What habit is hurting {topic} and should be changed?","What conversation might improve {topic}?","What are you avoiding that affects {topic}?","What is one brave step you can take for {topic}?","What would make {topic} feel lighter tomorrow?","What did you learn about {topic} today?","What are three words that describe {topic} right now?","What support would strengthen {topic}?","How would you coach a friend through {topic}?","What are you proud of regarding {topic}?","What would simplify {topic} this week?","What does a realistic next step for {topic} look like?","If you gave {topic} 10 focused minutes, what would you do first?"],c=Y.flatMap(r=>Z.map(o=>o.replace("{topic}",r)));if(c.length!==700)throw new Error(`Expected 700 journal prompts, got ${c.length}.`);const P=["None","Great","Good","Okay","Tired","Stressed","Anxious","Sad","Excited","Grateful","Custom"],b="journal.json",tt=r=>e.jsxs("article",{children:[e.jsx("strong",{children:"Journal"}),e.jsx("p",{children:"Mood check-in plus optional writing prompts."})]}),R=r=>{if(typeof r!="object"||r===null)return null;const o=r;return typeof o.id!="string"||typeof o.createdAtIso!="string"||typeof o.updatedAtIso!="string"||typeof o.subject!="string"||typeof o.body!="string"?null:{id:o.id,createdAtIso:o.createdAtIso,updatedAtIso:o.updatedAtIso,subject:o.subject,body:o.body,mood:typeof o.mood=="string"&&o.mood.trim()?o.mood:"Unspecified",promptQuestion:typeof o.promptQuestion=="string"?o.promptQuestion:void 0}},U=r=>{if(typeof r!="object"||r===null)return!1;const o=r;return o.app==="slap-journal"&&o.version===1&&o.encrypted===!1&&Array.isArray(o.entries)},Q=r=>{const o=new Date(r);return Number.isNaN(o.getTime())?{date:"Unknown",time:"Unknown"}:{date:o.toLocaleDateString(),time:o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},k=r=>({app:"slap-journal",version:1,encrypted:!1,entries:r}),E=r=>{if(c.length===0)return"";if(c.length===1)return c[0];let o=c[Math.floor(Math.random()*c.length)];for(;o===r;)o=c[Math.floor(Math.random()*c.length)];return o},g=({html:r,className:o})=>e.jsx("div",{className:o??"slap-markdown",dangerouslySetInnerHTML:{__html:r}}),et=({ctx:r})=>{const[o,S]=l.useState(!0),[v,i]=l.useState(null),[N,I]=l.useState(""),[w,M]=l.useState(""),[y,H]=l.useState(P[0]),[A,_]=l.useState(""),[x,W]=l.useState(()=>E()),[f,u]=l.useState([]),[C,m]=l.useState(!1),T=l.useRef(null),D=l.useMemo(()=>[...f].sort((t,n)=>n.createdAtIso.localeCompare(t.createdAtIso)),[f]),j=async t=>{await r.vfs.writeText(b,JSON.stringify(t,null,2))},L=async t=>{await j(k(t)),u(t)},F=async()=>{S(!0),i(null);try{const t=await r.vfs.readText(b);if(!t){const a=k([]);await j(a),u([]),m(!1);return}const n=JSON.parse(t);if(U(n)){u(n.entries.map(R).filter(a=>a!==null)),m(!1);return}const s=n;if(s&&s.encrypted===!0){m(!0),u([]),i("Legacy locked journal detected. Reset journal data to continue without password.");return}throw new Error("journal.json has an unsupported format.")}catch(t){i(t instanceof Error?t.message:"Failed to load journal.")}finally{S(!1)}};l.useEffect(()=>{F()},[r.vfs]);const B=async()=>{i(null);const t=y==="Custom"?A.trim()||"None":y;if(!w.trim()){i("Entry text is required.");return}const n=new Date().toISOString(),s=`Entry ${new Date(n).toLocaleDateString()} ${new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,a={id:crypto.randomUUID(),createdAtIso:n,updatedAtIso:n,subject:N.trim()||s,body:w.trim(),mood:t,promptQuestion:x||void 0};try{await L([a,...f]),I(""),M(""),W(p=>E(p))}catch(p){i(p instanceof Error?p.message:"Failed to save entry.")}},G=async t=>{i(null);try{await L(f.filter(n=>n.id!==t))}catch(n){i(n instanceof Error?n.message:"Failed to delete entry.")}},$=async()=>{i(null);try{const t=await r.vfs.readText(b);if(!t){i("No journal data found to export.");return}const n=new Blob([t],{type:"application/json"}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download="journal.json",a.click(),URL.revokeObjectURL(s)}catch(t){i(t instanceof Error?t.message:"Export failed.")}},z=async t=>{const n=JSON.parse(t);if(!U(n))throw new Error("Only non-encrypted journal.json imports are supported.");const s={...n,entries:n.entries.map(R).filter(a=>a!==null)};await j(s),u(s.entries),m(!1)},q=async t=>{var s;const n=((s=t.target.files)==null?void 0:s[0])??null;if(t.target.value="",!!n){i(null);try{const a=await n.text();await z(a)}catch(a){i(a instanceof Error?a.message:"Import failed.")}}},K=async()=>{i(null);try{await j(k([])),u([]),m(!1)}catch(t){i(t instanceof Error?t.message:"Reset failed.")}};return e.jsxs(X,{title:"Journal",children:[e.jsx(O,{title:"New Entry"}),o?e.jsx(d,{children:"Loading journal..."}):null,v?e.jsxs(d,{children:["Error: ",v]}):null,e.jsx("input",{ref:T,type:"file",accept:"application/json,.json",onChange:t=>void q(t),style:{display:"none"}}),!o&&!C?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Mood"}),e.jsx("select",{className:"slap-input",value:y,onChange:t=>H(t.target.value),children:P.map(t=>e.jsx("option",{value:t,children:t},t))})]}),y==="Custom"?e.jsx(J,{label:"Custom Mood",value:A,onChange:_}):null,e.jsx(J,{label:"Subject (optional)",value:N,onChange:I}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Entry"}),e.jsx("textarea",{className:"slap-input",rows:5,value:w,placeholder:x,onChange:t=>M(t.target.value)})]}),e.jsx(d,{children:"Optional prompt:"}),e.jsx(g,{html:r.renderMarkdown(x)}),e.jsxs("div",{className:"slap-button-row",children:[e.jsx(h,{title:"New Prompt",onClick:()=>W(t=>E(t))}),e.jsx(h,{title:"Save Entry",onClick:()=>void B()})]}),e.jsx(O,{title:"Entries"}),D.length===0?e.jsx(d,{children:"No entries yet."}):null,D.map(t=>{const n=Q(t.createdAtIso),s=Q(t.updatedAtIso),a=r.renderMarkdown(t.subject),p=r.renderMarkdown(t.body),V=t.promptQuestion?r.renderMarkdown(t.promptQuestion):"";return e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsx("strong",{children:t.subject})}),e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[e.jsx(g,{html:a,className:"slap-markdown slap-markdown-title"}),e.jsxs(d,{children:["Mood: ",t.mood]}),e.jsxs(d,{children:["Created: ",n.date," at ",n.time]}),e.jsxs(d,{children:["Updated: ",s.date," at ",s.time]}),t.body?e.jsx(g,{html:p}):null,t.promptQuestion?e.jsxs(e.Fragment,{children:[e.jsx(d,{children:"Prompt"}),e.jsx(g,{html:V})]}):null,e.jsx(h,{title:"Delete",onClick:()=>void G(t.id)})]})]},t.id)})]}):null,e.jsxs("div",{className:"slap-button-row",children:[e.jsx(h,{title:"Export journal.json",onClick:()=>void $()}),e.jsx(h,{title:"Import journal.json",onClick:()=>{var t;return(t=T.current)==null?void 0:t.click()}}),C?e.jsx(h,{title:"Reset Journal",onClick:()=>void K()}):null]})]})},nt={id:"journal",title:"Journal",author:"Joel",description:"Mood-aware journal with 700 optional prompts.",icon:"ðŸ““",Preview:tt,Application:et};export{nt as journalManifest};
