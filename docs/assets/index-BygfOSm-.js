import{r as g,j as t}from"./index-DTMkQmTp.js";import{S as E,a as b,b as x,d as S}from"./index-DiShqxyg.js";const w="mastermind-state.json",i=4,v=10,m=[{id:0,name:"Red",hex:"#d64550"},{id:1,name:"Orange",hex:"#f08a24"},{id:2,name:"Yellow",hex:"#f2cc8f"},{id:3,name:"Green",hex:"#4c9a2a"},{id:4,name:"Blue",hex:"#2c7fb8"},{id:5,name:"Purple",hex:"#7b4f9f"}],R=r=>t.jsxs("article",{children:[t.jsx("strong",{children:"Mastermind"}),t.jsx("p",{children:"Crack the code with feedback pegs in 10 guesses."})]}),k=r=>typeof r=="number"&&Number.isInteger(r)&&r>=0&&r<m.length,D=()=>Array.from({length:i},()=>Math.floor(Math.random()*m.length)),j=()=>{const r=new Date().toISOString();return{secret:D(),guesses:[],currentGuess:Array.from({length:i},()=>null),status:"playing",maxGuesses:v,startedAtIso:r,updatedAtIso:r}},T=(r,e)=>{let l=0;const h=new Array(m.length).fill(0),u=new Array(m.length).fill(0);for(let a=0;a<i;a+=1)r[a]===e[a]?l+=1:(h[r[a]]+=1,u[e[a]]+=1);let c=0;for(let a=0;a<m.length;a+=1)c+=Math.min(h[a],u[a]);return{exact:l,colorOnly:c}},P=r=>{if(typeof r!="object"||r===null)return!1;const e=r;return typeof e.id=="string"&&Array.isArray(e.colors)&&e.colors.length===i&&e.colors.every(k)&&typeof e.createdAtIso=="string"&&typeof e.result=="object"&&e.result!==null&&typeof e.result.exact=="number"&&typeof e.result.colorOnly=="number"},U=r=>{try{const e=JSON.parse(r);if(!Array.isArray(e.secret)||e.secret.length!==i||e.secret.some(p=>!k(p))||!Array.isArray(e.currentGuess)||e.currentGuess.length!==i)return null;const l=e.currentGuess.map(p=>p===null?null:k(p)?p:null),h=Array.isArray(e.guesses)?e.guesses.filter(P):[],u=e.status==="won"||e.status==="lost"?e.status:"playing",c=typeof e.maxGuesses=="number"&&e.maxGuesses>0?e.maxGuesses:v,a=typeof e.startedAtIso=="string"?e.startedAtIso:new Date().toISOString(),A=typeof e.updatedAtIso=="string"?e.updatedAtIso:a;return{secret:e.secret,guesses:h,currentGuess:l,status:u,maxGuesses:c,startedAtIso:a,updatedAtIso:A}}catch{return null}},_=r=>{const e=[];if(!r)return Array.from({length:i},()=>"empty");for(e.push(...Array.from({length:r.exact},()=>"exact")),e.push(...Array.from({length:r.colorOnly},()=>"partial"));e.length<i;)e.push("empty");return e},J=({ctx:r})=>{const[e,l]=g.useState(j),[h,u]=g.useState("Pick a color, then tap slots to build your guess."),[c,a]=g.useState(m[0].id);g.useEffect(()=>{(async()=>{const s=await r.vfs.readText(w);if(!s)return;const n=U(s);if(n){l(n);return}u("Saved game was invalid. Starting fresh."),l(j())})()},[r.vfs]),g.useEffect(()=>{r.vfs.writeText(w,JSON.stringify(e,null,2))},[r.vfs,e]);const A=e.maxGuesses-e.guesses.length,p=e.currentGuess.every(s=>s!==null),I=s=>{e.status==="playing"&&l(n=>{if(n.status!=="playing")return n;const o=[...n.currentGuess];return o[s]=c,{...n,currentGuess:o,updatedAtIso:new Date().toISOString()}})},N=()=>{e.status==="playing"&&l(s=>({...s,currentGuess:Array.from({length:i},()=>null),updatedAtIso:new Date().toISOString()}))},C=()=>{if(e.status!=="playing")return;if(!p){u("Fill all 4 pegs before submitting.");return}const s=e.currentGuess.map($=>$??0),n=T(e.secret,s),o={id:crypto.randomUUID(),colors:s,result:n,createdAtIso:new Date().toISOString()},d=[...e.guesses,o];let f="playing",G=`Guesses left: ${e.maxGuesses-d.length}.`;n.exact===i?(f="won",G="You cracked the code!"):d.length>=e.maxGuesses&&(f="lost",G="No more guesses. The code is revealed below."),l({...e,guesses:d,currentGuess:Array.from({length:i},()=>null),status:f,updatedAtIso:new Date().toISOString()}),u(G)},O=()=>{l(j()),u("New game started. Pick a color and guess the code.")},y=e.status!=="playing",M=g.useMemo(()=>{const s=e.guesses.map(n=>({key:n.id,colors:n.colors.map(o=>o),feedback:n.result,isActive:!1}));return e.status==="playing"&&s.push({key:"current",colors:e.currentGuess,feedback:void 0,isActive:!0}),s},[e]);return t.jsxs(E,{title:"Mastermind",children:[t.jsx(b,{title:"Mastermind"}),t.jsxs(x,{children:["Crack the 4-peg code in ",e.maxGuesses," guesses."]}),t.jsx(x,{children:"Exact match = dark peg. Right color, wrong spot = light peg."}),t.jsx(x,{children:h}),t.jsxs("div",{className:"slap-button-row",children:[t.jsx(S,{title:"New Game",onClick:O}),t.jsx(S,{title:"Clear Row",onClick:N,disabled:e.status!=="playing"}),t.jsx(S,{title:"Submit Guess",onClick:C,disabled:e.status!=="playing"||!p})]}),t.jsxs(x,{children:["Guess ",Math.min(e.guesses.length+1,e.maxGuesses)," of ",e.maxGuesses," Â· Attempts left: ",A]}),t.jsx("div",{className:"mastermind-board",children:M.map(s=>t.jsxs("div",{className:"mastermind-row",children:[s.colors.map((n,o)=>{const d=typeof n=="number"?m[n]:null,f=d?d.name:"Empty";return t.jsx("button",{type:"button",className:`mastermind-slot${d?"":" is-empty"}${s.isActive?" is-active":""}`,style:d?{background:d.hex}:void 0,onClick:s.isActive?()=>I(o):void 0,disabled:!s.isActive,"aria-label":`Slot ${o+1}: ${f}`},`${s.key}-${o}`)}),t.jsx("div",{className:"mastermind-feedback","aria-hidden":"true",children:_(s.feedback).map((n,o)=>t.jsx("span",{className:`mastermind-feedback-dot ${n}`},`${s.key}-dot-${o}`))})]},s.key))}),t.jsx(b,{title:"Palette"}),t.jsxs("div",{className:"mastermind-palette",children:[m.map(s=>t.jsxs("button",{type:"button",className:`mastermind-color-button${c===s.id?" is-selected":""}`,onClick:()=>a(s.id),"aria-pressed":c===s.id,children:[t.jsx("span",{className:"mastermind-color-swatch",style:{background:s.hex}}),t.jsx("span",{children:s.name})]},s.id)),t.jsxs("button",{type:"button",className:`mastermind-color-button mastermind-eraser${c===null?" is-selected":""}`,onClick:()=>a(null),"aria-pressed":c===null,children:[t.jsx("span",{className:"mastermind-color-swatch mastermind-eraser-swatch"}),t.jsx("span",{children:"Erase"})]})]}),t.jsx(b,{title:y?"Secret Code":"Secret Code (hidden)"}),t.jsx("div",{className:"mastermind-secret",children:e.secret.map((s,n)=>{const o=m[s];return t.jsx("div",{className:`mastermind-slot${y?"":" is-hidden"}`,style:y?{background:o.hex}:void 0,"aria-hidden":!y},`secret-${n}`)})})]})},Y={id:"mastermind",title:"Mastermind",author:"Joel",description:"Crack the secret color code with feedback pegs.",icon:"ðŸ§©",Preview:R,Application:J};export{Y as mastermindManifest};
