import{r as l,j as s}from"./index-BXpMHQJa.js";import{S as B,a as v,d as m,b as y,c as R}from"./index-D9n4s55T.js";const w="daily-checklist.json",K=[{id:"water",text:"Drink water"},{id:"walk",text:"Take a short walk"},{id:"pause",text:"Take one mindful pause"}],F=c=>s.jsxs("article",{children:[s.jsx("strong",{children:"Daily Checklist"}),s.jsx("p",{children:"Check off daily tasks and manage your list."})]}),O=()=>new Date().toISOString().slice(0,10),q=c=>{if(typeof c!="object"||c===null)return!1;const e=c;return typeof e.id=="string"&&typeof e.text=="string"},S=()=>({app:"slap-daily-checklist",version:1,templateItems:K,days:{}}),G=c=>{if(typeof c!="object"||c===null)return S();const e=c,o=Array.isArray(e.templateItems)?e.templateItems.filter(q).map(d=>({id:d.id,text:d.text.trim()})).filter(d=>d.text):[],p=o.length>0?o:K,f=typeof e.days=="object"&&e.days!==null?e.days:{},I={};for(const[d,h]of Object.entries(f)){if(typeof h!="object"||h===null)continue;const u=h.checkedItemIds,j=Array.isArray(u)?u.filter(x=>typeof x=="string"):[];I[d]={checkedItemIds:j}}return{app:"slap-daily-checklist",version:1,templateItems:p,days:I}},U=c=>{const e=new Date(`${c}T00:00:00`);return Number.isNaN(e.getTime())?c:e.toLocaleDateString()},L=(c,e)=>{const o=new Date(`${c}T00:00:00`);return o.setDate(o.getDate()+e),o.toISOString().slice(0,10)},Q=({ctx:c})=>{const[e,o]=l.useState(S()),[p,f]=l.useState(O),[I,d]=l.useState(""),[h,u]=l.useState(!1),[j,x]=l.useState({}),[A,i]=l.useState(""),k=l.useRef(null);l.useEffect(()=>{(async()=>{const t=await c.vfs.readText(w);if(!t){const a=S();o(a),await c.vfs.writeText(w,JSON.stringify(a,null,2));return}try{const a=JSON.parse(t);o(G(a))}catch{i("Checklist data was unreadable. Reset to defaults."),o(S())}})()},[c.vfs]);const T=async t=>{o(t),await c.vfs.writeText(w,JSON.stringify(t,null,2))},D=l.useMemo(()=>{const t=e.days[p];return new Set((t==null?void 0:t.checkedItemIds)??[])},[e.days,p]),b=l.useMemo(()=>{const t=e.templateItems.length,a=e.templateItems.filter(n=>D.has(n.id)).length;return{total:t,done:a,percent:t===0?0:Math.round(a/t*100)}},[e.templateItems,D]),M=async t=>{const a=e.days[p]??{checkedItemIds:[]},n=new Set(a.checkedItemIds);n.has(t)?n.delete(t):n.add(t);const r={...e,days:{...e.days,[p]:{checkedItemIds:[...n]}}};await T(r)},H=async()=>{i("");const t=I.trim();if(!t){i("Enter item text first.");return}const a={id:crypto.randomUUID(),text:t},n={...e,templateItems:[...e.templateItems,a]};await T(n),d(""),i("Item added.")},J=()=>{const t={};for(const a of e.templateItems)t[a.id]=a.text;x(t),u(!0)},P=async()=>{i("");const t=e.templateItems.map(n=>({...n,text:(j[n.id]??n.text).trim()})).filter(n=>n.text.length>0);if(t.length===0){i("At least one checklist item is required.");return}const a={...e,templateItems:t};await T(a),x({}),u(!1),i("Checklist updated.")},z=()=>{x({}),u(!1),i("")},X=t=>{const a=t.changedTouches[0];k.current={x:a.clientX,y:a.clientY}},Y=(t,a)=>{if(h||!k.current)return;const n=t.changedTouches[0],r=n.clientX-k.current.x,g=n.clientY-k.current.y;k.current=null,Math.abs(r)>=48&&Math.abs(g)<=32&&(M(a),i(r>0?"Checked via swipe.":"Unchecked via swipe."))},N=l.useMemo(()=>Object.entries(e.days).sort(([a],[n])=>n.localeCompare(a)).slice(0,7).map(([a,n])=>{const r=new Set(e.templateItems.map(E=>E.id)),g=n.checkedItemIds.filter(E=>r.has(E)).length,C=e.templateItems.length,$=C===0?0:Math.round(g/C*100);return{dateKey:a,done:g,total:C,percent:$}}),[e.days,e.templateItems]),_=async()=>{const t=await c.vfs.readText(w);if(!t){i("No checklist history to export yet.");return}const a=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download=`daily-checklist-history-${p}.json`,r.click(),URL.revokeObjectURL(n),i("Checklist history exported.")};return s.jsxs(B,{title:"Daily Checklist",children:[s.jsx(v,{title:"Daily Checklist"}),s.jsxs("div",{className:"slap-button-row",children:[s.jsx(m,{title:"Prev Day",onClick:()=>f(t=>L(t,-1))}),s.jsx(m,{title:"Today",onClick:()=>f(O())}),s.jsx(m,{title:"Next Day",onClick:()=>f(t=>L(t,1))}),s.jsx(m,{title:"Export History",onClick:()=>void _()}),h?s.jsxs(s.Fragment,{children:[s.jsx(m,{title:"Save Edits",onClick:()=>void P()}),s.jsx(m,{title:"Cancel Edit",onClick:z})]}):s.jsx(m,{title:"Edit Mode",onClick:J})]}),s.jsxs(y,{children:["Date: ",U(p)]}),s.jsxs(y,{children:["Progress: ",b.done,"/",b.total," (",b.percent,"%)"]}),h?null:s.jsx(y,{children:"Swipe left/right on an item to toggle checked."}),A?s.jsx(y,{children:A}):null,e.templateItems.length===0?s.jsx(y,{children:"No checklist items. Add one below."}):null,e.templateItems.map(t=>s.jsx("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.5rem"},onTouchStart:X,onTouchEnd:a=>Y(a,t.id),children:h?s.jsx(R,{label:"Edit Item",value:j[t.id]??t.text,onChange:a=>x(n=>({...n,[t.id]:a}))}):s.jsxs("label",{style:{display:"flex",gap:"0.55rem",alignItems:"center"},children:[s.jsx("input",{type:"checkbox",checked:D.has(t.id),onChange:()=>void M(t.id)}),s.jsx("span",{children:t.text})]})},t.id)),s.jsxs("section",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[s.jsx(v,{title:"Add Item"}),s.jsx(R,{label:"New Item",value:I,onChange:d}),s.jsx(m,{title:"Add To List",onClick:()=>void H()})]}),s.jsx(v,{title:"Recent Completion"}),N.length===0?s.jsx(y,{children:"No history yet."}):null,N.map(t=>s.jsxs(y,{children:[U(t.dateKey),": ",t.done,"/",t.total," (",t.percent,"%)"]},t.dateKey))]})},Z={id:"daily-checklist",title:"Daily Checklist",author:"Joel",description:"Daily checkoffs with editable checklist items.",icon:"âœ…",Preview:F,Application:Q};export{Z as dailyChecklistManifest};
