import{r as u,j as d}from"./index-C9LANGui.js";import{b as T,d as D}from"./index-Cbq74euv.js";const k="simon-says-state.json",y=280,B=1100,v=1e3,H=["#d46a6a","#6b8fd4","#d4b76b","#6cc48b"],X=["#f09f9f","#9fb9f0","#f0d79f","#9fe0b8"],Y=f=>d.jsxs("article",{children:[d.jsx("strong",{children:"Simon Says"}),d.jsx("p",{children:"Repeat the growing light pattern."})]}),C=()=>Math.floor(Math.random()*4),L=(f=0)=>({sequence:[],inputIndex:0,score:0,bestScore:f,status:"idle"}),V=({ctx:f})=>{const[c,p]=u.useState(L),[N,x]=u.useState("Press Start to begin."),[R,I]=u.useState(null),M=u.useRef(null),S=u.useRef([]),j=()=>{for(const t of S.current)window.clearTimeout(t);S.current=[]};u.useEffect(()=>{(async()=>{const t=await f.vfs.readText(k);if(t)try{const e=JSON.parse(t),s=typeof e.bestScore=="number"&&e.bestScore>=0?Math.floor(e.bestScore):0;p(L(s))}catch{x("Saved score data was invalid. Starting fresh.")}})()},[f.vfs]),u.useEffect(()=>{f.vfs.writeText(k,JSON.stringify({bestScore:c.bestScore},null,2))},[f.vfs,c.bestScore]);const P=u.useCallback((t,e)=>{const s=M.current;if(!s)return;const n=s.getContext("2d");if(!n)return;n.clearRect(0,0,y,y);const i=y/2,l=8,o=i-l*1.5,h=t?Math.min(1,(e-t.startedAt)/v):0;for(let r=0;r<4;r=r+1){const J=r<2,g=r===0||r===2?l:i+l/2,b=J?l:i+l/2,E=(t==null?void 0:t.region)===r;if(n.fillStyle=E?X[r]:H[r],n.fillRect(g,b,o,o),!!E){if(r===0){const a=.22+.26*Math.sin(h*Math.PI*3);n.fillStyle=`rgba(255, 255, 255, ${a.toFixed(3)})`,n.fillRect(g+6,b+6,o-12,o-12)}if(r===1){const a=o*.28,w=g+(o+a)*h-a;n.fillStyle="rgba(255, 255, 255, 0.35)",n.fillRect(w,b,a,o)}if(r===2){const a=g+o/2,w=b+o/2;n.strokeStyle="rgba(255, 255, 255, 0.48)",n.lineWidth=2;for(let m=0;m<3;m+=1){const A=(h+m*.2)%1;n.beginPath(),n.arc(a,w,8+A*(o*.42),0,Math.PI*2),n.stroke()}}if(r===3){n.fillStyle="rgba(255, 255, 255, 0.85)";for(let a=0;a<7;a+=1){const w=h*Math.PI*2+a*.9,m=o*(.16+a%3*.08),A=g+o/2+Math.cos(w)*m,z=b+o/2+Math.sin(w)*m;n.fillRect(A-2,z-2,4,4)}}}}},[]);u.useEffect(()=>{let t=null;const e=s=>{P(R,s),R&&(t=window.requestAnimationFrame(e))};return e(window.performance.now()),()=>{t!==null&&window.cancelAnimationFrame(t)}},[P,R]),u.useEffect(()=>()=>{j()},[]);const q=t=>{j(),p(s=>({...s,status:"playingBack",inputIndex:0})),x("Watch the pattern."),t.forEach((s,n)=>{const i=n*B,l=i+v,o=window.setTimeout(()=>I({region:s,startedAt:window.performance.now()}),i),h=window.setTimeout(()=>I(null),l);S.current.push(o,h)});const e=window.setTimeout(()=>{p(s=>({...s,status:"awaitingInput",inputIndex:0})),x("Your turn.")},t.length*B+40);S.current.push(e)},O=()=>{const t=[C()];p(e=>({...e,sequence:t,inputIndex:0,score:0,status:"playingBack"})),q(t)},_=t=>{p(e=>({...e,status:"lost",inputIndex:0,bestScore:Math.max(e.bestScore,t)})),x("Wrong region. Press Restart.")},F=(t,e)=>{const s=[...t,C()];p(n=>({...n,sequence:s,inputIndex:0,score:e,status:"playingBack"})),q(s)},W=t=>{if(c.status!=="awaitingInput")return;I({region:t,startedAt:window.performance.now()});const e=window.setTimeout(()=>I(null),v);S.current.push(e);const s=c.sequence[c.inputIndex];if(t!==s){_(c.score);return}const n=c.inputIndex+1;if(n>=c.sequence.length){const i=c.sequence.length;x("Nice. Next round...");const l=window.setTimeout(()=>F(c.sequence,i),420);S.current.push(l);return}p(i=>({...i,inputIndex:n}))},G=t=>{const e=t.currentTarget.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top,i=s<e.width/2,o=n<e.height/2?i?0:1:i?2:3;W(o)};return d.jsxs("section",{className:"slap-shell",children:[d.jsx(T,{children:"Repeat the lights in order."}),d.jsxs(T,{children:["Score: ",c.score," | Best: ",c.bestScore]}),d.jsx(T,{children:N}),d.jsx("canvas",{ref:M,className:"simon-canvas",width:y,height:y,onPointerDown:G,"aria-label":"Simon Says board"}),d.jsx("div",{className:"simon-controls",children:d.jsx(D,{title:c.status==="idle"?"Start":"Restart",onClick:O})})]})},Q={id:"simon-says",title:"Simon Says",author:"Joel",description:"Memorize and repeat a growing light sequence.",icon:"ðŸŸ©",Preview:Y,Application:V};export{Q as simonSaysManifest};
