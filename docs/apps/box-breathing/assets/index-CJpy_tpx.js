import{j as t,r as n}from"./index-DDzYBEZS.js";const $=({children:s})=>t.jsx("section",{className:"slap-shell",children:s}),I=({title:s,onClick:x,disabled:r})=>t.jsx("button",{type:"button",className:"slap-button",onClick:x,disabled:r,children:s}),w=({children:s})=>t.jsx("p",{className:"slap-inline-text",children:s}),k=[3,4,5,6],F=["Inhale","Hold","Exhale","Hold"],W=s=>t.jsxs("article",{children:[t.jsx("strong",{children:"Box Breathing"}),t.jsx("p",{children:"Guided breathing timer with canvas animation."})]}),_=s=>s==="Inhale"?"#2d4030":s==="Exhale"?"#7a5f31":"#6a635a",H=(s,x,r,l,P,h)=>{const e=s.getContext("2d");if(!e)return;const u=s.width,c=s.height,o=u/2,p=c/2;e.clearRect(0,0,u,c),e.fillStyle="#f7f2e7",e.fillRect(0,0,u,c);const i=52,b=Math.min(u,c)*.62,f=i+(b-i)*x;e.fillStyle=_(r),e.strokeStyle="#1c1c1c",e.lineWidth=2;const S=o-f/2,d=p-f/2;e.beginPath(),e.rect(S,d,f,f),e.fill(),e.stroke(),e.fillStyle="#f4f0e8",e.font="bold 22px Trebuchet MS",e.textAlign="center",e.fillText(r,o,p+8),e.fillStyle="#1c1c1c",e.font="14px Trebuchet MS",e.fillText(`Phase ${(l*h).toFixed(1)}s / ${h}s`,o,c-34),e.fillText(`Cycle ${P}`,o,c-14)},G=({ctx:s})=>{const x=n.useRef(null),r=n.useRef(null),[l,P]=n.useState(4),[h,e]=n.useState(!1),[u,c]=n.useState(0),[o,p]=n.useState(0),[i,b]=n.useState(0),[f,S]=n.useState("Tap Start to begin a calm breathing cycle."),d=F[o]??"Inhale",v=n.useMemo(()=>d==="Inhale"?i:d==="Exhale"?1-i:o===1?1:0,[d,o,i]);n.useEffect(()=>{s.vfs.writeText("box-breathing-settings.json",JSON.stringify({secondsPerPhase:l,updatedAtIso:new Date().toISOString()}))},[s.vfs,l]),n.useEffect(()=>{(async()=>{const a=await s.vfs.readText("box-breathing-settings.json");if(a)try{const g=JSON.parse(a);typeof g.secondsPerPhase=="number"&&k.includes(g.secondsPerPhase)&&P(g.secondsPerPhase)}catch{}})()},[s.vfs]),n.useEffect(()=>{const a=x.current;if(!a)return;const g=C=>{const R=x.current;if(!R)return;const B=q=>{const T=(q-C)/1e3,m=l,A=m*4,N=T%A,j=Math.floor(N/m),y=(N-j*m)/m,M=Math.floor(T/A);p(j),b(y),c(M+1);const E=F[j]??"Inhale",J=E==="Inhale"?y:E==="Exhale"?1-y:j===1?1:0;H(R,J,E,y,M+1,m),r.current=requestAnimationFrame(B)};r.current=requestAnimationFrame(B)};if(h){const C=performance.now();g(C-o*l*1e3-i*l*1e3),S("Breathe with the square: inhale, hold, exhale, hold.")}else H(a,v,d,i,Math.max(1,u),l);return()=>{r.current!==null&&(cancelAnimationFrame(r.current),r.current=null)}},[h,l,o,i,u,v,d]);const z=()=>e(!0),D=()=>{e(!1),S("Paused. Resume when ready.")},O=()=>{e(!1),p(0),b(0),c(0),S("Reset. Tap Start when you are ready.")};return t.jsxs($,{title:"Box Breathing",children:[t.jsx(w,{children:"Cycle: Inhale, Hold, Exhale, Hold"}),t.jsxs("label",{className:"slap-input-wrap",children:[t.jsx("span",{children:"Seconds Per Phase"}),t.jsx("select",{className:"slap-input",value:l,onChange:a=>P(Number(a.target.value)),disabled:h,children:k.map(a=>t.jsxs("option",{value:a,children:[a,"s"]},a))})]}),t.jsx("canvas",{ref:x,width:300,height:300,style:{width:"100%",maxWidth:"300px",borderRadius:"0.8rem",border:"1px solid #c5b9a5"}}),t.jsxs("div",{className:"slap-button-row",children:[t.jsx(I,{title:"Start",onClick:z,disabled:h}),t.jsx(I,{title:"Pause",onClick:D,disabled:!h}),t.jsx(I,{title:"Reset",onClick:O})]}),t.jsx(w,{children:f}),t.jsxs(w,{children:["Current phase: ",d]}),t.jsxs(w,{children:["Cycle count: ",u]})]})},K={id:"box-breathing",title:"Box Breathing",author:"Joel",description:"Canvas-guided inhale/hold/exhale/hold breathing.",icon:"ü´Å",Preview:W,Application:G};export{K as boxBreathingManifest};
