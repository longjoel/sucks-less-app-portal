import{j as s,r as h}from"./index-dUkWwRs9.js";const y=({title:l,onClick:e,disabled:i})=>s.jsx("button",{type:"button",className:"slap-button",onClick:e,disabled:i,children:l}),p=({children:l})=>s.jsx("p",{className:"slap-inline-text",children:l}),w="dice-roller-state.json",S=10,P=100,D=[4,6,8,10,12,20,100],L=[{value:"red",label:"Red"},{value:"blue",label:"Blue"},{value:"neutral",label:"Neutral"}],q=l=>s.jsxs("article",{children:[s.jsx("strong",{children:"Dice Roller"}),s.jsx("p",{children:"Roll multiple color-coded dice pools for tabletop sessions."})]}),A=l=>({id:`pool-${Date.now()}-${l??Math.floor(Math.random()*1e5)}`,color:l===2?"blue":"red",count:l===2?2:3,sides:l===2?8:6}),C=()=>({pools:[A(1),A(2)],history:[],showTotals:!0,sortResults:!1,autoClearHistory:!1}),z=l=>Math.floor(Math.random()*l)+1,O=l=>typeof l!="number"?null:D.includes(l)?l:null,$=l=>l==="red"||l==="blue"||l==="neutral"?l:null,T=l=>Math.max(1,Math.min(P,Math.floor(l))),I=(l,e)=>`${l.join(" + ")} = ${e}`,B=l=>{if(typeof l!="object"||l===null)return null;const e=l;if(typeof e.id!="string")return null;const i=$(e.color),d=O(e.sides),r=typeof e.count=="number"?T(e.count):NaN;return!i||!d||Number.isNaN(r)?null:{id:e.id,color:i,count:r,sides:d}},J=l=>{if(typeof l!="object"||l===null)return null;const e=l;if(typeof e.id!="string"||typeof e.createdAtIso!="string"||!Array.isArray(e.pools)||typeof e.grandTotal!="number")return null;const i=[];for(const d of e.pools){if(typeof d!="object"||d===null)continue;const r=d,j=$(r.color),m=O(r.sides);if(!j||!m||typeof r.poolId!="string"||typeof r.count!="number"||!Array.isArray(r.rolls))continue;const f=r.rolls.filter(a=>typeof a=="number"),b=typeof r.subtotal=="number"?r.subtotal:f.reduce((a,x)=>a+x,0);i.push({poolId:r.poolId,color:j,count:T(r.count),sides:m,rolls:f,subtotal:b})}return{id:e.id,createdAtIso:e.createdAtIso,pools:i,grandTotal:Math.floor(e.grandTotal)}},G=({ctx:l})=>{const[e,i]=h.useState(C),[d,r]=h.useState("Configure pools, then roll."),[j,m]=h.useState(!1);h.useEffect(()=>{(async()=>{const o=await l.vfs.readText(w);if(o)try{const t=JSON.parse(o),c=Array.isArray(t.pools)?t.pools.map(B).filter(u=>u!==null):[],n=Array.isArray(t.history)?t.history.map(J).filter(u=>u!==null):[];i({pools:c.length>0?c:C().pools,history:n.slice(0,S),showTotals:t.showTotals!==!1,sortResults:t.sortResults===!0,autoClearHistory:t.autoClearHistory===!0})}catch{r("Saved data was invalid. Loaded defaults.")}})()},[l.vfs]),h.useEffect(()=>{l.vfs.writeText(w,JSON.stringify(e,null,2))},[l.vfs,e]);const f=()=>{i(o=>({...o,pools:[...o.pools,A()]}))},b=o=>{i(t=>{const c=t.pools.filter(n=>n.id!==o);return c.length===0?t:{...t,pools:c}})},a=(o,t)=>{i(c=>({...c,pools:c.pools.map(n=>n.id===o?{...n,...t,count:t.count!==void 0?T(t.count):n.count}:n)}))},x=o=>{i(t=>({...t,[o]:!t[o]}))},k=()=>{m(!0),window.setTimeout(()=>m(!1),720);const o=e.pools.map(n=>{const u=Array.from({length:n.count},()=>z(n.sides)),v=e.sortResults?[...u].sort((N,R)=>N-R):u,_=v.reduce((N,R)=>N+R,0);return{poolId:n.id,color:n.color,count:n.count,sides:n.sides,rolls:v,subtotal:_}}),t=o.reduce((n,u)=>n+u.subtotal,0),c={id:`roll-${Date.now()}`,createdAtIso:new Date().toISOString(),pools:o,grandTotal:t};i(n=>({...n,history:n.autoClearHistory?[c]:[c,...n.history].slice(0,S)})),r(`Rolled ${o.length} pool${o.length===1?"":"s"}.`)},H=()=>{i(o=>({...o,history:[]})),r("Roll history cleared.")},M=()=>{i(o=>({...C(),history:o.history})),r("Pools reset to defaults.")},g=e.history[0]??null,E=h.useMemo(()=>e.pools.reduce((o,t)=>o+t.count,0),[e.pools]);return s.jsxs("section",{className:"slap-shell",children:[s.jsx(p,{children:"Build custom pools like 3 red d6 + 2 blue d8, then roll."}),s.jsxs(p,{children:["Pools: ",e.pools.length," | Dice: ",E]}),s.jsx(p,{children:d}),s.jsx("div",{className:"dice-primary-action",children:s.jsx(y,{title:"Roll",onClick:k})}),s.jsxs("section",{className:"dice-results",children:[s.jsx("h3",{className:"slap-title",children:"Latest Roll"}),g?s.jsxs(s.Fragment,{children:[g.pools.map(o=>s.jsxs("article",{className:`dice-roll-row dice-${o.color}${j?" dice-roll-animate":""}`,children:[s.jsxs("strong",{children:[o.count,"d",o.sides," ",o.color]}),s.jsx("p",{className:"dice-roll-equation",children:I(o.rolls,o.subtotal)})]},o.poolId)),e.showTotals?s.jsxs(p,{children:["Grand total: ",s.jsx("strong",{children:g.grandTotal})]}):null]}):s.jsx(p,{children:"No rolls yet."})]}),s.jsxs("section",{className:"dice-options",children:[s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:e.showTotals,onChange:()=>x("showTotals")}),"Show totals"]}),s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:e.sortResults,onChange:()=>x("sortResults")}),"Sort rolls"]}),s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:e.autoClearHistory,onChange:()=>x("autoClearHistory")}),"Auto-clear history"]})]}),s.jsx("section",{className:"dice-pool-list",children:e.pools.map(o=>s.jsxs("article",{className:`dice-pool-card dice-${o.color}`,children:[s.jsxs("div",{className:"dice-pool-head",children:[s.jsxs("strong",{children:[o.color.toUpperCase()," Pool"]}),s.jsx("button",{type:"button",className:"dice-remove-btn",onClick:()=>b(o.id),disabled:e.pools.length<=1,children:"Remove"})]}),s.jsxs("div",{className:"dice-pool-controls",children:[s.jsxs("label",{className:"dice-inline-field",children:[s.jsx("span",{children:"Count"}),s.jsxs("div",{className:"dice-count-controls",children:[s.jsx("button",{type:"button",onClick:()=>a(o.id,{count:o.count-1}),children:"-"}),s.jsx("input",{type:"number",min:1,max:P,value:o.count,onChange:t=>a(o.id,{count:Number(t.target.value)||1})}),s.jsx("button",{type:"button",onClick:()=>a(o.id,{count:o.count+1}),children:"+"})]})]}),s.jsxs("label",{className:"dice-inline-field",children:[s.jsx("span",{children:"Die"}),s.jsx("select",{value:o.sides,onChange:t=>a(o.id,{sides:Number(t.target.value)}),children:D.map(t=>s.jsxs("option",{value:t,children:["d",t]},t))})]}),s.jsxs("label",{className:"dice-inline-field",children:[s.jsx("span",{children:"Color"}),s.jsx("select",{value:o.color,onChange:t=>a(o.id,{color:t.target.value}),children:L.map(t=>s.jsx("option",{value:t.value,children:t.label},t.value))})]})]})]},o.id))}),s.jsxs("div",{className:"dice-actions",children:[s.jsx(y,{title:"Add Pool",onClick:f}),s.jsx(y,{title:"Clear History",onClick:H}),s.jsx(y,{title:"Reset Defaults",onClick:M})]}),s.jsxs("section",{className:"dice-results",children:[s.jsxs("h3",{className:"slap-title",children:["History (",e.history.length,")"]}),e.history.length===0?s.jsx(p,{children:"History is empty."}):null,e.history.map(o=>s.jsxs("details",{children:[s.jsxs("summary",{children:[new Date(o.createdAtIso).toLocaleTimeString()," | ",o.pools.length," pools",e.showTotals?` | total ${o.grandTotal}`:""]}),o.pools.map(t=>s.jsxs("article",{className:`dice-roll-row dice-${t.color}`,children:[s.jsxs("strong",{children:[t.count,"d",t.sides," ",t.color]}),s.jsx("p",{className:"dice-roll-equation",children:I(t.rolls,t.subtotal)})]},`${o.id}:${t.poolId}`))]},o.id))]})]})},F={id:"dice-roller",title:"Dice Roller",author:"Joel",description:"Roll custom color-coded dice pools for tabletop sessions.",icon:"ðŸŽ²",Preview:q,Application:G};export{F as diceRollerManifest};
