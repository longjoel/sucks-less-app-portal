import{j as d,r as m}from"./index-b2pyJohA.js";const A=({children:s})=>d.jsx("section",{className:"slap-shell",children:s}),S=({title:s,onClick:e,disabled:n})=>d.jsx("button",{type:"button",className:"slap-button",onClick:e,disabled:n,children:s}),y=({children:s})=>d.jsx("p",{className:"slap-inline-text",children:s}),M="minesweeper-state.json",j=10,x=8,F=10,R=s=>d.jsxs("article",{children:[d.jsx("strong",{children:"Minesweeper"}),d.jsx("p",{children:"Reveal all safe tiles and avoid mines."})]}),T=(s,e)=>Array.from({length:s},()=>Array.from({length:e},()=>({hasMine:!1,isRevealed:!1,isFlagged:!1,adjacentMines:0}))),v=(s,e,n,p)=>{const i=[];for(let c=-1;c<=1;c+=1)for(let u=-1;u<=1;u+=1){if(c===0&&u===0)continue;const r=s+c,o=e+u;r>=0&&r<n&&o>=0&&o<p&&i.push({row:r,col:o})}return i},N=(s,e,n,p)=>{const i=s.length,c=s[0].length,u=new Set([`${n}:${p}`]);for(const o of v(n,p,i,c))u.add(`${o.row}:${o.col}`);const r=[];for(let o=0;o<i;o+=1)for(let t=0;t<c;t+=1)u.has(`${o}:${t}`)||r.push({row:o,col:t});for(let o=r.length-1;o>0;o-=1){const t=Math.floor(Math.random()*(o+1));[r[o],r[t]]=[r[t],r[o]]}for(let o=0;o<e&&o<r.length;o+=1){const t=r[o];s[t.row][t.col].hasMine=!0}for(let o=0;o<i;o+=1)for(let t=0;t<c;t+=1)s[o][t].adjacentMines=v(o,t,i,c).filter(a=>s[a.row][a.col].hasMine).length},$=s=>s.map(e=>e.map(n=>({...n}))),C=(s,e,n)=>{const p=s.length,i=s[0].length,c=[{row:e,col:n}],u=new Set;for(;c.length>0;){const r=c.shift(),o=`${r.row}:${r.col}`;if(u.has(o))continue;u.add(o);const t=s[r.row][r.col];if(!(t.isFlagged||t.isRevealed)&&(t.isRevealed=!0,t.adjacentMines===0&&!t.hasMine))for(const a of v(r.row,r.col,p,i)){const l=s[a.row][a.col];!l.isRevealed&&!l.isFlagged&&c.push(a)}}},I=s=>{for(const e of s)for(const n of e)if(!n.hasMine&&!n.isRevealed)return!1;return!0},E=s=>{for(const e of s)for(const n of e)n.hasMine&&(n.isRevealed=!0)},b=()=>({rows:j,cols:x,mines:F,board:T(j,x),status:"ready",mode:"reveal",elapsedSeconds:0,startedAtIso:null}),k=s=>{if(typeof s!="object"||s===null)return!1;const e=s;if(typeof e.rows!="number"||typeof e.cols!="number"||typeof e.mines!="number"||!Array.isArray(e.board)||e.status!=="ready"&&e.status!=="playing"&&e.status!=="won"&&e.status!=="lost"||e.mode!=="reveal"&&e.mode!=="flag"||typeof e.elapsedSeconds!="number")return!1;const n=e.board;if(n.length!==e.rows)return!1;for(const p of n){if(!Array.isArray(p)||p.length!==e.cols)return!1;for(const i of p){if(typeof i!="object"||i===null)return!1;const c=i;if(typeof c.hasMine!="boolean"||typeof c.isRevealed!="boolean"||typeof c.isFlagged!="boolean"||typeof c.adjacentMines!="number")return!1}}return!0},O=({ctx:s})=>{const[e,n]=m.useState(b),[p,i]=m.useState("Tap a tile to start.");m.useEffect(()=>{(async()=>{const t=await s.vfs.readText(M);if(t)try{const a=JSON.parse(t);k(a)&&(n(a),a.status==="won"&&i("You won. Nice work."),a.status==="lost"&&i("You hit a mine. Start a new game."))}catch{i("Saved game data was invalid. Starting fresh.")}})()},[s.vfs]),m.useEffect(()=>{s.vfs.writeText(M,JSON.stringify(e,null,2))},[s.vfs,e]),m.useEffect(()=>{if(e.status!=="playing")return;const t=setInterval(()=>{n(a=>({...a,elapsedSeconds:a.elapsedSeconds+1}))},1e3);return()=>clearInterval(t)},[e.status]);const c=()=>{n(b()),i("Tap a tile to start.")},u=()=>{n(t=>({...t,mode:t.mode==="reveal"?"flag":"reveal"}))},r=(t,a)=>{n(l=>{if(l.status==="won"||l.status==="lost")return l;const f=$(l.board),g=f[t][a];if(l.mode==="flag")return g.isRevealed||(g.isFlagged=!g.isFlagged,i(g.isFlagged?"Flag placed.":"Flag removed.")),{...l,board:f};if(g.isFlagged||g.isRevealed)return l;let h=l.status,w=l.startedAtIso;return l.status==="ready"&&(N(f,l.mines,t,a),h="playing",w=new Date().toISOString()),f[t][a].hasMine?(E(f),i("Boom. You hit a mine."),{...l,board:f,status:"lost",startedAtIso:w}):(C(f,t,a),I(f)?(i("You cleared the minefield."),{...l,board:f,status:"won",startedAtIso:w}):{...l,board:f,status:h,startedAtIso:w})})},o=m.useMemo(()=>{const t=e.board.flat().filter(a=>a.isFlagged).length;return Math.max(0,e.mines-t)},[e.board,e.mines]);return d.jsxs(A,{title:"Minesweeper",children:[d.jsx(y,{children:p}),d.jsxs(y,{children:["Mode: ",e.mode==="reveal"?"Reveal":"Flag"," | Mines left: ",o," | Time: ",e.elapsedSeconds,"s"]}),d.jsxs("div",{className:"slap-button-row",children:[d.jsx(S,{title:e.mode==="reveal"?"Switch To Flag":"Switch To Reveal",onClick:u}),d.jsx(S,{title:"New Game",onClick:c})]}),d.jsx("div",{className:"minesweeper-grid",style:{gridTemplateColumns:`repeat(${e.cols}, 1fr)`},children:e.board.flatMap((t,a)=>t.map((l,f)=>{const g=l.isFlagged?"ðŸš©":l.isRevealed?l.hasMine?"ðŸ’£":l.adjacentMines||"":"",h=["minesweeper-cell",l.isRevealed?"ms-revealed":"ms-hidden",l.isFlagged?"ms-flagged":""].join(" ").trim();return d.jsx("button",{type:"button",className:h,onClick:()=>r(a,f),children:g},`${a}-${f}`)}))})]})},Y={id:"minesweeper",title:"Minesweeper",author:"Joel",description:"Classic minesweeper with reveal/flag mode.",icon:"ðŸ’£",Preview:R,Application:O};export{Y as minesweeperManifest};
