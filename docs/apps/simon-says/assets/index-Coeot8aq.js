import{j as l,r as f}from"./index-DOlX9hb6.js";const D=({title:u,onClick:c,disabled:p})=>l.jsx("button",{type:"button",className:"slap-button",onClick:c,disabled:p,children:u}),T=({children:u})=>l.jsx("p",{className:"slap-inline-text",children:u}),N="simon-says-state.json",y=280,k=1100,v=1e3,H=["#d46a6a","#6b8fd4","#d4b76b","#6cc48b"],X=["#f09f9f","#9fb9f0","#f0d79f","#9fe0b8"],Y=u=>l.jsxs("article",{children:[l.jsx("strong",{children:"Simon Says"}),l.jsx("p",{children:"Repeat the growing light pattern."})]}),B=()=>Math.floor(Math.random()*4),C=(u=0)=>({sequence:[],inputIndex:0,score:0,bestScore:u,status:"idle"}),V=({ctx:u})=>{const[c,p]=f.useState(C),[L,m]=f.useState("Press Start to begin."),[R,I]=f.useState(null),j=f.useRef(null),S=f.useRef([]),M=()=>{for(const t of S.current)window.clearTimeout(t);S.current=[]};f.useEffect(()=>{(async()=>{const t=await u.vfs.readText(N);if(t)try{const e=JSON.parse(t),s=typeof e.bestScore=="number"&&e.bestScore>=0?Math.floor(e.bestScore):0;p(C(s))}catch{m("Saved score data was invalid. Starting fresh.")}})()},[u.vfs]),f.useEffect(()=>{u.vfs.writeText(N,JSON.stringify({bestScore:c.bestScore},null,2))},[u.vfs,c.bestScore]);const P=f.useCallback((t,e)=>{const s=j.current;if(!s)return;const n=s.getContext("2d");if(!n)return;n.clearRect(0,0,y,y);const i=y/2,d=8,o=i-d*1.5,h=t?Math.min(1,(e-t.startedAt)/v):0;for(let r=0;r<4;r=r+1){const J=r<2,g=r===0||r===2?d:i+d/2,b=J?d:i+d/2,E=(t==null?void 0:t.region)===r;if(n.fillStyle=E?X[r]:H[r],n.fillRect(g,b,o,o),!!E){if(r===0){const a=.22+.26*Math.sin(h*Math.PI*3);n.fillStyle=`rgba(255, 255, 255, ${a.toFixed(3)})`,n.fillRect(g+6,b+6,o-12,o-12)}if(r===1){const a=o*.28,x=g+(o+a)*h-a;n.fillStyle="rgba(255, 255, 255, 0.35)",n.fillRect(x,b,a,o)}if(r===2){const a=g+o/2,x=b+o/2;n.strokeStyle="rgba(255, 255, 255, 0.48)",n.lineWidth=2;for(let w=0;w<3;w+=1){const A=(h+w*.2)%1;n.beginPath(),n.arc(a,x,8+A*(o*.42),0,Math.PI*2),n.stroke()}}if(r===3){n.fillStyle="rgba(255, 255, 255, 0.85)";for(let a=0;a<7;a+=1){const x=h*Math.PI*2+a*.9,w=o*(.16+a%3*.08),A=g+o/2+Math.cos(x)*w,z=b+o/2+Math.sin(x)*w;n.fillRect(A-2,z-2,4,4)}}}}},[]);f.useEffect(()=>{let t=null;const e=s=>{P(R,s),R&&(t=window.requestAnimationFrame(e))};return e(window.performance.now()),()=>{t!==null&&window.cancelAnimationFrame(t)}},[P,R]),f.useEffect(()=>()=>{M()},[]);const q=t=>{M(),p(s=>({...s,status:"playingBack",inputIndex:0})),m("Watch the pattern."),t.forEach((s,n)=>{const i=n*k,d=i+v,o=window.setTimeout(()=>I({region:s,startedAt:window.performance.now()}),i),h=window.setTimeout(()=>I(null),d);S.current.push(o,h)});const e=window.setTimeout(()=>{p(s=>({...s,status:"awaitingInput",inputIndex:0})),m("Your turn.")},t.length*k+40);S.current.push(e)},O=()=>{const t=[B()];p(e=>({...e,sequence:t,inputIndex:0,score:0,status:"playingBack"})),q(t)},_=t=>{p(e=>({...e,status:"lost",inputIndex:0,bestScore:Math.max(e.bestScore,t)})),m("Wrong region. Press Restart.")},F=(t,e)=>{const s=[...t,B()];p(n=>({...n,sequence:s,inputIndex:0,score:e,status:"playingBack"})),q(s)},W=t=>{if(c.status!=="awaitingInput")return;I({region:t,startedAt:window.performance.now()});const e=window.setTimeout(()=>I(null),v);S.current.push(e);const s=c.sequence[c.inputIndex];if(t!==s){_(c.score);return}const n=c.inputIndex+1;if(n>=c.sequence.length){const i=c.sequence.length;m("Nice. Next round...");const d=window.setTimeout(()=>F(c.sequence,i),420);S.current.push(d);return}p(i=>({...i,inputIndex:n}))},G=t=>{const e=t.currentTarget.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top,i=s<e.width/2,o=n<e.height/2?i?0:1:i?2:3;W(o)};return l.jsxs("section",{className:"slap-shell",children:[l.jsx(T,{children:"Repeat the lights in order."}),l.jsxs(T,{children:["Score: ",c.score," | Best: ",c.bestScore]}),l.jsx(T,{children:L}),l.jsx("canvas",{ref:j,className:"simon-canvas",width:y,height:y,onPointerDown:G,"aria-label":"Simon Says board"}),l.jsx("div",{className:"simon-controls",children:l.jsx(D,{title:c.status==="idle"?"Start":"Restart",onClick:O})})]})},K={id:"simon-says",title:"Simon Says",author:"Joel",description:"Memorize and repeat a growing light sequence.",icon:"ðŸŸ©",Preview:Y,Application:V};export{K as simonSaysManifest};
