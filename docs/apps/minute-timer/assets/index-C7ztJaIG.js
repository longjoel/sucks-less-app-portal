import{j as t,r as o}from"./index-B2xu2cA_.js";const m=({title:i,onClick:s,disabled:d})=>t.jsx("button",{type:"button",className:"slap-button",onClick:s,disabled:d,children:i}),j=({children:i})=>t.jsx("p",{className:"slap-inline-text",children:i}),g="minute-timer-state.json",C=i=>t.jsxs("article",{children:[t.jsx("strong",{children:"Minute Timer"}),t.jsx("p",{children:"Simple countdown timer with optional notifications."})]}),N=i=>Math.max(1,Math.min(240,Math.floor(i))),O=i=>{const s=Math.floor(i/60),d=i%60;return`${s.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`},P=({ctx:i})=>{const[s,d]=o.useState(5),[M,l]=o.useState(5*60),[e,f]=o.useState(!1),[u,p]=o.useState(null),[x,S]=o.useState(!1),[E,r]=o.useState("Set minutes and press Start."),[w,v]=o.useState(Date.now());o.useEffect(()=>{(async()=>{const a=await i.vfs.readText(g);if(a)try{const n=JSON.parse(a);if(typeof n.minutes=="number"){const h=N(n.minutes);d(h)}if(typeof n.remainingSeconds=="number"&&n.remainingSeconds>=0)l(Math.floor(n.remainingSeconds));else if(typeof n.minutes=="number"){const h=N(n.minutes);l(h*60)}n.notificationsEnabled===!0&&S(!0),n.isRunning===!0&&typeof n.endAtEpochMs=="number"&&(f(!0),p(n.endAtEpochMs),r("Resumed timer."))}catch{r("Saved timer state was invalid.")}})()},[i.vfs]);const c=o.useMemo(()=>!e||u===null?M:Math.max(0,Math.ceil((u-w)/1e3)),[e,u,w,M]);o.useEffect(()=>{i.vfs.writeText(g,JSON.stringify({minutes:s,notificationsEnabled:x,isRunning:e,endAtEpochMs:u,remainingSeconds:c},null,2))},[i.vfs,s,x,e,u,c]),o.useEffect(()=>{if(!e)return;const a=window.setInterval(()=>v(Date.now()),250);return()=>window.clearInterval(a)},[e]),o.useEffect(()=>{!e||u===null||c>0||(f(!1),p(null),l(0),r("Timer complete."),x&&typeof Notification<"u"&&Notification.permission==="granted"&&new Notification("Minute Timer complete",{body:`${s} minute timer finished.`}))},[e,u,c,x,s]);const y=()=>{if(e)return;const a=c>0?c:s*60,n=Date.now()+a*1e3;l(a),p(n),f(!0),r("Running.")},T=()=>{e&&(f(!1),p(null),l(c),r("Paused."))},R=()=>{f(!1),p(null),l(s*60),r("Reset.")},b=a=>{if(e)return;const n=N(s+a);d(n),l(n*60)},A=async()=>{if(typeof Notification>"u"){r("Notifications not supported.");return}await Notification.requestPermission()==="granted"?(S(!0),r("Notifications enabled.")):r("Notification permission not granted.")},k=o.useMemo(()=>O(c),[c]);return t.jsxs("section",{className:"slap-shell",children:[t.jsx(j,{children:"Simple minute countdown timer."}),t.jsx("p",{className:"timer-display",children:k}),t.jsx(j,{children:E}),t.jsxs("div",{className:"timer-minute-controls",children:[t.jsx(m,{title:"-1 min",onClick:()=>b(-1),disabled:e||s<=1}),t.jsxs(j,{children:["Duration: ",t.jsx("strong",{children:s})," min"]}),t.jsx(m,{title:"+1 min",onClick:()=>b(1),disabled:e||s>=240})]}),t.jsxs("div",{className:"slap-button-row",children:[t.jsx(m,{title:e?"Running":"Start",onClick:y,disabled:e}),t.jsx(m,{title:"Pause",onClick:T,disabled:!e}),t.jsx(m,{title:"Reset",onClick:R}),typeof Notification<"u"&&Notification.permission!=="granted"?t.jsx(m,{title:"Enable Notifications",onClick:()=>void A()}):t.jsx(m,{title:x?"Notifications On":"Notifications Off",onClick:()=>S(a=>!a)})]})]})},I={id:"minute-timer",title:"Minute Timer",author:"Joel",description:"Simple minute timer with optional notifications.",icon:"⏲️",Preview:C,Application:P};export{I as minuteTimerManifest};
