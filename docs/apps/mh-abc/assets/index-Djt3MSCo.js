import{j as e,r as i}from"./index-B_f8mrWI.js";const q=({children:n})=>e.jsx("section",{className:"slap-shell",children:n}),D=({title:n})=>e.jsx("h3",{className:"slap-title",children:n}),E=({title:n,onClick:t,disabled:p})=>e.jsx("button",{type:"button",className:"slap-button",onClick:t,disabled:p,children:n}),a=({children:n})=>e.jsx("p",{className:"slap-inline-text",children:n}),j="mh-abc-results.json",L=n=>e.jsxs("article",{children:[e.jsx("strong",{children:"ABC Worksheet"}),e.jsx("p",{children:"ABC worksheet entries with trends and export."})]}),U=n=>{if(typeof n!="object"||n===null)return!1;const t=n;return typeof t.id=="string"&&t.type==="abc"&&typeof t.createdAtIso=="string"&&typeof t.activatingEvent=="string"&&typeof t.beliefs=="string"&&typeof t.consequences=="string"&&(typeof t.disputation=="string"||typeof t.disputation>"u")&&(typeof t.effectiveBelief=="string"||typeof t.effectiveBelief>"u")&&(typeof t.distressBefore=="number"||typeof t.distressBefore>"u")&&(typeof t.distressAfter=="number"||typeof t.distressAfter>"u")},O=n=>({app:"slap-mh-abc",version:1,records:n}),R=n=>{const t=new Date(n);return Number.isNaN(t.getTime())?"Unknown":`${t.toLocaleDateString()} ${t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},M=n=>{const t=[...n].sort((r,d)=>r.createdAtIso.localeCompare(d.createdAtIso));if(t.length===0)return"No trend data yet.";const p=t.filter(r=>typeof r.distressBefore=="number"&&typeof r.distressAfter=="number");if(p.length===0)return"Trend tip: include distress before/after (0-10) to track change over time.";const u=p.slice(-5),o=u.reduce((r,d)=>r+(d.distressBefore??0),0)/u.length,c=u.reduce((r,d)=>r+(d.distressAfter??0),0)/u.length,f=o-c;return Math.abs(f)<.2?`Recent distress change: stable (${o.toFixed(1)} -> ${c.toFixed(1)}).`:f>0?`Recent distress change: improved by ${f.toFixed(1)} points (${o.toFixed(1)} -> ${c.toFixed(1)}).`:`Recent distress change: increased by ${Math.abs(f).toFixed(1)} points (${o.toFixed(1)} -> ${c.toFixed(1)}).`},T=n=>{if(!n.trim())return;const t=Number(n);return Number.isNaN(t)||t<0||t>10?Number.NaN:t},P=({ctx:n})=>{const[t,p]=i.useState([]),[u,o]=i.useState(""),[c,f]=i.useState(""),[r,d]=i.useState(""),[b,v]=i.useState(""),[g,y]=i.useState(""),[A,N]=i.useState(""),[w,B]=i.useState(""),[C,S]=i.useState(""),I=async s=>{await n.vfs.writeText(j,JSON.stringify(O(s),null,2)),p(s)};i.useEffect(()=>{(async()=>{const s=await n.vfs.readText(j);if(s){try{const l=JSON.parse(s);if(typeof l=="object"&&l!==null){const h=l;Array.isArray(h.records)&&p(h.records.filter(U))}}catch{o("Saved data was unreadable. Starting fresh.")}return}})()},[n.vfs]);const $=async()=>{if(!c.trim()||!r.trim()||!b.trim()){o("Please fill A (event), B (beliefs), and C (consequences).");return}const s=T(w),l=T(C);if(Number.isNaN(s)||Number.isNaN(l)){o("Distress values must be between 0 and 10.");return}const m=[{id:crypto.randomUUID(),type:"abc",createdAtIso:new Date().toISOString(),activatingEvent:c.trim(),beliefs:r.trim(),consequences:b.trim(),disputation:g.trim()||void 0,effectiveBelief:A.trim()||void 0,distressBefore:s,distressAfter:l},...t].slice(0,300);await I(m),o("ABC worksheet saved."),f(""),d(""),v(""),y(""),N(""),B(""),S("")},W=async()=>{const s=await n.vfs.readText(j);if(!s){o("No results to export yet.");return}const l=new Blob([s],{type:"application/json"}),h=URL.createObjectURL(l),m=document.createElement("a");m.href=h,m.download="abc-worksheet-results.json",m.click(),URL.revokeObjectURL(h)},x=i.useMemo(()=>[...t].sort((s,l)=>l.createdAtIso.localeCompare(s.createdAtIso)),[t]),k=x[0]??null,F=M(t);return e.jsxs(q,{title:"ABC Worksheet",children:[e.jsx(D,{title:"ABC Worksheet"}),e.jsx(a,{children:"Worksheet support only, not a diagnosis. If you are in immediate danger, call 911 or local emergency services."}),e.jsx("div",{className:"slap-button-row",children:e.jsx(E,{title:"Export Results",onClick:()=>void W()})}),k?e.jsxs(a,{children:["Last ABC worksheet saved: ",R(k.createdAtIso)]}):e.jsx(a,{children:"No ABC worksheets saved yet."}),e.jsx(a,{children:F}),u?e.jsx(a,{children:u}):null,e.jsx(D,{title:`History (${x.length})`}),x.length===0?e.jsx(a,{children:"No history yet."}):null,x.map(s=>e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsxs("strong",{children:[R(s.createdAtIso)," | ABC Worksheet"]})}),e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[e.jsxs(a,{children:["A: ",s.activatingEvent]}),e.jsxs(a,{children:["B: ",s.beliefs]}),e.jsxs(a,{children:["C: ",s.consequences]}),s.disputation?e.jsxs(a,{children:["D: ",s.disputation]}):null,s.effectiveBelief?e.jsxs(a,{children:["E: ",s.effectiveBelief]}):null,typeof s.distressBefore=="number"?e.jsxs(a,{children:["Distress before: ",s.distressBefore,"/10"]}):null,typeof s.distressAfter=="number"?e.jsxs(a,{children:["Distress after: ",s.distressAfter,"/10"]}):null]})]},s.id)),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"A: Activating Event"}),e.jsx("textarea",{className:"slap-input",rows:3,value:c,onChange:s=>f(s.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"B: Beliefs / Thoughts"}),e.jsx("textarea",{className:"slap-input",rows:3,value:r,onChange:s=>d(s.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"C: Consequences (emotions/behaviors)"}),e.jsx("textarea",{className:"slap-input",rows:3,value:b,onChange:s=>v(s.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"D: Dispute / Reframe (optional)"}),e.jsx("textarea",{className:"slap-input",rows:2,value:g,onChange:s=>y(s.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"E: Effective New Belief (optional)"}),e.jsx("textarea",{className:"slap-input",rows:2,value:A,onChange:s=>N(s.target.value)})]}),e.jsxs("div",{className:"slap-button-row",children:[e.jsxs("label",{className:"slap-input-wrap",style:{maxWidth:"140px"},children:[e.jsx("span",{children:"Distress Before (0-10)"}),e.jsx("input",{className:"slap-input",type:"number",min:0,max:10,value:w,onChange:s=>B(s.target.value)})]}),e.jsxs("label",{className:"slap-input-wrap",style:{maxWidth:"140px"},children:[e.jsx("span",{children:"Distress After (0-10)"}),e.jsx("input",{className:"slap-input",type:"number",min:0,max:10,value:C,onChange:s=>S(s.target.value)})]})]}),e.jsx(E,{title:"Save ABC Worksheet",onClick:()=>void $()})]})},V={id:"mh-abc",title:"ABC Worksheet",author:"Joel",description:"ABC worksheet entries with trends and export.",icon:"ABC",Preview:L,Application:P};export{V as mhAbcManifest};
