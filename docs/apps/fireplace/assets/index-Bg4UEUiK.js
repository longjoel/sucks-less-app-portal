import{j as l,r as i}from"./index-DB6spd2s.js";const pe=({children:e})=>l.jsx("section",{className:"slap-shell",children:e}),me=({title:e})=>l.jsx("h3",{className:"slap-title",children:e}),O=({title:e,onClick:o,disabled:t})=>l.jsx("button",{type:"button",className:"slap-button",onClick:o,disabled:t,children:e}),F=({children:e})=>l.jsx("p",{className:"slap-inline-text",children:e}),ee=480,ve=e=>l.jsxs("article",{children:[l.jsx("strong",{children:"Fireplace"}),l.jsx("p",{children:"Old school particle flames with motion and sound boost."})]}),x=(e,o,t)=>Math.min(t,Math.max(o,e)),f=(e,o)=>e+Math.random()*(o-e),ge=(e,o=.06)=>{const t=Math.floor(e.sampleRate*o),s=e.createBuffer(1,t,e.sampleRate),c=s.getChannelData(0);for(let h=0;h<t;h+=1)c[h]=(Math.random()*2-1)*.6;return s},he=(e,o,t,s)=>{const c=x(s-1,0,3),h=1+c*.25,m=1+c*.08,g=1+c*.12,k=f(-Math.PI*.65,-Math.PI*.35),S=f(35,65)*m;return{x:e+f(-18,18),y:o+f(-4,4),vx:Math.cos(k)*S+t*20,vy:Math.sin(k)*S,size:f(6,14)*h,life:f(.6,1.1)*g,age:0,kind:"flame"}},be=(e,o,t,s,c)=>{const h=x(s-1,0,3),m=1+h*.22,g=1+h*.35,k=1+c*1.8,S=f(-Math.PI*.95,-Math.PI*.45),D=f(16,28)*(1+c*.25),C=f(-12,12)*k;return{x:e+f(-20,20)*k,y:o+f(-6,6),vx:Math.cos(S)*D+t*15+C,vy:Math.sin(S)*D,size:f(12,22)*m,life:f(2.2,3.6)*g,age:0,kind:"smoke"}},we=(e,o,t)=>{const s=e.createLinearGradient(0,0,0,t);s.addColorStop(0,"#14110d"),s.addColorStop(1,"#2f1f12"),e.fillStyle=s,e.fillRect(0,0,o,t);const c=e.createRadialGradient(o/2,t*.82,5,o/2,t*.82,t*.35);c.addColorStop(0,"rgba(255, 184, 92, 0.35)"),c.addColorStop(1,"rgba(255, 184, 92, 0)"),e.fillStyle=c,e.fillRect(0,t*.5,o,t*.5),e.fillStyle="#2d1b0f",e.fillRect(o*.18,t*.84,o*.64,t*.08),e.fillStyle="#3c2615",e.fillRect(o*.2,t*.9,o*.6,t*.06)},Me=(e,o)=>{e.save(),e.globalCompositeOperation="lighter";for(const t of o){if(t.kind!=="flame")continue;const s=t.age/t.life,c=1-s,h=t.size*(1+s*.6),m=x(.9*(1-s),0,.9),g=Math.round(200+55*c),k=Math.round(80+130*c),S=Math.round(20+40*c);e.fillStyle=`rgba(${g}, ${k}, ${S}, ${m})`,e.beginPath(),e.ellipse(t.x,t.y,h*.7,h,0,0,Math.PI*2),e.fill()}e.restore(),e.save(),e.globalCompositeOperation="source-over";for(const t of o){if(t.kind!=="smoke")continue;const s=t.age/t.life,c=t.size*(1+s*.8),h=x(.35*(1-s),0,.35),m=Math.round(90+50*s);e.fillStyle=`rgba(${m}, ${m}, ${m}, ${h})`,e.beginPath(),e.ellipse(t.x,t.y,c*.8,c,0,0,Math.PI*2),e.fill()}e.restore()},Se=()=>{var Z;const e=i.useRef(null),o=i.useRef(null),t=i.useRef([]),s=i.useRef([{id:"base",relativeX:.5,relativeY:.82,age:0,ttl:null,boost:0,flameSpawn:0,smokeSpawn:0}]),c=i.useRef({width:320,height:420}),h=i.useRef(null),m=i.useRef(0),g=i.useRef({active:!1,lastX:0,lastTime:0}),k=i.useRef("idle"),S=i.useRef(0),D=i.useRef(0),C=i.useRef(null),w=i.useRef(null),I=i.useRef(null),_=i.useRef(0),[R,L]=i.useState("idle"),[T,X]=i.useState("idle"),[P,$]=i.useState("idle"),[te,ne]=i.useState("still"),[re,J]=i.useState(0),[ie,H]=i.useState(1),[oe,Q]=i.useState(0),V=typeof window<"u"&&"DeviceMotionEvent"in window,Y=typeof navigator<"u"&&!!((Z=navigator.mediaDevices)!=null&&Z.getUserMedia),K=typeof window<"u"&&("AudioContext"in window||"webkitAudioContext"in window);i.useEffect(()=>{k.current=R},[R]),i.useEffect(()=>{const r=e.current;if(!r)return;const u=()=>{const p=r.getBoundingClientRect(),v=Math.max(200,p.width),M=Math.max(240,p.height),a=window.devicePixelRatio||1;r.width=Math.floor(v*a),r.height=Math.floor(M*a);const y=r.getContext("2d");y&&y.setTransform(a,0,0,a,0,0),c.current={width:v,height:M}};u(),window.addEventListener("resize",u);const d=p=>{const v=r.getContext("2d");if(!v)return;const M=h.current??p,a=Math.min(.05,(p-M)/1e3);h.current=p;const y=c.current,z=x(m.current,-1,1),j=S.current,A=1+j*2.2;_.current=A,w.current&&(w.current.gain.gain.value=x(.03+A*.02,.02,.12));const W=s.current;for(let b=W.length-1;b>=0;b-=1){const n=W[b];if(n.ttl!==null&&(n.age+=a,n.age>=n.ttl)){W.splice(b,1);continue}const E=A+n.boost,U=58*E,B=18*(.7+E*.45);n.flameSpawn+=a*U,n.smokeSpawn+=a*B;const q=y.width*n.relativeX+z*10,N=y.height*n.relativeY;for(;n.flameSpawn>=1;)t.current.push(he(q,N,z,E)),n.flameSpawn-=1;for(;n.smokeSpawn>=1;)t.current.push(be(q,N,z,E,j)),n.smokeSpawn-=1}t.current.length>ee&&t.current.splice(0,t.current.length-ee),!g.current.active&&k.current!=="active"&&(m.current*=.965,Math.abs(m.current)<.01&&(m.current=0));const G=t.current;for(let b=G.length-1;b>=0;b-=1){const n=G[b];if(n.age+=a,n.age>=n.life){G.splice(b,1);continue}const E=n.kind==="flame"?-24:-20,U=n.kind==="flame"?18:6;if(n.vx+=z*U*a,n.vx+=(Math.random()-.5)*(n.kind==="flame"?8:4)*a,n.vy+=E*a,n.x+=n.vx*a,n.y+=n.vy*a,n.kind==="smoke"){const B=j;n.vx+=(Math.random()-.5)*(6+B*24)*a,n.vx*=.992,n.vy*=.996}else n.vx*=.985,n.vy*=.99}if(C.current){const{analyser:b,data:n}=C.current;b.getByteTimeDomainData(n);let E=0;for(const q of n){const N=(q-128)/128;E+=N*N}const U=Math.sqrt(E/n.length),B=x(U*2.2,0,1);S.current=B,p-D.current>200&&J(Math.round(B*100))}else S.current=0,p-D.current>200&&J(0);if(p-D.current>200){const b=m.current,n=b>.1?"right":b<-.1?"left":"still";ne(`${n} ${Math.round(Math.abs(b)*100)}%`),H(s.current.length),Q(Math.max(0,s.current.length-1)),D.current=p}we(v,y.width,y.height),Me(v,G),o.current=requestAnimationFrame(d)};return o.current=requestAnimationFrame(d),()=>{window.removeEventListener("resize",u),o.current!==null&&(cancelAnimationFrame(o.current),o.current=null)}},[]),i.useEffect(()=>{if(!V||R!=="active")return;const r=u=>{const d=u.accelerationIncludingGravity;if(!d)return;const p=d.x??0,v=x(p/5,-1,1);m.current=m.current*.9+v*.1};return window.addEventListener("devicemotion",r),()=>{window.removeEventListener("devicemotion",r)}},[R,V]),i.useEffect(()=>{if(T!=="active"){C.current&&(C.current.stream.getTracks().forEach(r=>r.stop()),C.current.ctx.close(),C.current=null);return}if(!Y){X("unavailable");return}(async()=>{try{const r=await navigator.mediaDevices.getUserMedia({audio:!0}),u=new(window.AudioContext||window.webkitAudioContext),d=u.createAnalyser();d.fftSize=256,u.createMediaStreamSource(r).connect(d);const v=new Uint8Array(d.fftSize);C.current={ctx:u,analyser:d,data:v,stream:r}}catch{X("denied")}})()},[T,Y]),i.useEffect(()=>{if(P!=="active"){I.current!==null&&(window.clearTimeout(I.current),I.current=null),w.current&&(w.current.ctx.close(),w.current=null);return}if(!K){$("unavailable");return}if(w.current)return;const r=window.AudioContext||window.webkitAudioContext;if(!r){$("unavailable");return}const u=new r,d=u.createGain();d.gain.value=.05,d.connect(u.destination);const p=ge(u);w.current={ctx:u,gain:d,buffer:p},u.resume();const v=()=>{if(!w.current)return;const{ctx:a,gain:y,buffer:z}=w.current,j=a.createBufferSource();j.buffer=z,j.playbackRate.value=f(.7,1.4);const A=a.createGain();A.gain.setValueAtTime(1e-4,a.currentTime),A.gain.linearRampToValueAtTime(f(.02,.08),a.currentTime+.01),A.gain.exponentialRampToValueAtTime(1e-4,a.currentTime+f(.06,.12)),j.connect(A),A.connect(y),j.start(),j.stop(a.currentTime+.15)},M=()=>{if(!w.current)return;const a=x(_.current,0,3),z=x(230-a*40,70,230)+f(-20,40);I.current=window.setTimeout(()=>{v(),M()},z)};return M(),()=>{I.current!==null&&(window.clearTimeout(I.current),I.current=null),w.current&&(w.current.ctx.close(),w.current=null)}},[P,K]);const ae=async()=>{if(!V){L("unavailable");return}if(R==="active"){L("idle");return}const r=DeviceMotionEvent;if(typeof(r==null?void 0:r.requestPermission)=="function")try{if(await r.requestPermission()!=="granted"){L("denied");return}}catch{L("denied");return}L("active")},se=()=>{if(T==="active"){X("idle");return}if(!Y){X("unavailable");return}X("active")},ce=()=>{if(P==="active"){$("idle");return}if(!K){$("unavailable");return}$("active")},le=()=>{const r=s.current;if(r.length>=10){let d=-1,p=-1;for(let v=0;v<r.length;v+=1){const M=r[v];M.id!=="base"&&M.age>p&&(p=M.age,d=v)}d>=0&&r.splice(d,1)}const u={id:crypto.randomUUID(),relativeX:f(.28,.72),relativeY:f(.79,.86),age:0,ttl:f(14,24),boost:f(.6,1.5),flameSpawn:0,smokeSpawn:0};r.push(u),H(r.length),Q(Math.max(0,r.length-1))},ue=i.useMemo(()=>R==="active"?"Disable Motion":R==="unavailable"?"Motion Unsupported":R==="denied"?"Motion Denied":"Enable Motion",[R]),fe=i.useMemo(()=>T==="active"?"Disable Mic":T==="unavailable"?"Mic Unsupported":T==="denied"?"Mic Denied":"Enable Mic",[T]),de=i.useMemo(()=>P==="active"?"Disable Crackle":P==="unavailable"?"Crackle Unsupported":"Enable Crackle",[P]);return l.jsxs(pe,{title:"Fireplace",children:[l.jsx(me,{title:"Fireplace"}),l.jsx(F,{children:"Old school particle flames and smoke. Tilt or make noise to stoke the fire."}),l.jsxs("div",{className:"slap-button-row",children:[l.jsx(O,{title:ue,onClick:()=>void ae(),disabled:R==="unavailable"}),l.jsx(O,{title:fe,onClick:se,disabled:T==="unavailable"}),l.jsx(O,{title:de,onClick:ce,disabled:P==="unavailable"}),l.jsx(O,{title:"Add Kindling",onClick:le})]}),l.jsxs(F,{children:["Wind: ",te]}),l.jsxs(F,{children:["Mic boost: ",T==="active"?`${re}%`:"off"]}),l.jsxs(F,{children:["Crackle: ",P==="active"?"on":"off"]}),l.jsxs(F,{children:["Fires: ",ie," (kindling piles: ",oe,")"]}),l.jsx("div",{className:"fireplace-stage",children:l.jsx("canvas",{ref:e,className:"fireplace-canvas",onPointerDown:r=>{g.current.active=!0,g.current.lastX=r.clientX,g.current.lastTime=performance.now(),r.currentTarget.setPointerCapture(r.pointerId)},onPointerMove:r=>{if(!g.current.active)return;const u=performance.now(),d=r.clientX-g.current.lastX,p=Math.max(1,u-g.current.lastTime),v=d/p,M=x(v*1.5,-1,1);m.current=m.current*.7+M*.3,g.current.lastX=r.clientX,g.current.lastTime=u},onPointerUp:()=>{g.current.active=!1},onPointerCancel:()=>{g.current.active=!1},onPointerLeave:()=>{g.current.active=!1}})}),l.jsx(F,{children:"Tip: Drag on the fire to simulate wind. Tap Enable Motion or Enable Mic to grant permissions on mobile."})]})},ke={id:"fireplace",title:"Fireplace",author:"Joel",description:"Cozy particle fire with motion and sound response.",icon:"FIRE",Preview:ve,Application:Se};export{ke as fireplaceManifest};
