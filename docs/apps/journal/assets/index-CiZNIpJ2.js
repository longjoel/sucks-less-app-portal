import{j as e,r as l}from"./index-C0sdWqaw.js";const X=({children:r})=>e.jsx("section",{className:"slap-shell",children:r}),J=({title:r})=>e.jsx("h3",{className:"slap-title",children:r}),m=({title:r,onClick:o,disabled:d})=>e.jsx("button",{type:"button",className:"slap-button",onClick:o,disabled:d,children:r}),O=({label:r,value:o,onChange:d,type:f="text"})=>e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:r}),e.jsx("input",{className:"slap-input",type:f,value:o,onChange:s=>d(s.target.value)})]}),u=({children:r})=>e.jsx("p",{className:"slap-inline-text",children:r}),Y=["your energy","your focus","your patience","your confidence","your boundaries","your rest","your creativity","your relationships","your communication","your priorities","your stress","your attention","your routines","your motivation","your curiosity","your gratitude","your self-talk","your momentum","your courage","your discipline","your clarity","your work","your home life","your friendships","your health","your expectations","your progress","your mindset"],Z=["What is one small thing that could improve {topic} today?","What challenged {topic} the most this week?","Where did you notice growth in {topic} recently?","What would future-you thank you for doing about {topic} today?","What is one belief affecting {topic} right now?","How has {topic} changed over the last month?","What feels unresolved about {topic}?","What helped {topic} most today?","What drained {topic} today?","What does enough look like for {topic} right now?","What boundary could protect {topic} this week?","What habit is helping {topic} and should be kept?","What habit is hurting {topic} and should be changed?","What conversation might improve {topic}?","What are you avoiding that affects {topic}?","What is one brave step you can take for {topic}?","What would make {topic} feel lighter tomorrow?","What did you learn about {topic} today?","What are three words that describe {topic} right now?","What support would strengthen {topic}?","How would you coach a friend through {topic}?","What are you proud of regarding {topic}?","What would simplify {topic} this week?","What does a realistic next step for {topic} look like?","If you gave {topic} 10 focused minutes, what would you do first?"],c=Y.flatMap(r=>Z.map(o=>o.replace("{topic}",r)));if(c.length!==700)throw new Error(`Expected 700 journal prompts, got ${c.length}.`);const P=["None","Great","Good","Okay","Tired","Stressed","Anxious","Sad","Excited","Grateful","Custom"],b="journal.json",tt=r=>e.jsxs("article",{children:[e.jsx("strong",{children:"Journal"}),e.jsx("p",{children:"Mood check-in plus optional writing prompts."})]}),R=r=>{if(typeof r!="object"||r===null)return null;const o=r;return typeof o.id!="string"||typeof o.createdAtIso!="string"||typeof o.updatedAtIso!="string"||typeof o.subject!="string"||typeof o.body!="string"?null:{id:o.id,createdAtIso:o.createdAtIso,updatedAtIso:o.updatedAtIso,subject:o.subject,body:o.body,mood:typeof o.mood=="string"&&o.mood.trim()?o.mood:"Unspecified",promptQuestion:typeof o.promptQuestion=="string"?o.promptQuestion:void 0}},U=r=>{if(typeof r!="object"||r===null)return!1;const o=r;return o.app==="slap-journal"&&o.version===1&&o.encrypted===!1&&Array.isArray(o.entries)},Q=r=>{const o=new Date(r);return Number.isNaN(o.getTime())?{date:"Unknown",time:"Unknown"}:{date:o.toLocaleDateString(),time:o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}},k=r=>({app:"slap-journal",version:1,encrypted:!1,entries:r}),E=r=>{if(c.length===0)return"";if(c.length===1)return c[0];let o=c[Math.floor(Math.random()*c.length)];for(;o===r;)o=c[Math.floor(Math.random()*c.length)];return o},v=({html:r,className:o})=>e.jsx("div",{className:o??"slap-markdown",dangerouslySetInnerHTML:{__html:r}}),et=({ctx:r})=>{const[o,d]=l.useState(!0),[f,s]=l.useState(null),[S,N]=l.useState(""),[x,I]=l.useState(""),[j,H]=l.useState(P[0]),[A,_]=l.useState(""),[M,W]=l.useState(()=>E()),[g,p]=l.useState([]),[C,y]=l.useState(!1),T=l.useRef(null),D=l.useMemo(()=>[...g].sort((t,n)=>n.createdAtIso.localeCompare(t.createdAtIso)),[g]),w=async t=>{await r.vfs.writeText(b,JSON.stringify(t,null,2))},L=async t=>{await w(k(t)),p(t)},F=async()=>{d(!0),s(null);try{const t=await r.vfs.readText(b);if(!t){const a=k([]);await w(a),p([]),y(!1);return}const n=JSON.parse(t);if(U(n)){p(n.entries.map(R).filter(a=>a!==null)),y(!1);return}const i=n;if(i&&i.encrypted===!0){y(!0),p([]),s("Legacy locked journal detected. Reset journal data to continue without password.");return}throw new Error("journal.json has an unsupported format.")}catch(t){s(t instanceof Error?t.message:"Failed to load journal.")}finally{d(!1)}};l.useEffect(()=>{F()},[r.vfs]);const B=async()=>{s(null);const t=j==="Custom"?A.trim()||"None":j;if(!x.trim()){s("Entry text is required.");return}const n=new Date().toISOString(),i=`Entry ${new Date(n).toLocaleDateString()} ${new Date(n).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,a={id:crypto.randomUUID(),createdAtIso:n,updatedAtIso:n,subject:S.trim()||i,body:x.trim(),mood:t,promptQuestion:M||void 0};try{await L([a,...g]),N(""),I(""),W(h=>E(h))}catch(h){s(h instanceof Error?h.message:"Failed to save entry.")}},G=async t=>{s(null);try{await L(g.filter(n=>n.id!==t))}catch(n){s(n instanceof Error?n.message:"Failed to delete entry.")}},$=async()=>{s(null);try{const t=await r.vfs.readText(b);if(!t){s("No journal data found to export.");return}const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),a=document.createElement("a");a.href=i,a.download="journal.json",a.click(),URL.revokeObjectURL(i)}catch(t){s(t instanceof Error?t.message:"Export failed.")}},z=async t=>{const n=JSON.parse(t);if(!U(n))throw new Error("Only non-encrypted journal.json imports are supported.");const i={...n,entries:n.entries.map(R).filter(a=>a!==null)};await w(i),p(i.entries),y(!1)},q=async t=>{var i;const n=((i=t.target.files)==null?void 0:i[0])??null;if(t.target.value="",!!n){s(null);try{const a=await n.text();await z(a)}catch(a){s(a instanceof Error?a.message:"Import failed.")}}},K=async()=>{s(null);try{await w(k([])),p([]),y(!1)}catch(t){s(t instanceof Error?t.message:"Reset failed.")}};return e.jsxs(X,{title:"Journal",children:[e.jsx(J,{title:"New Entry"}),o?e.jsx(u,{children:"Loading journal..."}):null,f?e.jsxs(u,{children:["Error: ",f]}):null,e.jsx("input",{ref:T,type:"file",accept:"application/json,.json",onChange:t=>void q(t),style:{display:"none"}}),!o&&!C?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Mood"}),e.jsx("select",{className:"slap-input",value:j,onChange:t=>H(t.target.value),children:P.map(t=>e.jsx("option",{value:t,children:t},t))})]}),j==="Custom"?e.jsx(O,{label:"Custom Mood",value:A,onChange:_}):null,e.jsx(O,{label:"Subject (optional)",value:S,onChange:N}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Entry"}),e.jsx("textarea",{className:"slap-input",rows:5,value:x,placeholder:M,onChange:t=>I(t.target.value)})]}),e.jsxs("div",{className:"slap-button-row",children:[e.jsx(m,{title:"New Prompt",onClick:()=>W(t=>E(t))}),e.jsx(m,{title:"Save Entry",onClick:()=>void B()})]}),e.jsx(J,{title:"Entries"}),D.length===0?e.jsx(u,{children:"No entries yet."}):null,D.map(t=>{const n=Q(t.createdAtIso),i=Q(t.updatedAtIso),a=r.renderMarkdown(t.subject),h=r.renderMarkdown(t.body),V=t.promptQuestion?r.renderMarkdown(t.promptQuestion):"";return e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsx("strong",{children:t.subject})}),e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[e.jsx(v,{html:a,className:"slap-markdown slap-markdown-title"}),e.jsxs(u,{children:["Mood: ",t.mood]}),e.jsxs(u,{children:["Created: ",n.date," at ",n.time]}),e.jsxs(u,{children:["Updated: ",i.date," at ",i.time]}),t.body?e.jsx(v,{html:h}):null,t.promptQuestion?e.jsxs(e.Fragment,{children:[e.jsx(u,{children:"Prompt"}),e.jsx(v,{html:V})]}):null,e.jsx(m,{title:"Delete",onClick:()=>void G(t.id)})]})]},t.id)})]}):null,e.jsxs("div",{className:"slap-button-row",children:[e.jsx(m,{title:"Export journal.json",onClick:()=>void $()}),e.jsx(m,{title:"Import journal.json",onClick:()=>{var t;return(t=T.current)==null?void 0:t.click()}}),C?e.jsx(m,{title:"Reset Journal",onClick:()=>void K()}):null]})]})},rt={id:"journal",title:"Journal",author:"Joel",description:"Mood-aware journal with 700 optional prompts.",icon:"ðŸ““",Preview:tt,Application:et};export{rt as journalManifest};
