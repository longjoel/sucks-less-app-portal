import{j as e,r}from"./index-DFj94Zz6.js";const p=({title:s,onClick:t,disabled:a})=>e.jsx("button",{type:"button",className:"slap-button",onClick:t,disabled:a,children:s}),T=({label:s,value:t,onChange:a,type:c="text"})=>e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:s}),e.jsx("input",{className:"slap-input",type:c,value:t,onChange:d=>a(d.target.value)})]}),m=({children:s})=>e.jsx("p",{className:"slap-inline-text",children:s}),x="countdown-state.json",A=24*60*60*1e3,E=s=>e.jsxs("article",{children:[e.jsx("strong",{children:"Countdown"}),e.jsx("p",{children:"Track days until important dates."})]}),N=s=>new Date(s.getFullYear(),s.getMonth(),s.getDate()),S=s=>{const t=s.split("-").map(l=>Number.parseInt(l,10));if(t.length!==3||t.some(l=>Number.isNaN(l)))return null;const[a,c,d]=t;return new Date(a,c-1,d)},w=s=>{const t=S(s);if(!t)return null;const a=N(new Date),c=N(t);return Math.ceil((c.getTime()-a.getTime())/A)},C=s=>{if(typeof s!="object"||s===null)return null;const t=s;return typeof t.id!="string"||typeof t.title!="string"||typeof t.targetDate!="string"||typeof t.createdAtIso!="string"?null:{id:t.id,title:t.title,targetDate:t.targetDate,createdAtIso:t.createdAtIso}},k=()=>({items:[],notificationsEnabled:!1,notifiedItemIds:[]}),$=({ctx:s})=>{const[t,a]=r.useState(k),[c,d]=r.useState("Add something to count down to."),[l,h]=r.useState(""),[f,I]=r.useState("");r.useEffect(()=>{(async()=>{const i=await s.vfs.readText(x);if(i)try{const n=JSON.parse(i),o=Array.isArray(n.items)?n.items.map(C).filter(g=>g!==null):[],u=Array.isArray(n.notifiedItemIds)?n.notifiedItemIds.filter(g=>typeof g=="string"):[];a({items:o,notificationsEnabled:n.notificationsEnabled===!0,notifiedItemIds:u})}catch{d("Saved countdown data was invalid. Loaded defaults.")}})()},[s.vfs]),r.useEffect(()=>{s.vfs.writeText(x,JSON.stringify(t,null,2))},[s.vfs,t]),r.useEffect(()=>{if(!t.notificationsEnabled||typeof Notification>"u"||Notification.permission!=="granted")return;const n=t.items.filter(o=>w(o.targetDate)===0).filter(o=>!t.notifiedItemIds.includes(o.id));if(n.length!==0){for(const o of n)new Notification(`Today: ${o.title}`,{body:`Your countdown has reached ${o.targetDate}.`});a(o=>({...o,notifiedItemIds:[...o.notifiedItemIds,...n.map(u=>u.id)]}))}},[t.items,t.notificationsEnabled,t.notifiedItemIds]);const j=async()=>{if(typeof Notification>"u"){d("Notifications are not supported in this browser.");return}await Notification.requestPermission()==="granted"?(a(n=>({...n,notificationsEnabled:!0})),d("Notifications enabled.")):d("Notification permission not granted.")},b=()=>{a(i=>({...i,notificationsEnabled:!i.notificationsEnabled})),d(t.notificationsEnabled?"Notifications disabled.":"Notifications enabled if permission is granted.")},D=()=>{const i=l.trim();if(!i){d("Please enter a title.");return}if(!f||w(f)===null){d("Please choose a valid target date.");return}const n={id:`countdown-${Date.now()}`,title:i,targetDate:f,createdAtIso:new Date().toISOString()};a(o=>({...o,items:[n,...o.items]})),h(""),d(`Added countdown for ${i}.`)},v=i=>{a(n=>({...n,items:n.items.filter(o=>o.id!==i),notifiedItemIds:n.notifiedItemIds.filter(o=>o!==i)})),d("Countdown removed.")},y=r.useMemo(()=>[...t.items].sort((i,n)=>new Date(n.createdAtIso).getTime()-new Date(i.createdAtIso).getTime()),[t.items]);return e.jsxs("section",{className:"slap-shell",children:[e.jsx(m,{children:"Track how many days until upcoming events."}),e.jsx(m,{children:c}),e.jsxs("div",{className:"countdown-form",children:[e.jsx(T,{label:"Event",value:l,onChange:h}),e.jsxs("label",{className:"slap-input-wrap",children:[e.jsx("span",{children:"Target Date"}),e.jsx("input",{className:"slap-input",type:"date",value:f,onChange:i=>I(i.target.value)})]})]}),e.jsxs("div",{className:"slap-button-row",children:[e.jsx(p,{title:"Add Countdown",onClick:D}),typeof Notification<"u"&&Notification.permission!=="granted"?e.jsx(p,{title:"Enable Notifications",onClick:()=>void j()}):e.jsx(p,{title:t.notificationsEnabled?"Disable Notifications":"Enable Notifications",onClick:b})]}),e.jsxs("section",{className:"countdown-list",children:[y.length===0?e.jsx(m,{children:"No countdowns yet."}):null,y.map(i=>{const n=w(i.targetDate),o=n===0,u=typeof n=="number"&&n<0;return e.jsxs("article",{className:`countdown-card${o?" countdown-due":""}`,children:[e.jsxs("div",{className:"countdown-card-head",children:[e.jsx("strong",{children:i.title}),e.jsx(p,{title:"Remove",onClick:()=>v(i.id)})]}),e.jsx("p",{className:"countdown-main-value",children:n===null?"--":o?"Today":u?`${Math.abs(n)} days ago`:`${n} days`}),e.jsxs(m,{children:["Target: ",i.targetDate]})]},i.id)})]})]})},P={id:"countdown",title:"Countdown",author:"Joel",description:"Track days until upcoming events with optional notifications.",icon:"‚è≥",Preview:E,Application:$};export{P as countdownManifest};
