import{j as e,r as g}from"./index-Bxdx_4Mr.js";const $=({children:t})=>e.jsx("section",{className:"slap-shell",children:t}),b=({title:t})=>e.jsx("h3",{className:"slap-title",children:t}),w=({title:t,onClick:r,disabled:i})=>e.jsx("button",{type:"button",className:"slap-button",onClick:r,disabled:i,children:t}),l=({children:t})=>e.jsx("p",{className:"slap-inline-text",children:t}),v="mh-phq9-results.json",R=[0,1,2,3],S=["Not at all","Several days","More than half the days","Nearly every day"],c={id:"phq9",title:"PHQ-9",maxScore:27,questions:["Little interest or pleasure in doing things","Feeling down, depressed, or hopeless","Trouble falling or staying asleep, or sleeping too much","Feeling tired or having little energy","Poor appetite or overeating","Feeling bad about yourself or that you are a failure","Trouble concentrating on things","Moving or speaking slowly, or being fidgety/restless","Thoughts that you would be better off dead or hurting yourself"],getSeverity:t=>t<=4?"Minimal":t<=9?"Mild":t<=14?"Moderate":t<=19?"Moderately Severe":"Severe"},P=t=>e.jsxs("article",{children:[e.jsx("strong",{children:"PHQ-9 Check-in"}),e.jsx("p",{children:"PHQ-9 screening with history, trends, and export."})]}),q=t=>{if(typeof t!="object"||t===null)return!1;const r=t;return typeof r.id=="string"&&r.type==="phq9"&&typeof r.createdAtIso=="string"&&Array.isArray(r.answers)&&r.answers.every(i=>typeof i=="number")&&typeof r.score=="number"&&typeof r.severity=="string"},I=t=>({app:"slap-mh-phq9",version:1,records:t}),k=t=>{const r=new Date(t);return Number.isNaN(r.getTime())?"Unknown":`${r.toLocaleDateString()} ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},C=t=>{const r=[...t].sort((u,y)=>u.createdAtIso.localeCompare(y.createdAtIso));if(r.length===0)return"No trend data yet.";const i=r.slice(-5),h=r.slice(-10,-5),d=i.reduce((u,y)=>u+y.score,0)/i.length;if(h.length===0)return`Recent average: ${d.toFixed(1)}.`;const x=h.reduce((u,y)=>u+y.score,0)/h.length,p=Number((d-x).toFixed(1));return Math.abs(p)<.3?`Recent average: ${d.toFixed(1)} (stable).`:p>0?`Recent average: ${d.toFixed(1)} (up ${p.toFixed(1)} from prior period).`:`Recent average: ${d.toFixed(1)} (down ${Math.abs(p).toFixed(1)} from prior period).`},H=({ctx:t})=>{const[r,i]=g.useState([]),[h,d]=g.useState(()=>new Array(c.questions.length).fill(0)),[x,p]=g.useState(""),u=async s=>{await t.vfs.writeText(v,JSON.stringify(I(s),null,2)),i(s)};g.useEffect(()=>{(async()=>{const s=await t.vfs.readText(v);if(s){try{const n=JSON.parse(s);if(typeof n=="object"&&n!==null){const o=n;Array.isArray(o.records)&&i(o.records.filter(q))}}catch{p("Saved data was unreadable. Starting fresh.")}return}})()},[t.vfs]);const y=(s,n)=>{d(o=>o.map((a,m)=>m===s?n:a))},N=async()=>{const s=h.reduce((a,m)=>a+m,0),n={id:crypto.randomUUID(),type:"phq9",createdAtIso:new Date().toISOString(),answers:h,score:s,severity:c.getSeverity(s)},o=[n,...r].slice(0,300);await u(o),p(`${c.title} saved: ${s}/${c.maxScore} (${n.severity})`),d(new Array(c.questions.length).fill(0))},A=async()=>{const s=await t.vfs.readText(v);if(!s){p("No results to export yet.");return}const n=new Blob([s],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="phq9-results.json",a.click(),URL.revokeObjectURL(o)},f=g.useMemo(()=>[...r].sort((s,n)=>n.createdAtIso.localeCompare(s.createdAtIso)),[r]),j=f[0]??null,T=C(r);return e.jsxs($,{title:"PHQ-9 Check-in",children:[e.jsx(b,{title:"PHQ-9 Check-in"}),e.jsx(l,{children:"Screening support only, not a diagnosis. If you are in immediate danger, call 911 or local emergency services."}),e.jsx("div",{className:"slap-button-row",children:e.jsx(w,{title:"Export Results",onClick:()=>void A()})}),j?e.jsxs(l,{children:["Last score: ",j.score,"/",c.maxScore," (",j.severity,")"]}):e.jsx(l,{children:"No completed assessments yet."}),e.jsx(l,{children:T}),x?e.jsx(l,{children:x}):null,e.jsx(b,{title:`History (${f.length})`}),f.length===0?e.jsx(l,{children:"No history yet."}):null,f.map(s=>e.jsxs("details",{className:"journal-entry-accordion",children:[e.jsx("summary",{className:"journal-entry-summary",children:e.jsxs("strong",{children:[k(s.createdAtIso)," | Score ",s.score,"/",c.maxScore," (",s.severity,")"]})}),e.jsx("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:s.answers.map((n,o)=>e.jsxs(l,{children:["Q",o+1,": ",n," (",S[n]??"Unknown",")"]},`${s.id}-${o}`))})]},s.id)),c.questions.map((s,n)=>{const o=h[n]??0;return e.jsxs("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.5rem"},children:[e.jsxs("strong",{children:[n+1,". ",s]}),e.jsxs("div",{className:"slap-slider-row",children:[e.jsx("input",{className:"slap-slider",type:"range",min:0,max:3,step:1,value:o,onChange:a=>y(n,Number(a.target.value))}),e.jsx("div",{className:"slap-slider-labels",children:R.map(a=>e.jsx("span",{children:a},a))})]}),e.jsxs(l,{children:["Selected: ",o," â€” ",S[o]]}),e.jsx(l,{children:S.map((a,m)=>`${m}: ${a}`).join(" | ")})]},s)}),e.jsx(w,{title:`Save ${c.title} Result`,onClick:()=>void N()})]})},F={id:"mh-phq9",title:"PHQ-9 Check-in",author:"Joel",description:"PHQ-9 screening with history, trends, and export.",icon:"PHQ-9",Preview:P,Application:H};export{F as mhPhq9Manifest};
