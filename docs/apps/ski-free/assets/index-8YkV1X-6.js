import{j as o,r as d}from"./index-De-p9_2q.js";const A=({title:n,onClick:a,disabled:r})=>o.jsx("button",{type:"button",className:"slap-button",onClick:a,disabled:r,children:n}),C=({children:n})=>o.jsx("p",{className:"slap-inline-text",children:n}),y="ski-free-state.json",h=7,j=12,M=j-2,T=180,k=280,b=300,P=n=>o.jsxs("article",{children:[o.jsx("strong",{children:"Ski Free"}),o.jsx("p",{children:"Dodge obstacles with left and right. Survive longer for a higher score."})]}),u=(n=0)=>({status:"idle",skierLane:Math.floor(h/2),obstacles:[],elapsedMs:0,scoreSeconds:0,bestScoreSeconds:n,ticks:0,nextObstacleId:1}),O=n=>Math.max(0,Math.min(h-1,n)),_=({ctx:n})=>{const[a,r]=d.useState(u),[I,g]=d.useState("Press Start to ski."),w=d.useRef(null);d.useEffect(()=>{(async()=>{const e=await n.vfs.readText(y);if(e)try{const s=JSON.parse(e),t=typeof s.bestScoreSeconds=="number"&&s.bestScoreSeconds>=0?Math.floor(s.bestScoreSeconds):0;r(u(t))}catch{g("Saved score data was invalid. Starting fresh.")}})()},[n.vfs]),d.useEffect(()=>{n.vfs.writeText(y,JSON.stringify({bestScoreSeconds:a.bestScoreSeconds},null,2))},[n.vfs,a.bestScoreSeconds]),d.useEffect(()=>{if(a.status!=="playing")return;const e=setInterval(()=>{r(s=>{if(s.status!=="playing")return s;const t=s.elapsedMs+T,i=s.ticks+1,f=Math.floor(t/1e3),p=Math.min(6,Math.floor(t/5e3)),x=s.obstacles.map(l=>({...l,row:l.row+1})).filter(l=>l.row<j),c=Math.max(2,5-p),m=Math.min(.85,.35+p*.08),S=i%c===0&&Math.random()<m,v=S?[...x,{id:s.nextObstacleId,lane:Math.floor(Math.random()*h),row:0}]:x;if(v.some(l=>l.row===M&&l.lane===s.skierLane)){const l=Math.max(s.bestScoreSeconds,f);return g("You crashed. Press Restart to try again."),{...s,status:"lost",obstacles:v,elapsedMs:t,scoreSeconds:f,bestScoreSeconds:l,ticks:i,nextObstacleId:S?s.nextObstacleId+1:s.nextObstacleId}}return{...s,obstacles:v,elapsedMs:t,scoreSeconds:f,ticks:i,nextObstacleId:S?s.nextObstacleId+1:s.nextObstacleId}})},T);return()=>clearInterval(e)},[a.status]);const L=()=>{r(e=>({...u(e.bestScoreSeconds),status:"playing"})),g("Stay alive as long as you can.")},N=()=>{r(e=>e.status==="playing"?{...e,skierLane:O(e.skierLane-1)}:e)},E=()=>{r(e=>e.status==="playing"?{...e,skierLane:O(e.skierLane+1)}:e)},R=e=>{if(a.status!=="playing")return;const s=e.currentTarget.getBoundingClientRect();e.clientX-s.left<s.width/2?N():E()};return d.useEffect(()=>{const e=w.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const t=k/h,i=b/j,f=Math.floor(Math.min(t,i)*.72);s.fillStyle="#edf5ff",s.fillRect(0,0,k,b),s.strokeStyle="rgba(45, 64, 48, 0.12)",s.lineWidth=1;for(let c=1;c<h;c+=1)s.beginPath(),s.moveTo(c*t,0),s.lineTo(c*t,b),s.stroke();s.textAlign="center",s.textBaseline="middle",s.font=`${f}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif`;for(const c of a.obstacles){const m=c.lane*t+t/2,S=c.row*i+i/2;s.fillText("ðŸŒ²",m,S)}const p=a.skierLane*t+t/2,x=M*i+i/2;s.fillText("â›·ï¸",p,x)},[a.obstacles,a.skierLane]),o.jsxs("section",{className:"slap-shell",children:[o.jsxs("div",{className:"skifree-layout",children:[o.jsx(C,{children:"Use Left and Right to dodge trees."}),o.jsxs("div",{className:"skifree-stage",children:[o.jsx("canvas",{ref:w,className:"skifree-canvas",width:k,height:b,onPointerDown:R,"aria-label":"Ski slope"}),o.jsxs("div",{className:"skifree-hud",children:[o.jsxs("strong",{children:[a.scoreSeconds,"s | Best ",a.bestScoreSeconds,"s"]}),o.jsx("span",{children:I})]})]})]}),o.jsx("div",{className:"skifree-controls",children:o.jsx(A,{title:a.status==="playing"?"Restart":"Start",onClick:L})})]})},W={id:"ski-free",title:"Ski Free",author:"Joel",description:"Dodge obstacles and survive as long as possible.",icon:"ðŸŽ¿",Preview:P,Application:_};export{W as skiFreeManifest};
