import{j as i,r as p}from"./index-Dx583RYy.js";const L=({children:t})=>i.jsx("section",{className:"slap-shell",children:t}),C=({title:t,onClick:e,disabled:s})=>i.jsx("button",{type:"button",className:"slap-button",onClick:e,disabled:s,children:t}),b=({children:t})=>i.jsx("p",{className:"slap-inline-text",children:t}),f=4,M="game-2048.json",R=t=>i.jsxs("article",{children:[i.jsx("strong",{children:"2048"}),i.jsx("p",{children:"Swipe to merge tiles and reach 2048."})]}),k=()=>Array.from({length:f},()=>Array.from({length:f},()=>0)),Y=t=>t.map(e=>[...e]),A=t=>{const e=Y(t),s=[];for(let n=0;n<f;n+=1)for(let o=0;o<f;o+=1)e[n][o]===0&&s.push({row:n,col:o});if(s.length===0)return e;const a=s[Math.floor(Math.random()*s.length)];return e[a.row][a.col]=Math.random()<.9?2:4,e},T=()=>{let t=k();return t=A(t),t=A(t),{board:t,score:0,bestScore:0}},N=t=>{const e=t.filter(n=>n!==0),s=[];let a=0;for(let n=0;n<e.length;n+=1)if(e[n]!==0&&e[n]===e[n+1]){const o=e[n]*2;s.push(o),a+=o,n+=1}else s.push(e[n]);for(;s.length<f;)s.push(0);return{merged:s,gained:a}},O=(t,e)=>t.every((s,a)=>s.every((n,o)=>n===e[a][o])),X=(t,e)=>{const s=k();let a=0;if(e==="left"||e==="right")for(let n=0;n<f;n+=1){const o=[...t[n]],h=e==="right"?o.reverse():o,{merged:m,gained:y}=N(h),S=e==="right"?[...m].reverse():m;s[n]=S,a+=y}else for(let n=0;n<f;n+=1){const o=t.map(u=>u[n]),h=e==="down"?[...o].reverse():o,{merged:m,gained:y}=N(h),S=e==="down"?[...m].reverse():m;for(let u=0;u<f;u+=1)s[u][n]=S[u];a+=y}return{nextBoard:s,gained:a,moved:!O(t,s)}},E=t=>{for(let e=0;e<f;e+=1)for(let s=0;s<f;s+=1){const a=t[e][s];if(a===0||e+1<f&&t[e+1][s]===a||s+1<f&&t[e][s+1]===a)return!0}return!1},D=t=>t===0?"tile-empty":t<=4?"tile-low":t<=32?"tile-mid":"tile-high",J=({ctx:t})=>{const[e,s]=p.useState(T),[a,n]=p.useState("Swipe to play."),o=p.useRef(null);p.useEffect(()=>{(async()=>{const c=await t.vfs.readText(M);if(c)try{const r=JSON.parse(c);if(!Array.isArray(r.board)||typeof r.score!="number"||typeof r.bestScore!="number")return;r.board.every(l=>Array.isArray(l)&&l.length===f&&l.every(g=>typeof g=="number"))&&s({board:r.board,score:r.score,bestScore:r.bestScore})}catch{n("Saved game data was invalid. Starting fresh.")}})()},[t.vfs]),p.useEffect(()=>{t.vfs.writeText(M,JSON.stringify(e,null,2))},[t.vfs,e]);const h=c=>{s(r=>{const{nextBoard:d,gained:l,moved:g}=X(r.board,c);if(!g)return r;const w=A(d),x=r.score+l,v=Math.max(r.bestScore,x);return w.some(j=>j.some(G=>G===2048))?n("You reached 2048!"):E(w)?n("Keep going."):n("No moves left. Start a new game."),{board:w,score:x,bestScore:v}})};p.useEffect(()=>{const c=r=>{r.key==="ArrowLeft"&&h("left"),r.key==="ArrowRight"&&h("right"),r.key==="ArrowUp"&&h("up"),r.key==="ArrowDown"&&h("down")};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[]);const m=c=>{const r=c.changedTouches[0];o.current={x:r.clientX,y:r.clientY}},y=c=>{if(!o.current)return;const r=c.changedTouches[0],d=r.clientX-o.current.x,l=r.clientY-o.current.y;o.current=null,!(Math.abs(d)<24&&Math.abs(l)<24)&&(Math.abs(d)>Math.abs(l)?h(d>0?"right":"left"):h(l>0?"down":"up"))},S=c=>{const r=c.currentTarget.getBoundingClientRect(),d=c.clientX-r.left,l=c.clientY-r.top,g=[{direction:"left",distance:d},{direction:"right",distance:r.width-d},{direction:"up",distance:l},{direction:"down",distance:r.height-l}];g.sort((v,j)=>v.distance-j.distance);const w=g[0],x=Math.min(r.width,r.height)*.26;w.distance<=x&&h(w.direction)},u=()=>{const c=e.bestScore,r=T();s({...r,bestScore:c}),n("New game started.")},B=p.useMemo(()=>!E(e.board),[e.board]);return i.jsxs(L,{title:"2048",children:[i.jsx(b,{children:"Swipe tiles to combine matching numbers."}),i.jsxs(b,{children:["Score: ",e.score," | Best: ",e.bestScore]}),i.jsx(b,{children:a}),i.jsx(b,{children:"Tap board edges or swipe to move."}),i.jsx("div",{className:"game2048-grid",onTouchStart:m,onTouchEnd:y,onClick:S,children:e.board.flatMap((c,r)=>c.map((d,l)=>i.jsx("div",{className:`game2048-tile ${D(d)}`,children:d===0?"":d},`${r}-${l}`)))}),i.jsx("div",{className:"slap-button-row",children:i.jsx(C,{title:"New Game",onClick:u})}),B?i.jsx(b,{children:"Game over. Tap New Game to restart."}):null]})},I={id:"game-2048",title:"2048",author:"Joel",description:"Swipe and merge tiles to reach 2048.",icon:"ðŸ”¢",Preview:R,Application:J};export{I as game2048Manifest};
