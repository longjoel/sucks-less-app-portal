import{j as t,r as g}from"./index-Cc5sPi7d.js";const E=({children:s})=>t.jsx("section",{className:"slap-shell",children:s}),G=({title:s})=>t.jsx("h3",{className:"slap-title",children:s}),j=({title:s,onClick:e,disabled:l})=>t.jsx("button",{type:"button",className:"slap-button",onClick:e,disabled:l,children:s}),y=({children:s})=>t.jsx("p",{className:"slap-inline-text",children:s}),w="mastermind-state.json",i=4,N=10,m=[{id:0,name:"Red",hex:"#d64550"},{id:1,name:"Orange",hex:"#f08a24"},{id:2,name:"Yellow",hex:"#f2cc8f"},{id:3,name:"Green",hex:"#4c9a2a"},{id:4,name:"Blue",hex:"#2c7fb8"},{id:5,name:"Purple",hex:"#7b4f9f"}],R=s=>t.jsxs("article",{children:[t.jsx("strong",{children:"Mastermind"}),t.jsx("p",{children:"Crack the code with feedback pegs in 10 guesses."})]}),k=s=>typeof s=="number"&&Number.isInteger(s)&&s>=0&&s<m.length,D=()=>Array.from({length:i},()=>Math.floor(Math.random()*m.length)),S=()=>{const s=new Date().toISOString();return{secret:D(),guesses:[],currentGuess:Array.from({length:i},()=>null),status:"playing",maxGuesses:N,startedAtIso:s,updatedAtIso:s}},T=(s,e)=>{let l=0;const h=new Array(m.length).fill(0),u=new Array(m.length).fill(0);for(let a=0;a<i;a+=1)s[a]===e[a]?l+=1:(h[s[a]]+=1,u[e[a]]+=1);let c=0;for(let a=0;a<m.length;a+=1)c+=Math.min(h[a],u[a]);return{exact:l,colorOnly:c}},P=s=>{if(typeof s!="object"||s===null)return!1;const e=s;return typeof e.id=="string"&&Array.isArray(e.colors)&&e.colors.length===i&&e.colors.every(k)&&typeof e.createdAtIso=="string"&&typeof e.result=="object"&&e.result!==null&&typeof e.result.exact=="number"&&typeof e.result.colorOnly=="number"},U=s=>{try{const e=JSON.parse(s);if(!Array.isArray(e.secret)||e.secret.length!==i||e.secret.some(p=>!k(p))||!Array.isArray(e.currentGuess)||e.currentGuess.length!==i)return null;const l=e.currentGuess.map(p=>p===null?null:k(p)?p:null),h=Array.isArray(e.guesses)?e.guesses.filter(P):[],u=e.status==="won"||e.status==="lost"?e.status:"playing",c=typeof e.maxGuesses=="number"&&e.maxGuesses>0?e.maxGuesses:N,a=typeof e.startedAtIso=="string"?e.startedAtIso:new Date().toISOString(),A=typeof e.updatedAtIso=="string"?e.updatedAtIso:a;return{secret:e.secret,guesses:h,currentGuess:l,status:u,maxGuesses:c,startedAtIso:a,updatedAtIso:A}}catch{return null}},_=s=>{const e=[];if(!s)return Array.from({length:i},()=>"empty");for(e.push(...Array.from({length:s.exact},()=>"exact")),e.push(...Array.from({length:s.colorOnly},()=>"partial"));e.length<i;)e.push("empty");return e},J=({ctx:s})=>{const[e,l]=g.useState(S),[h,u]=g.useState("Pick a color, then tap slots to build your guess."),[c,a]=g.useState(m[0].id);g.useEffect(()=>{(async()=>{const n=await s.vfs.readText(w);if(!n)return;const r=U(n);if(r){l(r);return}u("Saved game was invalid. Starting fresh."),l(S())})()},[s.vfs]),g.useEffect(()=>{s.vfs.writeText(w,JSON.stringify(e,null,2))},[s.vfs,e]);const A=e.maxGuesses-e.guesses.length,p=e.currentGuess.every(n=>n!==null),v=n=>{e.status==="playing"&&l(r=>{if(r.status!=="playing")return r;const o=[...r.currentGuess];return o[n]=c,{...r,currentGuess:o,updatedAtIso:new Date().toISOString()}})},I=()=>{e.status==="playing"&&l(n=>({...n,currentGuess:Array.from({length:i},()=>null),updatedAtIso:new Date().toISOString()}))},C=()=>{if(e.status!=="playing")return;if(!p){u("Fill all 4 pegs before submitting.");return}const n=e.currentGuess.map($=>$??0),r=T(e.secret,n),o={id:crypto.randomUUID(),colors:n,result:r,createdAtIso:new Date().toISOString()},d=[...e.guesses,o];let f="playing",b=`Guesses left: ${e.maxGuesses-d.length}.`;r.exact===i?(f="won",b="You cracked the code!"):d.length>=e.maxGuesses&&(f="lost",b="No more guesses. The code is revealed below."),l({...e,guesses:d,currentGuess:Array.from({length:i},()=>null),status:f,updatedAtIso:new Date().toISOString()}),u(b)},O=()=>{l(S()),u("New game started. Pick a color and guess the code.")},x=e.status!=="playing",M=g.useMemo(()=>{const n=e.guesses.map(r=>({key:r.id,colors:r.colors.map(o=>o),feedback:r.result,isActive:!1}));return e.status==="playing"&&n.push({key:"current",colors:e.currentGuess,feedback:void 0,isActive:!0}),n},[e]);return t.jsxs(E,{title:"Mastermind",children:[t.jsx(G,{title:"Mastermind"}),t.jsxs(y,{children:["Crack the 4-peg code in ",e.maxGuesses," guesses."]}),t.jsx(y,{children:"Exact match = dark peg. Right color, wrong spot = light peg."}),t.jsx(y,{children:h}),t.jsxs("div",{className:"slap-button-row",children:[t.jsx(j,{title:"New Game",onClick:O}),t.jsx(j,{title:"Clear Row",onClick:I,disabled:e.status!=="playing"}),t.jsx(j,{title:"Submit Guess",onClick:C,disabled:e.status!=="playing"||!p})]}),t.jsxs(y,{children:["Guess ",Math.min(e.guesses.length+1,e.maxGuesses)," of ",e.maxGuesses," Â· Attempts left: ",A]}),t.jsx("div",{className:"mastermind-board",children:M.map(n=>t.jsxs("div",{className:"mastermind-row",children:[n.colors.map((r,o)=>{const d=typeof r=="number"?m[r]:null,f=d?d.name:"Empty";return t.jsx("button",{type:"button",className:`mastermind-slot${d?"":" is-empty"}${n.isActive?" is-active":""}`,style:d?{background:d.hex}:void 0,onClick:n.isActive?()=>v(o):void 0,disabled:!n.isActive,"aria-label":`Slot ${o+1}: ${f}`},`${n.key}-${o}`)}),t.jsx("div",{className:"mastermind-feedback","aria-hidden":"true",children:_(n.feedback).map((r,o)=>t.jsx("span",{className:`mastermind-feedback-dot ${r}`},`${n.key}-dot-${o}`))})]},n.key))}),t.jsx(G,{title:"Palette"}),t.jsxs("div",{className:"mastermind-palette",children:[m.map(n=>t.jsxs("button",{type:"button",className:`mastermind-color-button${c===n.id?" is-selected":""}`,onClick:()=>a(n.id),"aria-pressed":c===n.id,children:[t.jsx("span",{className:"mastermind-color-swatch",style:{background:n.hex}}),t.jsx("span",{children:n.name})]},n.id)),t.jsxs("button",{type:"button",className:`mastermind-color-button mastermind-eraser${c===null?" is-selected":""}`,onClick:()=>a(null),"aria-pressed":c===null,children:[t.jsx("span",{className:"mastermind-color-swatch mastermind-eraser-swatch"}),t.jsx("span",{children:"Erase"})]})]}),t.jsx(G,{title:x?"Secret Code":"Secret Code (hidden)"}),t.jsx("div",{className:"mastermind-secret",children:e.secret.map((n,r)=>{const o=m[n];return t.jsx("div",{className:`mastermind-slot${x?"":" is-hidden"}`,style:x?{background:o.hex}:void 0,"aria-hidden":!x},`secret-${r}`)})})]})},L={id:"mastermind",title:"Mastermind",author:"Joel",description:"Crack the secret color code with feedback pegs.",icon:"ðŸ§©",Preview:R,Application:J};export{L as mastermindManifest};
