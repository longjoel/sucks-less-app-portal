import{j as e,r as a}from"./index-CyxQQls9.js";const P=({title:n,onClick:t,disabled:r})=>e.jsx("button",{type:"button",className:"slap-button",onClick:t,disabled:r,children:n}),d=({children:n})=>e.jsx("p",{className:"slap-inline-text",children:n}),x="compass-state.json",A=n=>e.jsxs("article",{children:[e.jsx("strong",{children:"Compass"}),e.jsx("p",{children:"Simple heading compass using device orientation sensors."})]}),g=n=>(n%360+360)%360,H=n=>{const t=["N","NE","E","SE","S","SW","W","NW"],r=Math.round(n/45)%t.length;return t[r]},O=({ctx:n})=>{const[t,r]=a.useState(null),[u,m]=a.useState("unknown"),[S,c]=a.useState("Tap Start Compass to begin."),[b,h]=a.useState(!1),[i,j]=a.useState(null),[N,l]=a.useState("Location not started.");a.useEffect(()=>{(async()=>{const o=await n.vfs.readText(x);if(o)try{const s=JSON.parse(o);typeof s.lastHeading=="number"&&r(g(s.lastHeading))}catch{}})()},[n.vfs]),a.useEffect(()=>{n.vfs.writeText(x,JSON.stringify({lastHeading:t},null,2))},[n.vfs,t]),a.useEffect(()=>{if(u!=="granted")return;let o=!1,s=null;const L=window.setTimeout(()=>{o||(h(!0),c("No heading sensor found. Entering chaos compass mode."),s=window.setInterval(()=>{r(p=>g((p??0)+20+Math.random()*95))},90))},2200),v=p=>{let f=null;const w=p;typeof w.webkitCompassHeading=="number"?f=g(w.webkitCompassHeading):typeof p.alpha=="number"&&(f=g(360-p.alpha)),f!==null&&(o=!0,h(!1),s!==null&&(window.clearInterval(s),s=null),r(f),c("Compass active."))};return window.addEventListener("deviceorientation",v),()=>{window.clearTimeout(L),s!==null&&window.clearInterval(s),window.removeEventListener("deviceorientation",v)}},[u]),a.useEffect(()=>{if(u!=="granted")return;if(typeof navigator>"u"||!navigator.geolocation){l("GPS unavailable on this device/browser.");return}l("Requesting location...");const o=navigator.geolocation.watchPosition(s=>{j({lat:s.coords.latitude,lon:s.coords.longitude,accuracyMeters:Number.isFinite(s.coords.accuracy)?s.coords.accuracy:null}),l("Location active.")},s=>{s.code===s.PERMISSION_DENIED?l("Location permission denied."):s.code===s.POSITION_UNAVAILABLE?l("Location unavailable."):s.code===s.TIMEOUT?l("Location request timed out."):l("Unable to read location.")},{enableHighAccuracy:!0,maximumAge:4e3,timeout:1e4});return()=>navigator.geolocation.clearWatch(o)},[u]);const E=async()=>{if(typeof window>"u"||typeof DeviceOrientationEvent>"u"){m("unsupported"),c("Orientation sensors are not supported on this device/browser.");return}const o=DeviceOrientationEvent;if(typeof o.requestPermission=="function"){try{await o.requestPermission()==="granted"?(m("granted"),c("Permission granted. Move your device to calibrate.")):(m("denied"),c("Permission denied. Enable motion/orientation access in browser settings."))}catch{m("denied"),c("Permission request failed.")}return}m("granted"),c("Compass started.")},y=a.useMemo(()=>t===null?"--":H(t),[t]),C=a.useMemo(()=>t===null?"--Â°":`${Math.round(t)}Â°`,[t]),M=t===null?0:t,T=i?i.lat.toFixed(5):"--",I=i?i.lon.toFixed(5):"--";return e.jsxs("section",{className:"slap-shell",children:[e.jsx(d,{children:"Basic compass using device orientation sensors."}),e.jsxs(d,{children:["Status: ",S]}),e.jsxs(d,{children:["Heading: ",e.jsx("strong",{children:C})," (",y,")"]}),b?e.jsx(d,{children:"Demo mode: spinning wildly for dramatic effect."}):null,e.jsxs(d,{children:["GPS: ",e.jsx("strong",{children:T}),", ",e.jsx("strong",{children:I}),(i==null?void 0:i.accuracyMeters)!==null&&i?` (Â±${Math.round(i.accuracyMeters)}m)`:""]}),e.jsxs(d,{children:["Location status: ",N]}),e.jsx("div",{className:"compass-dial-wrap","aria-label":"Compass dial",children:e.jsxs("div",{className:"compass-dial",children:[e.jsx("div",{className:"compass-marker compass-n",children:"N"}),e.jsx("div",{className:"compass-marker compass-e",children:"E"}),e.jsx("div",{className:"compass-marker compass-s",children:"S"}),e.jsx("div",{className:"compass-marker compass-w",children:"W"}),e.jsx("div",{className:"compass-needle",style:{transform:`translate(-50%, -100%) rotate(${M}deg)`}}),e.jsx("div",{className:"compass-center-dot"})]})}),e.jsx("div",{className:"slap-button-row",children:e.jsx(P,{title:"Start Compass",onClick:()=>void E()})}),u==="unsupported"?e.jsx(d,{children:"Tip: Compass support is best on mobile browsers with sensor APIs enabled."}):null]})},D={id:"compass",title:"Compass",author:"Joel",description:"Basic heading compass using device orientation sensors.",icon:"ðŸ§­",Preview:A,Application:O};export{D as compassManifest};
