import{j as c,r as A}from"./index-DTY-p2Em.js";const U=({children:o})=>c.jsx("section",{className:"slap-shell",children:o}),V=({title:o})=>c.jsx("h3",{className:"slap-title",children:o}),j=({title:o,onClick:t,disabled:e})=>c.jsx("button",{type:"button",className:"slap-button",onClick:t,disabled:e,children:o}),z=({children:o})=>c.jsx("p",{className:"slap-inline-text",children:o}),F="sudoku-state.json",i=9,p=3,L={easy:38,medium:30,hard:24},Y=o=>c.jsxs("article",{children:[c.jsx("strong",{children:"Sudoku"}),c.jsx("p",{children:"Fill the grid with numbers 1-9. Pick easy, medium, or hard."})]}),Z=()=>Array.from({length:i},()=>Array.from({length:i},()=>0)),x=o=>o.map(t=>[...t]),P=o=>{const t=[...o];for(let e=t.length-1;e>0;e-=1){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t},v=(o,t,e,s)=>{for(let l=0;l<i;l+=1)if(o[t][l]===s||o[l][e]===s)return!1;const n=Math.floor(t/p)*p,r=Math.floor(e/p)*p;for(let l=n;l<n+p;l+=1)for(let f=r;f<r+p;f+=1)if(o[l][f]===s)return!1;return!0},$=o=>{let t=null,e=10;for(let s=0;s<i;s+=1)for(let n=0;n<i;n+=1){if(o[s][n]!==0)continue;let r=0;for(let l=1;l<=i;l+=1)v(o,s,n,l)&&(r+=1);if(r<e&&(e=r,t={row:s,col:n},e===1))return t}return t},D=o=>{const t=$(o);if(!t)return!0;const{row:e,col:s}=t,n=P(Array.from({length:i},(r,l)=>l+1).filter(r=>v(o,e,s,r)));for(const r of n){if(o[e][s]=r,D(o))return!0;o[e][s]=0}return!1},R=(o,t=2)=>{const e=$(o);if(!e)return 1;const{row:s,col:n}=e;let r=0;for(let l=1;l<=i;l+=1)if(v(o,s,n,l)){if(o[s][n]=l,r+=R(o,t),r>=t)return o[s][n]=0,r;o[s][n]=0}return r},q=()=>{const o=Z();return D(o),o},K=o=>{const t=q(),e=x(t),s=L[o],n=P(Array.from({length:i*i},(r,l)=>({row:Math.floor(l/i),col:l%i})));for(const r of n){if(e.flat().filter(C=>C!==0).length<=s)break;const{row:f,col:h}=r,m=e[f][h];if(m===0)continue;e[f][h]=0;const w=x(e);R(w,2)!==1&&(e[f][h]=m)}return{puzzle:e,solution:t}},B=o=>o.map(t=>t.map(e=>e!==0)),Q=(o,t)=>o.every((e,s)=>e.every((n,r)=>n===t[s][r])),W=o=>Array.isArray(o)&&o.length===i&&o.every(t=>Array.isArray(t)&&t.length===i&&t.every(e=>typeof e=="boolean")),E=(o,t,e)=>{const s=x(o);return s[t][e]=0,Array.from({length:i},(n,r)=>r+1).filter(n=>v(s,t,e,n))},O=(o,t=!0)=>{const e=new Date().toISOString(),{puzzle:s,solution:n}=K(o);return{puzzle:s,solution:n,current:x(s),fixed:B(s),difficulty:o,status:"playing",showNotes:t,startedAtIso:e,updatedAtIso:e}},X=o=>{try{const t=JSON.parse(o);if(!Array.isArray(t.puzzle)||!Array.isArray(t.solution)||!Array.isArray(t.current))return null;const e=m=>Array.isArray(m)&&m.length===i&&m.every(w=>Array.isArray(w)&&w.length===i&&w.every(b=>typeof b=="number"));if(!e(t.puzzle)||!e(t.solution)||!e(t.current))return null;const s=t.difficulty==="medium"||t.difficulty==="hard"?t.difficulty:"easy",n=W(t.fixed)?t.fixed:B(t.puzzle),r=t.status==="won"?"won":"playing",l=typeof t.showNotes=="boolean"?t.showNotes:!0,f=typeof t.startedAtIso=="string"?t.startedAtIso:new Date().toISOString(),h=typeof t.updatedAtIso=="string"?t.updatedAtIso:f;return{puzzle:t.puzzle,solution:t.solution,current:t.current,fixed:n,difficulty:s,status:r,showNotes:l,startedAtIso:f,updatedAtIso:h}}catch{return null}},tt=o=>{const t=Array.from({length:i},()=>Array.from({length:i},()=>!1));for(let e=0;e<i;e+=1){const s=new Map;for(let n=0;n<i;n+=1){const r=o[e][n];if(r===0)continue;const l=s.get(r)??[];l.push(n),s.set(r,l)}for(const[,n]of s.entries())if(n.length>1)for(const r of n)t[e][r]=!0}for(let e=0;e<i;e+=1){const s=new Map;for(let n=0;n<i;n+=1){const r=o[n][e];if(r===0)continue;const l=s.get(r)??[];l.push(n),s.set(r,l)}for(const[,n]of s.entries())if(n.length>1)for(const r of n)t[r][e]=!0}for(let e=0;e<p;e+=1)for(let s=0;s<p;s+=1){const n=new Map;for(let r=e*p;r<e*p+p;r+=1)for(let l=s*p;l<s*p+p;l+=1){const f=o[r][l];if(f===0)continue;const h=n.get(f)??[];h.push({row:r,col:l}),n.set(f,h)}for(const[,r]of n.entries())if(r.length>1)for(const l of r)t[l.row][l.col]=!0}return t},et=({ctx:o})=>{const[t,e]=A.useState(()=>O("easy")),[s,n]=A.useState(null),[r,l]=A.useState("New easy puzzle ready.");A.useEffect(()=>{(async()=>{const u=await o.vfs.readText(F);if(!u)return;const a=X(u);a&&(e(a),l(`Resumed ${a.difficulty} puzzle.`))})()},[o.vfs]),A.useEffect(()=>{o.vfs.writeText(F,JSON.stringify(t,null,2))},[o.vfs,t]);const f=A.useMemo(()=>tt(t.current),[t.current]),h=u=>{e(a=>O(u,a.showNotes)),n(null),l(`New ${u} puzzle ready.`)},m=()=>{e(u=>({...u,showNotes:!u.showNotes,updatedAtIso:new Date().toISOString()}))},w=u=>{if(!s)return;const{row:a,col:y}=s;if(!(t.fixed[a][y]||t.status!=="playing")){if(u!==0&&!E(t.current,a,y).includes(u)){l("That number can't go there.");return}e(d=>{const g=x(d.current);g[a][y]=u;const N=g.flat().every(_=>_!==0),S=N&&Q(g,d.solution),G=S?"won":"playing";return N&&!S?l("Everything is filled, but something doesn't match yet."):S&&l("Puzzle solved!"),{...d,current:g,status:G,updatedAtIso:new Date().toISOString()}})}},b=()=>w(0),C=t.current.flat().filter(u=>u!==0).length,T=t.status==="won",k=s!==null&&t.status==="playing"&&!t.fixed[s.row][s.col],I=A.useMemo(()=>!s||!k?[]:E(t.current,s.row,s.col),[k,t.current,s]);return c.jsxs(U,{title:"Sudoku",children:[c.jsx(V,{title:"Sudoku"}),c.jsx(z,{children:"Fill every row, column, and 3Ã—3 box with 1â€“9."}),c.jsx(z,{children:r}),c.jsxs("div",{className:"slap-button-row",children:[c.jsx(j,{title:"Easy",onClick:()=>h("easy")}),c.jsx(j,{title:"Medium",onClick:()=>h("medium")}),c.jsx(j,{title:"Hard",onClick:()=>h("hard")}),c.jsx(j,{title:t.showNotes?"Hide Notes":"Show Notes",onClick:m})]}),c.jsxs(z,{children:["Difficulty: ",t.difficulty," Â· Filled: ",C,"/81 ",T?"Â· Completed":""]}),c.jsx("div",{className:"sudoku-grid",children:t.current.map((u,a)=>u.map((y,d)=>{const g=t.fixed[a][d],N=(s==null?void 0:s.row)===a&&(s==null?void 0:s.col)===d,S=f[a][d],G=["sudoku-cell",g?"is-fixed":"",N?"is-selected":"",S?"is-conflict":"",a%3===0?"border-top":"",d%3===0?"border-left":"",a===i-1?"border-bottom":"",d===i-1?"border-right":""].filter(Boolean).join(" ");return c.jsx("button",{type:"button",className:G,onClick:()=>n({row:a,col:d}),"aria-label":`Row ${a+1} Column ${d+1}`,children:y!==0?y:t.showNotes?c.jsx("span",{className:"sudoku-notes",children:Array.from({length:9},(_,H)=>{const M=H+1,J=E(t.current,a,d).includes(M);return c.jsx("span",{className:`sudoku-note${J?"":" is-hidden"}`,children:M},M)})}):""},`cell-${a}-${d}`)}))}),c.jsxs("div",{className:"sudoku-keypad",children:[Array.from({length:9},(u,a)=>{const y=a+1,d=I.includes(y);return c.jsx("button",{type:"button",className:"sudoku-key",onClick:()=>w(y),disabled:!k||!d,children:y},y)}),c.jsx("button",{type:"button",className:"sudoku-key sudoku-key-clear",onClick:b,disabled:!k,children:"Erase"})]}),T?c.jsx(z,{children:"Puzzle solved! Start a new game to play again."}):null]})},ot={id:"sudoku",title:"Sudoku",author:"Joel",description:"Generate easy, medium, or hard Sudoku puzzles.",icon:"ðŸ”¢",Preview:Y,Application:et};export{ot as sudokuManifest};
