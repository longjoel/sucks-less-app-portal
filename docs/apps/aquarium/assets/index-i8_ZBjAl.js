import{j as g,r as M}from"./index-B_3AQJpz.js";const ct=({children:e})=>g.jsx("section",{className:"slap-shell",children:e}),at=({title:e})=>g.jsx("h3",{className:"slap-title",children:e}),V=({title:e,onClick:n,disabled:s})=>g.jsx("button",{type:"button",className:"slap-button",onClick:n,disabled:s,children:e}),E=({children:e})=>g.jsx("p",{className:"slap-inline-text",children:e}),Z=10,dt=18,ut=120,ft=8,yt=e=>g.jsxs("article",{children:[g.jsx("strong",{children:"Aquarium"}),g.jsx("p",{children:"Relaxing fish tank with feeding and poke play."})]}),I=(e,n,s)=>Math.min(s,Math.max(n,e)),c=(e,n)=>e+Math.random()*(n-e),tt=["yellow","red","blue","orange"],pt={yellow:52,red:6,blue:200,orange:26},et=(e,n)=>{const s=tt[Math.floor(Math.random()*tt.length)]??"yellow",l=c(14,22),a=c(e*.25,e*.75),m=c(n*.32,n*.74);return{id:crypto.randomUUID(),type:s,x:c(l*2,e-l*2),y:c(n*.2,n*.78),vx:c(-14,14),vy:c(-6,6),size:l,hue:I(pt[s]+c(-12,12),0,360),hunger:c(0,.4),wiggle:c(0,Math.PI*2),wiggleSpeed:c(1.2,2.2),followId:null,boredTimer:c(4,8),orbitAngle:c(0,Math.PI*2),orbitSpeed:c(.6,1.1),orbitRadius:c(l*2.4,l*4.6),orbitCenterX:a,orbitCenterY:m}},gt=e=>({id:crypto.randomUUID(),x:c(e*.15,e*.85),y:c(-10,20),vy:c(18,32),size:c(3,5),age:0}),ht=(e,n)=>({id:crypto.randomUUID(),x:c(e*.1,e*.9),y:c(n*.7,n*.95),vy:c(12,24),size:c(2,6),age:0,ttl:c(5,10)}),bt=(e,n,s)=>({id:crypto.randomUUID(),x:e,y:n,strength:s,age:0,ttl:.6}),xt=(e,n)=>{let s=null,l=1/0;for(const P of n){const u=P.x-e.x,d=P.y-e.y,A=u*u+d*d;A<l&&(l=A,s=P)}if(!s)return null;const a=s.x-e.x,m=s.y-e.y,j=Math.sqrt(l)||1;return{food:s,dx:a,dy:m,dist:j}},nt=(e,n,s)=>{let l=null,a=1/0;for(const u of n){if(u.id===e.id||!s(u))continue;const d=u.x-e.x,A=u.y-e.y,q=d*d+A*A;q<a&&(a=q,l=u)}if(!l)return null;const m=l.x-e.x,j=l.y-e.y,P=Math.sqrt(a)||1;return{target:l,dx:m,dy:j,dist:P}},mt=(e,n,s,l)=>{let a=null,m=1/0;for(const d of s){if(!l(d))continue;const A=d.x-e,q=d.y-n,D=A*A+q*q;D<m&&(m=D,a=d)}if(!a)return null;const j=a.x-e,P=a.y-n,u=Math.sqrt(m)||1;return{target:a,dx:j,dy:P,dist:u}},Mt=(e,n,s)=>{const l=e.createLinearGradient(0,0,0,s);l.addColorStop(0,"#0b2e4a"),l.addColorStop(.55,"#0f3f5f"),l.addColorStop(1,"#0e2733"),e.fillStyle=l,e.fillRect(0,0,n,s);const a=e.createRadialGradient(n*.35,s*.2,10,n*.35,s*.2,n*.6);a.addColorStop(0,"rgba(122, 191, 255, 0.25)"),a.addColorStop(1,"rgba(122, 191, 255, 0)"),e.fillStyle=a,e.fillRect(0,0,n,s),e.fillStyle="#163b2d",e.fillRect(n*.08,s*.72,n*.02,s*.18),e.fillRect(n*.12,s*.68,n*.015,s*.22),e.fillRect(n*.87,s*.7,n*.02,s*.2),e.fillStyle="#2f4f2f",e.fillRect(n*.09,s*.8,n*.05,s*.12),e.fillRect(n*.86,s*.78,n*.04,s*.14),e.fillStyle="#2e2a24",e.fillRect(0,s*.88,n,s*.12),e.fillStyle="#3a332c",e.fillRect(0,s*.9,n,s*.1)},Rt=(e,n)=>{e.strokeStyle="rgba(255, 255, 255, 0.45)",e.lineWidth=1,e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.stroke()},St=(e,n)=>{e.fillStyle="#c8a96b",e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fill()},vt=(e,n)=>{const s=n.vx>=0?1:-1;e.save(),e.translate(n.x,n.y),e.scale(s,1);const l=`hsl(${n.hue}, 70%, 55%)`;e.fillStyle=l,e.beginPath(),e.ellipse(0,0,n.size*1.4,n.size,0,0,Math.PI*2),e.fill(),e.fillStyle=`hsl(${n.hue}, 70%, 45%)`,e.beginPath(),e.moveTo(-n.size*1.4,0),e.lineTo(-n.size*2.2,n.size*.6),e.lineTo(-n.size*2.2,-n.size*.6),e.closePath(),e.fill(),e.fillStyle="rgba(255, 255, 255, 0.9)",e.beginPath(),e.arc(n.size*.7,-n.size*.2,n.size*.22,0,Math.PI*2),e.fill(),e.fillStyle="#1b1b1b",e.beginPath(),e.arc(n.size*.75,-n.size*.2,n.size*.1,0,Math.PI*2),e.fill(),e.restore()},zt=()=>{const e=M.useRef(null),n=M.useRef(null),s=M.useRef(null),l=M.useRef({width:320,height:420}),a=M.useRef([]),m=M.useRef([]),j=M.useRef([]),P=M.useRef([]),u=M.useRef({x:0,y:0}),d=M.useRef({active:!1,lastX:0,lastY:0,lastTime:0}),A=M.useRef(0),[q,D]=M.useState("Tap Feed to drop pellets. Poke the glass to scatter fish."),[st,N]=M.useState(0),[$,_]=M.useState(0);M.useEffect(()=>{const i=e.current;if(!i)return;const b=()=>{const R=i.getBoundingClientRect(),v=Math.max(240,R.width),X=Math.max(260,R.height),h=window.devicePixelRatio||1;i.width=Math.floor(v*h),i.height=Math.floor(X*h);const x=i.getContext("2d");if(x&&x.setTransform(h,0,0,h,0,0),l.current={width:v,height:X},a.current.length===0){const S=Array.from({length:7},()=>et(v,X));a.current=S,N(S.length)}};b(),window.addEventListener("resize",b);const k=R=>{const v=i.getContext("2d");if(!v)return;const X=s.current??R,h=Math.min(.05,(R-X)/1e3);s.current=R;const x=l.current,S=a.current,T=m.current,Y=j.current,B=P.current;u.current.x*=.95,u.current.y*=.95,Math.abs(u.current.x)<.01&&(u.current.x=0),Math.abs(u.current.y)<.01&&(u.current.y=0),Math.random()<.4&&(Y.push(ht(x.width,x.height)),Y.length>ut&&Y.shift());for(let t=Y.length-1;t>=0;t-=1){const f=Y[t];f.age+=h,f.y-=f.vy*h,f.x+=Math.sin(f.age*2)*.2,(f.age>f.ttl||f.y<-20)&&Y.splice(t,1)}for(let t=T.length-1;t>=0;t-=1){const f=T[t];f.age+=h,f.y+=f.vy*h,f.y>x.height*.88&&T.splice(t,1)}for(let t=B.length-1;t>=0;t-=1){const f=B[t];f.age+=h,f.age>f.ttl&&B.splice(t,1)}for(const t of S){t.hunger=I(t.hunger+h*.02,0,1),t.wiggle+=h*t.wiggleSpeed;const f=T.length>0,F=f?xt(t,T):null,L=Math.cos(t.wiggle)*6,H=Math.sin(t.wiggle*.7)*3;let z=0,C=0;if(t.type==="yellow"){if(F){const o=16+t.hunger*20;z=F.dx/F.dist*o,C=F.dy/F.dist*o}}else if(t.type==="red"){t.boredTimer-=h;let o=t.followId?S.find(r=>r.id===t.followId)??null:null;if(!o||t.boredTimer<=0){const r=S.filter(y=>y.id!==t.id);o=r.length>0?r[Math.floor(Math.random()*r.length)]??null:null,t.followId=(o==null?void 0:o.id)??null,t.boredTimer=c(4,8)}if(o){const r=o.x-t.x,y=o.y-t.y,p=Math.sqrt(r*r+y*y)||1,w=p>t.size*1.6?14:4;z=r/p*w,C=y/p*w}else z=L,C=H}else if(t.type==="blue")if(F){const o=mt(F.food.x,F.food.y,S,r=>r.type!=="blue"&&r.id!==t.id);if(o&&o.dist<140){const r=o.target.x-t.x,y=o.target.y-t.y,p=Math.sqrt(r*r+y*y)||1,w=22;z=r/p*w,C=y/p*w}else{const r=18+t.hunger*12;z=F.dx/F.dist*r,C=F.dy/F.dist*r}}else{const o=nt(t,S,r=>r.type==="blue");if(o){const y=o.dist-28,p=I(y*.4,-10,10);z=o.dx/o.dist*p,C=o.dy/o.dist*p}else z=L,C=H}else if(t.type==="orange"){t.orbitAngle+=h*t.orbitSpeed;const o=t.size*3,r=x.width-t.size*3,y=t.size*2.5,p=x.height*.78;t.orbitCenterX=I(t.orbitCenterX+Math.sin(t.wiggle*.2)*.08,o,r),t.orbitCenterY=I(t.orbitCenterY+Math.cos(t.wiggle*.18)*.06,y,p);const w=t.orbitCenterX+Math.cos(t.orbitAngle)*t.orbitRadius,it=t.orbitCenterY+Math.sin(t.orbitAngle)*t.orbitRadius*.6,O=w-t.x,G=it-t.y,W=Math.sqrt(O*O+G*G)||1,Q=12;z=O/W*Q,C=G/W*Q}else z=L,C=H;if(f&&t.type!=="blue"){const o=nt(t,S,r=>r.type==="blue");if(o&&o.dist<120){const r=(1-o.dist/120)*22;z+=-o.dx/o.dist*r,C+=-o.dy/o.dist*r}}for(const o of B){const r=t.x-o.x,y=t.y-o.y,p=Math.sqrt(r*r+y*y)||1;if(p<120){const w=(1-p/120)*o.strength*80;z+=r/p*w,C+=y/p*w}}z+=u.current.x*40,C+=u.current.y*24,t.vx+=(z-t.vx)*.08,t.vy+=(C-t.vy)*.08,t.x+=t.vx*h,t.y+=t.vy*h;const U=t.size*2.2;t.x<U&&(t.x=U,t.vx=Math.abs(t.vx)),t.x>x.width-U&&(t.x=x.width-U,t.vx=-Math.abs(t.vx)),t.y<U&&(t.y=U,t.vy=Math.abs(t.vy)),t.y>x.height*.86&&(t.y=x.height*.86,t.vy=-Math.abs(t.vy));for(let o=T.length-1;o>=0;o-=1){const r=T[o],y=r.x-t.x,p=r.y-t.y;if(y*y+p*p<(t.size*1.4)**2){T.splice(o,1),t.hunger=I(t.hunger-.5,0,1);break}}}R-A.current>250&&(N(S.length),_(T.length),A.current=R),Mt(v,x.width,x.height);for(const t of Y)Rt(v,t);for(const t of T)St(v,t);for(const t of S)vt(v,t);n.current=requestAnimationFrame(k)};return n.current=requestAnimationFrame(k),()=>{window.removeEventListener("resize",b),n.current!==null&&(cancelAnimationFrame(n.current),n.current=null)}},[]);const ot=()=>{const i=l.current,b=Math.floor(c(5,10));for(let k=0;k<b&&!(m.current.length>=dt);k+=1)m.current.push(gt(i.width));D("Pellets dropped. Fish are on the way."),_(m.current.length)},rt=()=>{const i=l.current;a.current.length>=Z||(a.current.push(et(i.width,i.height)),N(a.current.length),D("A new fish joined the tank."))},lt=()=>{m.current=[],_(0)},J=(i,b,k)=>{const R=I(.4+k*.8,.3,1.6);P.current.push(bt(i,b,R)),P.current.length>ft&&P.current.shift()},K=i=>{const b=i.currentTarget.getBoundingClientRect();return{x:i.clientX-b.left,y:i.clientY-b.top}};return g.jsxs(ct,{title:"Aquarium",children:[g.jsx(at,{title:"Aquarium"}),g.jsx(E,{children:"Half screensaver, half playset. Feed the fish or poke the glass to stir them."}),g.jsx(E,{children:q}),g.jsxs("div",{className:"slap-button-row",children:[g.jsx(V,{title:"Feed",onClick:ot}),g.jsx(V,{title:"Add Fish",onClick:rt,disabled:a.current.length>=Z}),g.jsx(V,{title:"Clear Food",onClick:lt,disabled:$===0})]}),g.jsxs(E,{children:["Fish: ",st," ¬∑ Food pellets: ",$]}),g.jsx("div",{className:"aquarium-stage",children:g.jsx("canvas",{ref:e,className:"aquarium-canvas",onPointerDown:i=>{d.current.active=!0,d.current.lastX=i.clientX,d.current.lastY=i.clientY,d.current.lastTime=performance.now(),i.currentTarget.setPointerCapture(i.pointerId);const b=K(i);J(b.x,b.y,.6)},onPointerMove:i=>{if(!d.current.active)return;const b=performance.now(),k=i.clientX-d.current.lastX,R=i.clientY-d.current.lastY,v=Math.max(1,b-d.current.lastTime),X=Math.sqrt(k*k+R*R)/v,h=I(k/v,-1,1),x=I(R/v,-1,1);u.current.x=u.current.x*.7+h*.3,u.current.y=u.current.y*.7+x*.3;const S=K(i);J(S.x,S.y,X),d.current.lastX=i.clientX,d.current.lastY=i.clientY,d.current.lastTime=b},onPointerUp:()=>{d.current.active=!1},onPointerCancel:()=>{d.current.active=!1},onPointerLeave:()=>{d.current.active=!1}})}),g.jsx(E,{children:"Tip: Drag to create a current. Rapid taps make fish dart."})]})},Pt={id:"aquarium",title:"Aquarium",author:"Joel",description:"Relaxing fish tank you can feed and poke.",icon:"üêü",Preview:yt,Application:zt};export{Pt as aquariumManifest};
