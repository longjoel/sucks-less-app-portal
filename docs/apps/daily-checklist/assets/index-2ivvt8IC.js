import{j as s,r as i}from"./index-Bw-Hu-Xi.js";const B=({children:n})=>s.jsx("section",{className:"slap-shell",children:n}),M=({title:n})=>s.jsx("h3",{className:"slap-title",children:n}),m=({title:n,onClick:e,disabled:l})=>s.jsx("button",{type:"button",className:"slap-button",onClick:e,disabled:l,children:n}),R=({label:n,value:e,onChange:l,type:r="text"})=>s.jsxs("label",{className:"slap-input-wrap",children:[s.jsx("span",{children:n}),s.jsx("input",{className:"slap-input",type:r,value:e,onChange:x=>l(x.target.value)})]}),u=({children:n})=>s.jsx("p",{className:"slap-inline-text",children:n}),w="daily-checklist.json",K=[{id:"water",text:"Drink water"},{id:"walk",text:"Take a short walk"},{id:"pause",text:"Take one mindful pause"}],F=n=>s.jsxs("article",{children:[s.jsx("strong",{children:"Daily Checklist"}),s.jsx("p",{children:"Check off daily tasks and manage your list."})]}),O=()=>new Date().toISOString().slice(0,10),q=n=>{if(typeof n!="object"||n===null)return!1;const e=n;return typeof e.id=="string"&&typeof e.text=="string"},T=()=>({app:"slap-daily-checklist",version:1,templateItems:K,days:{}}),G=n=>{if(typeof n!="object"||n===null)return T();const e=n,l=Array.isArray(e.templateItems)?e.templateItems.filter(q).map(p=>({id:p.id,text:p.text.trim()})).filter(p=>p.text):[],r=l.length>0?l:K,x=typeof e.days=="object"&&e.days!==null?e.days:{},I={};for(const[p,h]of Object.entries(x)){if(typeof h!="object"||h===null)continue;const y=h.checkedItemIds,j=Array.isArray(y)?y.filter(f=>typeof f=="string"):[];I[p]={checkedItemIds:j}}return{app:"slap-daily-checklist",version:1,templateItems:r,days:I}},U=n=>{const e=new Date(`${n}T00:00:00`);return Number.isNaN(e.getTime())?n:e.toLocaleDateString()},L=(n,e)=>{const l=new Date(`${n}T00:00:00`);return l.setDate(l.getDate()+e),l.toISOString().slice(0,10)},Q=({ctx:n})=>{const[e,l]=i.useState(T()),[r,x]=i.useState(O),[I,p]=i.useState(""),[h,y]=i.useState(!1),[j,f]=i.useState({}),[v,o]=i.useState(""),k=i.useRef(null);i.useEffect(()=>{(async()=>{const t=await n.vfs.readText(w);if(!t){const a=T();l(a),await n.vfs.writeText(w,JSON.stringify(a,null,2));return}try{const a=JSON.parse(t);l(G(a))}catch{o("Checklist data was unreadable. Reset to defaults."),l(T())}})()},[n.vfs]);const S=async t=>{l(t),await n.vfs.writeText(w,JSON.stringify(t,null,2))},b=i.useMemo(()=>{const t=e.days[r];return new Set((t==null?void 0:t.checkedItemIds)??[])},[e.days,r]),D=i.useMemo(()=>{const t=e.templateItems.length,a=e.templateItems.filter(c=>b.has(c.id)).length;return{total:t,done:a,percent:t===0?0:Math.round(a/t*100)}},[e.templateItems,b]),N=async t=>{const a=e.days[r]??{checkedItemIds:[]},c=new Set(a.checkedItemIds);c.has(t)?c.delete(t):c.add(t);const d={...e,days:{...e.days,[r]:{checkedItemIds:[...c]}}};await S(d)},H=async()=>{o("");const t=I.trim();if(!t){o("Enter item text first.");return}const a={id:crypto.randomUUID(),text:t},c={...e,templateItems:[...e.templateItems,a]};await S(c),p(""),o("Item added.")},J=()=>{const t={};for(const a of e.templateItems)t[a.id]=a.text;f(t),y(!0)},P=async()=>{o("");const t=e.templateItems.map(c=>({...c,text:(j[c.id]??c.text).trim()})).filter(c=>c.text.length>0);if(t.length===0){o("At least one checklist item is required.");return}const a={...e,templateItems:t};await S(a),f({}),y(!1),o("Checklist updated.")},z=()=>{f({}),y(!1),o("")},X=t=>{const a=t.changedTouches[0];k.current={x:a.clientX,y:a.clientY}},Y=(t,a)=>{if(h||!k.current)return;const c=t.changedTouches[0],d=c.clientX-k.current.x,g=c.clientY-k.current.y;k.current=null,Math.abs(d)>=48&&Math.abs(g)<=32&&(N(a),o(d>0?"Checked via swipe.":"Unchecked via swipe."))},A=i.useMemo(()=>Object.entries(e.days).sort(([a],[c])=>c.localeCompare(a)).slice(0,7).map(([a,c])=>{const d=new Set(e.templateItems.map(E=>E.id)),g=c.checkedItemIds.filter(E=>d.has(E)).length,C=e.templateItems.length,$=C===0?0:Math.round(g/C*100);return{dateKey:a,done:g,total:C,percent:$}}),[e.days,e.templateItems]),_=async()=>{const t=await n.vfs.readText(w);if(!t){o("No checklist history to export yet.");return}const a=new Blob([t],{type:"application/json"}),c=URL.createObjectURL(a),d=document.createElement("a");d.href=c,d.download=`daily-checklist-history-${r}.json`,d.click(),URL.revokeObjectURL(c),o("Checklist history exported.")};return s.jsxs(B,{title:"Daily Checklist",children:[s.jsxs("div",{className:"slap-button-row",children:[s.jsx(m,{title:"Prev Day",onClick:()=>x(t=>L(t,-1))}),s.jsx(m,{title:"Today",onClick:()=>x(O())}),s.jsx(m,{title:"Next Day",onClick:()=>x(t=>L(t,1))}),s.jsx(m,{title:"Export History",onClick:()=>void _()}),h?s.jsxs(s.Fragment,{children:[s.jsx(m,{title:"Save Edits",onClick:()=>void P()}),s.jsx(m,{title:"Cancel Edit",onClick:z})]}):s.jsx(m,{title:"Edit Mode",onClick:J})]}),s.jsxs(u,{children:["Date: ",U(r)]}),s.jsxs(u,{children:["Progress: ",D.done,"/",D.total," (",D.percent,"%)"]}),h?null:s.jsx(u,{children:"Swipe left/right on an item to toggle checked."}),v?s.jsx(u,{children:v}):null,e.templateItems.length===0?s.jsx(u,{children:"No checklist items. Add one below."}):null,e.templateItems.map(t=>s.jsx("article",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.5rem"},onTouchStart:X,onTouchEnd:a=>Y(a,t.id),children:h?s.jsx(R,{label:"Edit Item",value:j[t.id]??t.text,onChange:a=>f(c=>({...c,[t.id]:a}))}):s.jsxs("label",{style:{display:"flex",gap:"0.55rem",alignItems:"center"},children:[s.jsx("input",{type:"checkbox",checked:b.has(t.id),onChange:()=>void N(t.id)}),s.jsx("span",{children:t.text})]})},t.id)),s.jsxs("section",{className:"slap-shell",style:{borderTop:"1px solid #c5b9a5",paddingTop:"0.6rem"},children:[s.jsx(M,{title:"Add Item"}),s.jsx(R,{label:"New Item",value:I,onChange:p}),s.jsx(m,{title:"Add To List",onClick:()=>void H()})]}),s.jsx(M,{title:"Recent Completion"}),A.length===0?s.jsx(u,{children:"No history yet."}):null,A.map(t=>s.jsxs(u,{children:[U(t.dateKey),": ",t.done,"/",t.total," (",t.percent,"%)"]},t.dateKey))]})},W={id:"daily-checklist",title:"Daily Checklist",author:"Joel",description:"Daily checkoffs with editable checklist items.",icon:"âœ…",Preview:F,Application:Q};export{W as dailyChecklistManifest};
